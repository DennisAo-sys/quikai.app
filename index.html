<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>Quik</title>
  <link rel="icon" href="icons/quik_icon.png" type="image/png">

  <!-- Google Fonts: Inter -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  
  <!-- Highlight.js CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css">

  <style>
    /* Renk Değişkenleri */
:root {
  --bg-color: #f7f7f8;
  --text-color: #333;
  --primary-color: #007bff;
  --sidebar-bg: #ffffff;
  --input-bg: #ffffff;
  --bubble-user-bg: #dcf8c6;
  --bubble-assistant-bg: #ececec;
  --topbar-bg: #ffffff;
  --code-bg: #f7f7f8;
  --code-text: #333;
  --code-border: #ddd;
  --hover-bg: #3e3f4b;
  --modal-shadow: rgba(0, 0, 0, 0.5);
  --sidebar-width: 258px; /* Yeni eklenen değişken */
  --success-color: #28a745; /* Başarılı işlemler için */
  --danger-color: #dc3545; /* Hatalar veya silme için */
  --warning-color: #ffc107; /* Uyarılar için */
  --accent-color: #6c757d; /* İkincil vurgular için */
}

@media (max-width: 768px) {
  .sidebar {
    width: 100%; /* Tam ekran */
    transform: translateX(-100%);
    padding: 0.5rem;
  }
  .sidebar.open {
    transform: translateX(0);
  }
  .main-content {
    margin-left: 0; /* Sidebar kapalıyken tam genişlik */
  }
  .main-content.sidebar-open {
    display: none; /* Sidebar açıkken ana içerik gizlensin */
  }
  #toggle-sidebar-btn, .new-chat-btn {
    width: 36px; /* Daha küçük butonlar */
    height: 36px;
    top: 5px;
  }
  #toggle-sidebar-btn {
    left: 5px;
  }
  .new-chat-btn {
    right: 5px;
  }
}
    
    body.dark {
      transition: none;
      --bg-color: #202020;
      --text-color: #e0e0e0;
      --primary-color: #0a84ff;
      --sidebar-bg: #171717; 
      --input-bg: #303030;
      --bubble-user-bg: #055160;
      --bubble-assistant-bg: #333333;
      --topbar-bg: #000000;
      --code-bg: #171717;  /* Daha koyu kod arka planı */
      --code-text: #f0f0f0; /* Açık kod rengi */
      --code-border: #333;  /* Koyu kenarlık */
      --success-color: #34c759;
      --danger-color: #ff4d4f;
      --warning-color: #ffca2c;
      --accent-color: #adb5bd;
    }

    body.dark .top-bar {
      background-color: var(--bg-color);
      box-shadow: none;
    }

    /* Genel Stil ve Modern Font */
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      font-family: 'Arial', sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
      overflow-y: auto;
    }

    /* Sabit Toggle Butonu (sol üst köşe) */
    #toggle-sidebar-btn {
      position: fixed;
      display: flex;
      align-items: center;
      justify-content: center;
      top: 9px;
      left: 13px;
      z-index: 304;
      background-color: var(--background-bg);
      border: none;
      height: 40px;
      width: 40px;
      cursor: pointer;
      color: var(--text-color);

      transition: transform 0.3s;
      border-radius: 12px;
    }
    #toggle-sidebar-btn:hover {
      background-color: #c0c0c0;
    }
    body.dark #toggle-sidebar-btn {
      color: #f0f0f0;
    }
    body.dark #toggle-sidebar-btn:hover {
      color: var(--sidebar-bg);
      background-color: #c0c0c0;
    }

/* Dark modda ikonlar normalde ters çevrilmiş olsun */
body.dark #toggle-sidebar-btn img,
body.dark .new-chat-btn img,
body.dark #web-search-btn img {
  filter: invert(1);
}

/* Hover durumunda filtreyi kaldırarak ikonların doğal rengine dönmesini sağla */
body.dark #toggle-sidebar-btn:hover img,
body.dark .new-chat-btn:hover img,
body.dark #web-search-btn:hover img {
  filter: none;
}

    /* Uygulama konteyneri */
    #app {
      display: flex;
      min-height: 100vh;
      overflow: visible;
    }

/* Sidebar */
.sidebar {
  position: fixed;
  top: 0;
  left: 0;
  width: var(--sidebar-width); /* Sabit 258px yerine değişken */
  height: 100%;
  background-color: var(--sidebar-bg);
  transform: translateX(-100%);
  transition:
    transform 0.5s cubic-bezier(0.2, 1, 0.4, 1),
    opacity 0.5s ease,
    box-shadow 0.5s ease-out,
    backdrop-filter 0.5s ease-in-out;
  z-index: 303;
  display: flex;
  flex-direction: column;
  padding: 1rem;
}

.sidebar.open {
  transform: translateX(0);
  box-shadow: 1px 0 10px rgba(192, 192, 192, 0.5);
}

body.dark .sidebar.open {
  box-shadow: none;
}

.sidebar-header {
  position: sticky;
  top: 0;
  left: 0;
  width: 100%;
  text-align: center;
  margin: 0;
  padding: 9px 0; /* Üst ve alt padding'i eşitliyoruz, hizalamayı bozmamak için */
  border-bottom: 1px solid rgba(128, 128, 128, 0.2);
  display: flex; /* İçeriği dikey ve yatayda hizalamak için */
  align-items: center;
  justify-content: center;
}

#sidebar-brand {
  display: inline-flex; /* Flex ile içeriği ortalayalım */
  align-items: center;
  justify-content: center;
  width: 40px; /* Aynı kutucuk boyutu */
  height: 40px; /* Aynı kutucuk boyutu */
  margin-top: -16px; /* Yatayda merkezleme */
  padding: 0; /* İç boşluğu sıfırladık, ikon kendi boyutunu korusun */
  border-radius: 12px; /* Diğer butonlarla uyumlu */
  border: 1px solid transparent;
  cursor: pointer; /* Tıklanabilir imleç */
}

#sidebar-brand:hover {
  background-color: #c0c0c0;
}

body.dark #sidebar-brand:hover {
  color: var(--sidebar-bg);
}

#sidebar-brand-icon {
  width: 24px; /* İkon boyutu diğer buton ikonlarıyla uyumlu (toggle ve new-chat 21-24px) */
  height: 24px; /* Sabit yükseklik */
  vertical-align: middle;
}

body.dark #sidebar-brand-icon {
  filter: brightness(0) invert(1); /* Dark modda ikon ters çevrilsin */
}

body.dark #sidebar-brand:hover #sidebar-brand-icon {
  filter: none; /* Filtreyi kaldırarak orijinal renge dön */
}

#sidebar-brand:hover {
  background-color: #c0c0c0;
}

body.dark #sidebar-brand:hover {
  color: var(--sidebar-bg);
}

    .close-sidebar-btn {
      display: none;
    }
    .new-chat-btn {
      position: absolute;
      top: 9px;
      right: 10px;
      font-size: 0.5rem;
      width: 40px;
      height: 40px;
      background-color: transparent;
      border: none;
      outline: none;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: transform 0.3s ease, color 0.3s ease;
      color: var(--text-color);
    }
    .new-chat-btn:hover {
      background-color: #c0c0c0;
    }

.new-chat-btn[data-tooltip] {
  position: absolute;
}

.new-chat-btn[data-tooltip]::after {
  left: auto !important;
  right: 232% !important;
  top: 50% !important;
  transform: translate(50%, -50%) !important;
}



body.dark .new-chat-btn img {
  filter: brightness(0) invert(1);
}

body.dark .new-chat-btn:hover {
  color: var(--sidebar-bg);

}

body.dark .new-chat-btn:hover img {
  filter: none; /* ikon doğal renginde (muhtemelen siyah) görünsün */
}

.chat-history-list {
  list-style: none;
  padding: 0.5rem 0;
  margin: 0;
  overflow-y: auto;
  flex: 1;
  scrollbar-width: thin;
  scrollbar-color: rgba(85, 85, 85, 0.2) transparent;
}

/* Tarih Grubu (Başlık ve Sohbetler) */
.chat-history-group {
  margin-bottom: 0.5rem;
}

/* Tarih Başlığı */
.chat-history-header {
  font-size: 0.8rem;
  font-weight: 600;
  color: var(--text-color);
  padding: 0.5rem 0.25rem;
  border-top: 1.5px solid #c0c0c0; /* Hafif arka plan */
  border-bottom: 1.5px solid #c0c0c0; /* Hafif arka plan */
  border-radius: 12px;
  margin-top: 15px;
}

.chat-history-list::-webkit-scrollbar {
  width: 6px;
}

.chat-history-list::-webkit-scrollbar-track {
  background: transparent;
}

.chat-history-list::-webkit-scrollbar-thumb {
  background-color: rgba(85, 85, 85, 0.2);
  border-radius: 10px;
  border: 2px solid transparent;
  background-clip: content-box;
}

.chat-history-list::-webkit-scrollbar-thumb:hover {
  background-color: rgba(85, 85, 85, 0.5);
}


/* Chat History Date (Tarih Bilgisi) */
.chat-history-date {
  font-size: 0.8rem; /* Küçük font boyutu */
  color: var(--accent-color); /* Soluk renk (örneğin, #6c757d) */
  white-space: nowrap; /* Tarih tek satırda kalsın */
  margin-right: 0.5rem; /* Butonlarla arasında boşluk */
}

/* Aktif Durumda Tarih Rengi */
.chat-history-item.active .chat-history-date {
  color: #000000; /* Light modda siyah */
}

body.dark .chat-history-item.active .chat-history-date {
  color: var(--sidebar-bg); /* Dark modda sidebar rengi */
}

/* Hover Durumunda Tarih Rengi */
.chat-history-item:hover .chat-history-date {
  color: var(--text-color); /* Hover’da metin rengiyle uyumlu */
}

body.dark .chat-history-item:hover .chat-history-date {
  color: var(--text-color);
}


/* Chat History Item (Her Bir Sohbet Öğesi) */
.chat-history-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  cursor: pointer;
  padding: 0.25rem 0.25rem; /* Daha geniş tıklama alanı */
  border-radius: 8px; /* Daha modern yuvarlak köşeler */
  background-color: transparent; /* Varsayılan arka plan şeffaf */
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05); /* Hafif gölge */
}

.chat-history-item:hover {
  background-color: #c0c0c0;
}

body.dark .chat-history-item {
  box-shadow: 0 1px 3px rgba(255, 255, 255, 0.05);
}

body.dark .chat-history-item:hover {
  background-color: #333; /* Dark modda koyu gri */
}

.chat-history-item.active {
  background-color: #c0c0c0; /* Her zaman sabit arka plan rengi */
  transition: none; /* Hover geçişini devre dışı bırak, sabit renk için */
}

body.dark .chat-history-item.active {
  background-color: #c0c0c0;
  color: #fff;
}

.chat-history-title {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  font-size: 0.8rem;
  padding-top: 6px;
  padding-bottom: 6px;
  font-weight: 500;
  color: var(--text-color);
  flex: 1; /* Başlık alanı genişlesin */
  margin-right: 0.5rem;
}

.chat-history-item.active .chat-history-title {
  color: #000000; /* Light modda siyah metin */
}

/* History Actions (Düzenleme ve Silme Butonları) */
.history-actions {
  display: flex;
  gap: 0.25rem; /* Butonlar arasında daha az boşluk */
  opacity: 0; /* Varsayılan olarak gizli */

}

.chat-history-item:hover .history-actions {
  opacity: 1; /* Hover’da butonlar görünür */
}

.history-actions button {
  background: none;
  border: none;
  cursor: pointer;
  color: var(--text-color);
  transition: background-color 0.3s ease;
  border-radius: 6px;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 24px; /* Daha küçük ve simetrik butonlar */
  height: 24px;
}

.history-actions button:hover {
  background-color: var(--sidebar-bg); /* Hafif gri arka plan */
}

body.dark .history-actions button {
  color: var(--text-color);
}

body.dark .history-actions button:hover {
  background-color: var(--sidebar-bg); /* Hafif gri arka plan */
}

.history-actions button img {
  width: 14px; /* İkon boyutu */
  height: 14px;
  filter: none; /* Varsayılan olarak filtre yok */
}

body.dark .history-actions button img {
  filter: brightness(0) invert(1); /* Dark modda ikonlar beyaz */
}

body.dark .history-actions button:hover img {
  filter: none; /* Hover’da orijinal ikon rengi */
}

/* Dark mode’da ikonu tersine çevir */
body.dark .history-icon {
  filter: brightness(0) invert(1);
}


    /* Main İçerik */
    .main-content {
      flex: 1;
      margin-left: 0;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      position: relative;
      width: 100%;
      transition: margin-left 0.3s;
    }
    .main-content.sidebar-open {
      margin-left: 258px;
    }
    .top-bar {
      display: flex;
      align-items: center;
      justify-content: flex-end;
      padding: 1.5rem 3rem;
      background-color: var(--topbar-bg);
      border-bottom: 1px solid rgba(128, 128, 128, 0.2);
      z-index: 100;
      height: 58px;
    }

    body. dark .top-bar {
      border-bottom: 1px solid rgba(128, 128, 128, 0.5);
    }

.dark-mode-toggle {
  position: fixed;
  display: flex;
  align-items: center;
  justify-content: center;
  top: 7px;
  right: 7px;
  z-index: 304;
  background: none;
  border: none;
  font-size: 1.8rem;
  cursor: pointer;
  color: var(--text-color);
  display: flex;               /* Flex düzeni ekledik */
  align-items: center;         /* İçeriği dikey ortala */
  justify-content: center;     /* İçeriği yatay ortala */
  width: 40px;                 /* Sabit buton boyutu */
  height: 40px;
  border-radius: 12px;
}

.dark-mode-toggle:hover {
  background-color: #c0c0c0;
}

.dark-mode-toggle img {
  transition: filter 0s;
}

body.dark .dark-mode-toggle img {
  filter: invert(1);
}

body.dark .dark-mode-toggle:hover img {
  filter: none;
}

body.dark .dark-mode-toggle:hover {
  /* Dark modda da aynı hover efekti: */
  background-color: #c0c0c0;
  color: var(--sidebar-bg);
}

.scroll-wrapper {
  width: 100%;
  height: calc(100vh - 150px); /* Örneğin top-bar vs. dikkate alınarak */
  overflow-y: auto;
  scroll-behavior: smooth;
}

.chat-container {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
  display: flex;
  flex-direction: column;
  padding-top: 1rem;
  background-color: var(--bg-color);
  max-width: 800px;
  margin: 0 auto;
  width: 100%;
  scroll-behavior: smooth;
}

.chat-container::after {
  content: "";
  display: block;
  height: 100px; /* Chat input yüksekliğine göre ayarlayın */
}

.welcome-message {
  position: absolute;
  top: 40%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
  width: 100%;
}

    .welcome-message h1 {
      font-size: 2rem;
    }
    .welcome-message p {
      font-size: 1.5rem;
    }

    /* Animasyon */
    @keyframes fadeIn {
      0% { opacity: 0; }
      100% { opacity: 1; }
    }
    #welcome-message span {
      opacity: 0;
      display: inline-block;
    }

    /* Chat Mesaj Balonları */
.chat-bubble {
  max-width: 70%;
  margin-bottom: 0.5rem; /* Azaltılmış alt boşluk */
  margin-right: 0.2rem;
  margin-left: 0.5rem;
  border-radius: 16px;
  word-wrap: break-word;
  line-height: 1.5;       /* Sıkıştırılmış satır yüksekliği */
  font-size: 1rem;
  white-space: normal;  /* Yeni satırları korumak istemiyorsanız normal */
}

.user-bubble {
  align-self: flex-end;
  border-bottom-right-radius: 0;
  background-color: var(--input-bg);
  font-family: Helvetica, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI Emoji", "Noto Color Emoji", sans-serif;
  padding-left: 1rem;
  padding-right: 1rem;
  border-radius: 24px;
  line-height: 1.5;
  margin-bottom: 2rem;
}

.assistant-bubble {
  position: relative;
  font-family: Helvetica, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI Emoji", "Noto Color Emoji", sans-serif;
  font-size: 1rem;
  white-space: normal;   /* Fazla boşluklar ortadan kalksın */
  overflow-wrap: break-word;
  max-width: 100% !important;

  flex-direction: column;
  gap: 0;
  padding-bottom: 0;
  line-height: 1.5;
  margin-bottom: 2rem;
}

.assistant-bubble pre code {
  display: block;
  background: #f8f8f8;
  overflow-x: auto;
}

.feedback-container, .feedback-button {
  margin-top: 0;
  padding-top: 0;
}

/* Chat Input */
.chat-input {
  position: absolute;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  transition: left 0.3s ease;
  display: flex;
  flex-direction: row;
  align-items: flex-end;
  background-color: var(--input-bg);
  border-radius: 30px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
  width: 100%;
  max-width: 800px;
  margin: 0 auto;
  padding-right: 0.5rem;
  padding-bottom: 3.5rem;
  padding-left: 0.5rem;
  padding-top: 1rem;
  box-sizing: border-box;
  z-index: 302; /* Chat input üstte, feedback’lerden önce */
}

body.sidebar-open .chat-input {
  left: calc(50% + (var(--sidebar-width) / 2)); /* Mevcut kaydırma korunuyor */
  width: calc(100% - var(--sidebar-width) - 1rem); /* Sidebar genişliği kadar daralır */

}

/* Responsive ayar: Küçük ekranlar için minimum genişlik */
@media (max-width: 768px) {
  .chat-input {
    width: calc(100% - 1rem); /* Daha dar ekranlarda padding azalır */
  }
  body.sidebar-open .chat-input {
    width: calc(100% - var(--sidebar-width) - 1rem);
  }
}

#chat-input-textarea {
  font-family: 'Inter', sans-serif;
  font-size: 1rem;
  font-weight: 500;
  flex: 1;                    /* Butonlar solda-sağda, geri kalan alan textarea */
  border: none;
  outline: none;
  background: transparent;
  resize: none;
  max-height: 150px;
  overflow-y: auto;
  margin: 0 0.5rem;
  min-height: 5rem;
  line-height: 1.5;
  font-size: 0.9rem;
  font-weight: 500;
  width: 100%; /* Textarea'nın kapsayıcısına tam oturmasını sağlar */
  box-sizing: border-box; /* Padding ve border'ı genişliğe dahil et */
}
    body.dark #chat-input-textarea {
      color: #fff;
      caret-color: #fff;
    }

body.dark #chat-input-textarea::placeholder {
  color: #bbb;
}
.send-btn {
  position: fixed;
  background-color: var(--input-bg);
  border: none;
  border-radius: 12px;
  width: 40px;
  height: 35px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  bottom: -41px;
  right: 10px;
  box-shadow: 
    /* Aşağıya doğru gölge */
    0 4px 6px -2px rgba(0, 0, 0, 0.15),
    /* Sağa doğru gölge */
    4px 0 6px -2px rgba(0, 0, 0, 0.15),
    /* Sola doğru gölge */
    -4px 0 6px -2px rgba(0, 0, 0, 0.15),
    /* Yukarıya doğru gölge */
    0 -4px 6px -2px rgba(0, 0, 0, 0.15);
}

.send-btn:hover {
  background-color: #c0c0c0;
}

body.dark #send-btn {
  box-shadow: 
    /* Aşağıya doğru gölge */
    0 4px 6px -2px rgba(0, 0, 0, 0.15),
    /* Sağa doğru gölge */
    4px 0 6px -2px rgba(0, 0, 0, 0.15),
    /* Sola doğru gölge */
    -4px 0 6px -2px rgba(0, 0, 0, 0.15),
    /* Yukarıya doğru gölge */
    0 -4px 6px -2px rgba(0, 0, 0, 0.15);
}

body.dark #send-btn img {
  filter: brightness(0) invert(1);
}

body.dark #send-btn:hover img {
  filter: none;
}

    /* Modern Scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    ::-webkit-scrollbar-track {
      background: transparent;
    }
    ::-webkit-scrollbar-thumb {
      background-color: rgba(85, 85, 85, 0.2);
      border-radius: 10px;
      border: 2px solid transparent;
      background-clip: content-box;
      transition: background-color 0.3s;
    }
    ::-webkit-scrollbar-thumb:hover {
      background-color: #555;
    }
    * {
      scrollbar-width: thin;
      scrollbar-color: rgba(85, 85, 85, 0.2) transparent;
    }

    .delete-btn:hover, .edit-btn:hover {
      color: var(--sidebar-bg);
      filter: brightness(100%);
    }

body.dark .delete-btn:hover,
body.dark .edit-btn:hover {

  filter: none; /* Filter kaldırılarak, iconun kendi rengi (currentColor) kullanılacak */
  color: var(--sidebar-bg);
}

    /* === Kod Blokları ve Kopyalama Butonu Stilleri === */
   
/* Kod bloklarına relative konumlandırma */
pre {
  position: relative;
  background: var(--code-bg);
  padding: 16px;
  font-family: 'Fira Code', monospace;
  font-size: 14px;
  overflow-x: auto;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
  color: var(--code-text);
  border-top-left-radius: 0;
  border-top-right-radius: 0;
  border-bottom-left-radius: 12px;
  border-bottom-right-radius: 12px;
}

/* Dark Mode */
body.dark pre {
  background: var(--code-bg);
  border: 1px solid var(--code-border);
  box-shadow: 0 4px 12px rgba(255, 255, 255, 0.05);
  color: var(--code-text);
}

/* Copy butonu sağ üstte */
.copy-btn {
  display: flex;
  align-items: center;
  gap: 6px;
  background-color: transparent;
  color: #777;
  border: none;
  padding: 3px 8px;
  border-radius: 6px;
  font-size: 0.85rem;
  cursor: pointer;
  transition: background-color 0.2s, color 0.2s;
}

.copy-btn:hover {
  background-color: #ddd;
  color: #333;
}

.btn-text {
  display: inline-block;
  transition: transform 0.3s;
}

body.dark .copy-btn {
  color: #bbb;
}

body.dark .copy-btn img {
  filter: brightness(0) invert(1);
}

body.dark .copy-btn:hover {
  background-color: #444;
  color: #fff;
}

.copy-btn.copied {
  background-color: #28a745; /* yeşil ton */
  color: #fff !important;
}

body.dark .copy-btn:hover img {
  filter: none; /* ikon doğal renginde (muhtemelen siyah) görünsün */
}

/* Dark mode'da kopyalandıktan sonra da zıt renk kalsın */
body.dark .copy-btn.copied {
  background-color: var(--success-color, #28a745);
  color: #fff;
}

.code-block {
  background-color: var(--code-bg);    /* Light mod için açık gri arka plan */
  border: 1px solid var(--code-border); 
  margin-bottom: 1.5rem;
  overflow: hidden;
  box-shadow: 0 4px 12px rgba(0,0,0,0.05); 
  border-top-left-radius: 12px;
  border-top-right-radius: 12px;
  border-bottom-left-radius: 12px;
  border-bottom-right-radius: 12px;
}

body.dark .code-block {
  background-color: #1e1e1e;  /* Koyu arka plan */
  border-color: #333;
  box-shadow: 0 4px 14px rgba(255,255,255,0.05);
}

/* Üstteki başlık çubuğu */
.code-header {
  position: relative;
  background: var(--code-bg);
  padding: 8px 12px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

body.dark .code-header {
  background-color: #2a2a2a;
  border-bottom-color: #444;
}


/* Dil adı */
.code-language {
  font-weight: 600;
  font-size: 0.9rem;
  color: #666;
}

body.dark .code-language {
  color: #ccc;
}

/* Asıl kod alanı (pre) */
.code-block pre {
  background: transparent;;
  padding: 12px;
  margin: 0;
  position: relative;
}

/* Copy butonu */
.code-header .copy-btn {
  position: absolute;
  top: 4px;
  right: 8px;
  background-color: transparent;
  color: var(--text-color);
  border: none;
  padding: 3px 6px;
  border-radius: 4px;
  cursor: pointer;
  font-size: 0.5rem;
  opacity: 0.8;
  transition: opacity 0.3s;
  z-index: 10; /* Butonu öne çıkarmak için */
}

:root .code-header .copy-btn {
  color: var(--text-color);
}

body.dark .code-header .copy-btn {
  background-color: transparent; /* Dark mode'da şeffaf veya istediğin başka renk */
  color: var(--text-color);
}

body.dark .code-header .copy-btn:hover {
  background-color: #f0f0f0; /* Dark mode'da şeffaf veya istediğin başka renk */
  color: var(--sidebar-bg);
  opacity: 1;
}

.code-header .copy-btn:hover {
  background-color: #c0c0c0;
  opacity: 1;
}

.hljs {
  color: #333;             /* Light mod */
  background-color: none;  /* .code-block backgroundı kullan */
}
body.dark .hljs {
  color: #eee;            /* Dark modda açık metin rengi */
}

pre code {
  background: none !important;
}

/* --- Web Arama Butonu Stilleri --- */
#web-search-btn {
  position: fixed;    /* Sayfanın sol altına sabitle */
  bottom: 15px;       /* Alttan 20px boşluk */
  left: 18px;         /* Soldan 20px boşluk */
  z-index: 200;       /* Chat inputtan daha üstte veya altta olmasına göre ayarla */
  background-color: transparent;
  border: none;
  box-shadow: 
    /* Aşağıya doğru gölge */
    0 4px 6px -2px rgba(0, 0, 0, 0.15),
    /* Sağa doğru gölge */
    4px 0 6px -2px rgba(0, 0, 0, 0.15),
    /* Sola doğru gölge */
    -4px 0 6px -2px rgba(0, 0, 0, 0.15),
    /* Yukarıya doğru gölge */
    0 -4px 6px -2px rgba(0, 0, 0, 0.15);
  cursor: pointer;
  display: flex;
  align-items: center;
  color: var(--text-color);
  font-size: 1rem;
  padding: 0.5rem;
  border-radius: 12px;
  flex-shrink: 0;
}

#web-search-btn:hover {
  background-color: #c0c0c0;  /* Hover durumunda benzer kutu efekti */
}

body.dark #web-search-btn {
  color: var(--text-color);
  box-shadow: 
    /* Aşağıya doğru gölge */
    0 4px 6px -2px rgba(0, 0, 0, 0.15),
    /* Sağa doğru gölge */
    4px 0 6px -2px rgba(0, 0, 0, 0.15),
    /* Sola doğru gölge */
    -4px 0 6px -2px rgba(0, 0, 0, 0.15),
    /* Yukarıya doğru gölge */
    0 -4px 6px -2px rgba(0, 0, 0, 0.15);
}

/* Dark modda ikonu bembeyaz yap */
body.dark #web-search-btn img {
  filter: brightness(0) invert(1);
}

body.dark #web-search-btn:hover img {
  filter: none;
}

body.dark #web-search-btn:hover {
  background-color: #c0c0c0;  /* Dark modda da aynı hover efekti */
  color: var(--sidebar-bg);
}

#web-search-btn.active {
  background-color: #96bfff;
}

body.dark #send-btn.stop-state img {
  filter: brightness(0) invert(1);
}

/* Dark modda, hover durumunda ikonu normale döndür (filter sıfır) */
body.dark #send-btn.stop-state:hover img {
  filter: none;
}

/* Hover durumunda arka plan rengini #c0c0c0 yap (ara butonuyla aynı mantık) */
#send-btn.stop-state:hover {
  background-color: #c0c0c0;
}

.emoji-icon {
  width: 16px;
  height: 16px;
  margin-right: 3px;
  margin-bottom: 3px;
  vertical-align: middle;
}

@media (max-width: 768px) {
  #quik-icon {
    width: 36px; /* Küçük ekranlarda ikon boyutunu küçült */
  }
}

@media (max-width: 480px) {
  #quik-icon {
    width: 28px; /* Daha küçük ekranlarda daha da küçült */
  }
}

/* Logo için kapsayıcı */
.logo-container {
  display: flex;
  justify-content: center; /* Logoyu yatayda ortala */
}

@keyframes fadeIn {
  0% { opacity: 0; }
  100% { opacity: 1; }
}

#quik-icon {
  width: 50px; /* Varsayılan genişlik */
  height: auto; /* Oranları korumak için otomatik yükseklik */
  max-width: 50px; /* Maksimum genişlik sınırı */
  max-height: 50px; /* Maksimum yükseklik sınırı */
  vertical-align: middle;
  opacity: 0; /* İlk başta görünmeyecek */
}

body.dark #quik-icon {
  filter: brightness(0) invert(1);
}

/* Ayarlar Butonu (Sağ Üst Köşe) */
.settings-btn {
  position: fixed;
  top: 9px;
  right: 13px;
  width: 40px;
  height: 40px;
  background-color: #fff; /* Görünür olsun diye sabit renk */
  border: none;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  z-index: 1000; /* Her şeyin üstünde olsun */
}

.settings-btn img {
  width: 24px;
  height: 21px;
}

.settings-btn:hover {
  background-color: #c0c0c0;
}

body.dark .settings-btn img {
  filter: brightness(0) invert(1);
}

body.dark .settings-btn:hover img {
  filter: none;
}

body.dark .settings-btn {
  background-color: transparent;
}

body.dark .settings-btn:hover {
  background-color: #c0c0c0;
}

/* Modal Genel Ayarları */
.modal {
  display: none;
  position: fixed;
  z-index: 306;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: transparent; /* Renk tonunu tamamen kaldırdık */
  backdrop-filter: blur(4px); /* Blur efekti ekledik */
  -webkit-backdrop-filter: blur(4px); /* Safari desteği */
  animation: fadeIn 0.3s ease; /* Açılma animasyonu korundu */
}

/* Ayarlar Modal'ı İçin Genel Stil */
.modal-content {
  background-color: var(--sidebar-bg);
  margin: 10% auto;
  padding: 20px;
  border-radius: 12px;
  width: 100%;
  max-width: 500px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
  position: relative;
}


/* Kapatma Butonu */
.modal-close {
  position: absolute;
  top: 12px;
  right: 12px;
  font-size: 24px;
  cursor: pointer;
  color: var(--text-color);
}

body.dark .modal-close:hover {
  color: var(--sidebar-bg);
}

/* Başlık */
.modal-content h2 {
  margin: 0 0 20px;
  font-size: 1.5rem;
  color: var(--text-color);
}

/* Modal içindeki Dark Mode Toggle butonunun stili */
.dark-mode-toggle-modal {
  background: none;
  border: none;
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  border-radius: 12px;
}

.dark-mode-toggle-modal:hover {
  background-color: #c0c0c0;
}

body.dark .dark-mode-toggle-modal img {
  filter: invert(1);
}

body.dark .dark-mode-toggle-modal:hover img {
  filter: none;
}

body.dark .dark-mode-toggle-modal:hover {
  background-color: #c0c0c0;
  color: var(--sidebar-bg);
}

/* Genel Toggle Buton Stili (Web Arama gibi) */
.toggle-btn {
  background: none;
  border: none;
  padding: 5px 10px;
  border-radius: 8px;
  cursor: pointer;
  color: var(--text-color);
}

.toggle-btn:hover {
  background-color: #c0c0c0;
}

.toggle-state {
  font-size: 0.9rem;
}

/* Modal Arka Planı ve Animasyon */
.settings-modal {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background-color: rgba(0, 0, 0, 0.7); /* Daha koyu yarı saydam */
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.3s ease, visibility 0.3s ease;
  z-index: 999;
}
.settings-modal.show {
  opacity: 1;
  visibility: visible;
}

/* Modal İçeriği */
.settings-modal-content {
  background-color: #fff;  /* Light modda beyaz */
  width: 100%;
  max-width: 675px;
  max-height: 500px;
  margin: 50px auto;
  border-radius: 12px;
  box-shadow: 0 8px 30px rgba(0, 0, 0, 0.5);
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

body.dark .settings-modal-content {
  background-color: var(--sidebar-bg); /* ya da sidebar rengi olarak kullandığın değişken */
}

/* Header */
.settings-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding-bottom: 5px;
  padding-top: 10px;
  background-color: var(--nav-bg);
  border-bottom: 2px solid #c0c0c0;
  margin-bottom: 20px;
}
.settings-header h2 {
  font-size: 1.1rem;
  color: var(--text-color);
}

.settings-close {
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: var(--sidebar-bg);  /* Light modda sidebar rengi, örn: beyaz */
  border: none;
  width: 35px;
  height: 35px;
  top: 25px;
  right: 7px;
  border-radius: 18px;
  cursor: pointer;
  color: var(--text-color);
}

/* Hover durumunda sidebar'dakine benzer davranış */
.settings-close:hover {
  background-color: #c0c0c0;
}

body.dark .settings-close:hover {
  background-color: #c0c0c0; /* Dark modda sidebar rengi */
}


/* =========================
   SEKMELİ AYARLAR EK CSS
========================= */

/* Ayarlar gövdesi: solda menü, sağda içerik */
.settings-body {
  display: flex;
  min-height: 500px;
}

/* Sol Sekme Menüsü */
.settings-nav {
  background-color: var(--nav-bg);

}

.settings-nav ul {
  list-style: none;
  margin: 0;
  padding: 0;
}

.settings-nav li {
  padding: 10px 12px;
  margin-right: 50px;
  margin-bottom: 10px;
  cursor: pointer;
  border-bottom: 1px solid var(--border-color);
  color: var(--text-color);
  font-size: 0.8rem;
  border-radius: 8px;
  display: flex;
  justify-content: flex-start;
  min-width: 120px; /* Her durumda aynı genişlik */
  font-weight: 600; /* Normalde biraz daha kalın yaparak değişimi minimize et */
  text-rendering: optimizeLegibility;
  align-items: center;
  gap: 8px; /* Yazıyla ikon arasında boşluk bırak */
}

.settings-nav li .settings-icon {
  width: 14px; /* İkon boyutu */
  height: 14px;
  flex-shrink: 0; /* Küçük ekranlarda bile ikonu küçültme */
}

/* Dark modda tüm ikonlar beyaz olur */
body.dark .settings-nav li .settings-icon {
  filter: invert(1);
}

/* AMA! Eğer aktif (seçili) sekmeyse ikon eski renginde kalmalı */
body.dark .settings-nav li.active .settings-icon,
body.dark .settings-nav li:hover .settings-icon {
  filter: none; /* Dark modda aktif ve hover durumundaki ikon değişmez */
}

.settings-nav li:hover {
  background-color: #c0c0c0;
  font-weight: 600;
}

body.dark .settings-nav li:hover {
  color: var(--sidebar-bg);
  font-weight: 600;
}

.settings-nav li.active {
  background-color: #c0c0c0;
  font-weight: 700;
  color: var(--text-color);
}

body.dark .settings-nav li.active {
  background-color: #c0c0c0;
  font-weight: 600;
  color: var(--sidebar-bg);
}

/* Sağ içerik */
.settings-content {
  flex: 1;
  background-color: var(--modal-bg);
  overflow-y: auto;
  padding-top: 0; /* Üst boşluğu sıfırlayabilirsiniz */
}

/* Sekme içeriğini gizle/göster */
/* Varsayılan olarak tüm sekmeleri gizle */
.tab-content {
  display: none;
  position: absolute; /* Sekmelerin üst üste binmesini önler */
  width: 100%; /* İçeriği tam oturtur */
  top: 0;
  left: 0;
}

/* Sadece aktif olan sekmeyi göster */
.tab-content.active {
  display: block !important;
  position: relative; /* Çakışmayı engeller */
}

/* Açıklayıcı Metin Stili */
.setting-description {
  padding-bottom: 0.5rem; /* Çizgiyle metin arasında boşluk */
  border-bottom: 1px solid var(--code-border); /* Mevcut çizgi mantığı */
}

/* Bildirimler Sekmesinde Açıklama ile Üstteki Ayar Arasındaki Boşluk */
#bildirimler .setting-description {
  margin-top: 0.5rem;
}

.setting-description p {
  margin: 0;
  font-size: 0.8rem; /* Biraz daha büyük ve okunabilir */
  color: var(--text-color);
  line-height: 2;
}

.note-text {
  font-size: 0.8rem; /* Boyutu biraz artırdık */
  font-style: italic; /* Eğik stil ekledik */
  color: var(--accent-color);
}

.setting-description .note-text {
  font-size: 0.8rem; /* Not kısmı daha küçük */
  color: var(--accent-color); /* Hafif gri ton (örneğin #6c757d) */
}

.progress-container {
  display: flex;
  flex-direction: column;
  align-items: flex-end; /* Sağ hizalı */
  width: 100%; /* Tam genişlik */
  margin-top: 10px; /* Üst boşluk */
}

.progress-bar {
  width: 100%;
  height: 30px;
  background-color: #e0e0e0; /* Arka plan rengi */
  border-radius: 8px;
  overflow: hidden;
  margin-bottom: 5px; /* Butonla aralık */
  position: relative; /* Çocuk eleman için referans */
}

.progress-bar-fill {
  height: 100%;
  border-radius: 8px;
  transition: width 0.3s ease; /* Yumuşak geçiş */
  text-align: center;
  color: #fff;
  font-size: 0.8rem;
  line-height: 30px; /* Yükseklikle uyumlu */
}

body.dark .progress-bar {
  background-color: #444; /* Dark modda arka plan */
}

.progress-text {
  font-size: 0.8rem;
  color: var(--text-color-secondary, #666); /* Varsayılan renk, temana göre değişebilir */

}

body.dark .progress-text {
  color: #bbb; /* Dark modda daha açık renk */
}

/* Maddeler Listesi Stili */
.description-list {
  list-style-type: disc; /* Maddeler için yuvarlak işaret */
}

.description-list li {
  font-size: 0.8rem; /* Mevcut metin boyutuyla uyumlu */
  color: var(--text-color); /* Mevcut renk uyumluluğu */

}

/* Maddelerin Başlık Stili */
.description-title {
  font-size: 0.8rem; /* Daha büyük font boyutu */
  font-weight: 600; /* Orta kalınlık (bold'dan daha az yoğun) */
  color: var(--text-color); /* Vurgu rengi (örneğin mavi) */
}

/* List Item Genel Stilini Güncelle (isteğe bağlı) */
.description-list li {
  font-size: 0.8rem; /* Maddelerin geri kalanı için mevcut boyut */
  color: var(--text-color); /* Metin rengi */
  line-height: 1.5; /* Satır aralığı */
  margin-bottom: 0.25rem; /* Maddeler arası boşluk */
}

/* Dark Mode için Renk Ayarları */
body.dark .description-list li {
  color: var(--text-color); /* Dark mode'da metin rengi */
}

/* Dark Mode için Renk Ayarları */
body.dark .setting-description {
  border-bottom: 1px solid var(--code-border); /* Dark mode'da çizgi rengi */
}

body.dark .setting-description p {
  color: var(--text-color); /* Dark mode'da metin rengi */
}

body.dark .setting-description .note-text {
  color: #adb5bd; /* Dark mode'da not için açık gri */
}

/* Sadece örnek: .settings-list, .setting-item vb. 
   Senin mevcut CSS’inde varsa dokunma, yoksa ekleyebilirsin. */

.settings-list {
  list-style: none;
  margin: 0;
  padding: 0;
  display: flex;
  flex-direction: column;
}

.setting-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  border-bottom: 1px solid var(--code-border);
  /* Ekstra margin veya padding ayarlarını burada düzenleyebilirsin */
}

.setting-item label {
  font-size: 0.8rem;
  font-weight: bold;
  color: var(--text-color);
}

/* Yeni Label Stili */
.setting-label {
  font-size: 0.9rem;
  color: var(--text-color);
  font-weight: 600;
  margin-bottom: 0.5rem;
  display: block;
}

/* Textarea Güzelleştirme */
.setting-item textarea {
  width: 100%;
  max-width: 100%;
  background-color: var(--input-bg);
  color: var(--text-color);
  border: 1px solid var(--code-border);
  border-radius: 8px;
  padding: 12px; /* Artırılmış iç boşluk */
  font-size: 0.8rem;
  font-family: 'Inter', sans-serif;
  resize: none;
  box-sizing: border-box;
  font-weight: 500; /* Hafif kalın yazı */
  transition: box-shadow 0.3s ease, border-color 0.3s ease;
}

.setting-item textarea:focus {
  outline: none;
  border-color: var(--primary-color);
  box-shadow: 0 4px 8px rgba(0, 123, 255, 0.2); /* Odaklandığında gölge artışı */
}

/* Placeholder metninin boyutunu ayarlama */
.setting-item textarea::placeholder {
  font-size: 0.8rem;
  color: var(--accent-color); /* Mevcut renk mantığını koru */
  opacity: 0.5; /* Hafif saydamlık */
}

/* Dark Mode uyumu */
body.dark .setting-item textarea::placeholder {
  color: #adb5bd; /* Dark mode'da okunabilir gri */
}

.setting-item textarea:focus::placeholder {
  opacity: 0.5;
}

/* Kaydet Butonu Güzelleştirme */
.save-btn {
  background: linear-gradient(90deg, #007bff, #0056b3); /* Gradient efekti */
  color: #fff;
  padding: 8px 16px;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  display: flex;
  align-items: center;
  border: none;
  transition: transform 0.3s ease, background 0.3s ease;
}

.save-btn:hover {
  background: linear-gradient(90deg, #0056b3, #003d80); /* Hover'da koyulaşma */
  transform: scale(1.05); /* Hafif büyüme */
}

.save-btn:active {
  transform: scale(0.98); /* Tıklama efekti */
}

body.dark .save-btn {
  background: linear-gradient(90deg, #0a84ff, #0066cc); /* Dark mode için gradient */
}

body.dark .save-btn:hover {
  background: linear-gradient(90deg, #0066cc, #004d99); /* Dark mode hover */
}

/* İkon Stili */
.save-icon {
  margin-right: 5px;
  vertical-align: middle;
  filter: brightness(0) invert(1); /* Dark mode'da beyaz */
}

body.dark .save-icon {
  filter: none; /* Dark mode'da orijinal renk */
}

body.dark .save-icon:hover {
  filter: brightness(0) invert(1); /* Hover'da tersine çevirme */
}

.setting-item p {
  margin: 0;
  line-height: 1.4;
}

body.dark .setting-item textarea {
  color: #fff;
  border-color: #444;
}

.save-button-container {
  display: flex;
  justify-content: flex-start; /* Buton sağa hizalı */
  margin-top: 0; /* Butonu alta yasla */
}

#save-personalization {
  background-color: transparent;
  color: #000000;
  padding: 8px 16px;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  border: 1px solid rgba(0, 0, 0, 0.2); /* Hafif opak, ince border */
}

body.dark #save-personalization {
  border: 1px solid rgba(255, 255, 255, 0.2);
  background-color: transparent;
  color: #fff;
}

#save-personalization:hover {
  background-color: #c0c0c0;
}

body.dark #save-personalization:hover {
  background-color: #c0c0c0;
  color: #000000;
}

/* Toggle Switch (ChatGPT Benzeri) */
.switch, .toggle-btn {
  position: relative;
  display: inline-block;
  width: 50px;
  height: 30px;
}
.switch input, .toggle-btn input {
  opacity: 0;
  width: 0;
  height: 0;
}
.slider {
  position: absolute;
  cursor: pointer;
  top: 0; left: 0;
  right: 0; bottom: 0;
  background-color: #5a5b68;
  border-radius: 24px;
}
.slider:before {
  position: absolute;
  content: "";
  height: 18px;
  width: 18px;
  left: 3px;
  bottom: 3px;
  background-color: #fff;
  border-radius: 50%;
}
input:checked + .slider {
  background-color: var(--primary-color);
}
input:checked + .slider:before {
  transform: translateX(18px);
}

/* Buton (Örneğin tehlikeli butonlar) */
.danger-btn {
  background-color: #ff4b4b;
  border: none;
  color: #fff;
  padding: 7px 12px;
  border-radius: 8px;
  cursor: pointer;
  transition: background-color 0.3s;
  align-self: flex-start;
  margin-top: 12px;
  margin-bottom: 8px;
}
.danger-btn:hover {
  background-color: #ff6666;
}

/* Select (Dil seçimi vs.) */
.setting-row select {
  width: 100%;
  max-width: 200px;
  padding: 8px;
  font-size: 0.9rem;
  border-radius: 8px;
  border: 1px solid var(--code-border);
  background-color: var(--input-bg);
  color: var(--text-color);
  cursor: pointer;
}
body.dark .setting-row select {
  border-color: #444;
  background-color: #1e1e1e;
}
.theme-selection {
  display: flex;
  gap: 1rem;
}

.theme-selection .theme-btn {
  cursor: pointer;
  flex: 1;
  padding: 0.5rem;
  display: flex;
  align-items: center;
  justify-content: center;
  border: 1px solid var(--code-border);
  border-radius: 8px;
  background-color: var(--sidebar-bg);
  color: var(--text-color);
  font-weight: 600;
  box-sizing: border-box;
}

.theme-selection .theme-btn:hover,
.theme-selection .theme-btn.active {
  background-color: #c0c0c0;
}

.theme-selection .theme-btn .theme-icon {
  width: 11px;  /* veya ihtiyaç varsa 14px; kararınıza bağlı */
  height: 11px;
  margin-right: 0.5rem;
  object-fit: contain;
}

/* Dark mod için: */
body.dark .theme-selection .theme-btn {
  background-color: var(--sidebar-bg);
  border-color: #444;
  color: white; /* veya istediğiniz renk */
}

body.dark .theme-selection .theme-btn:hover,
body.dark .theme-selection .theme-btn.active {
  background-color: #c0c0c0;
  color: var(--sidebar-bg);
}

body.dark .theme-selection .theme-btn .theme-icon {
  filter: invert(1);
}

body.dark .theme-selection .theme-btn.active .theme-icon,
body.dark .theme-selection .theme-btn:not(.active):hover .theme-icon {
  filter: none;
}

/* Bildirim Switch Toggle Butonu */
.notification-switch {
  position: relative;
  display: inline-block;
  width: 40px; /* Daha küçük hale getirdik */
  height: 20px; /* Daha ince bir görünüm sağladık */
  vertical-align: middle; /* Metinle hizala */
}

.notification-switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

.notification-slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: #c0c0c0;
  transition: 0.3s;
  border-radius: 22px;
}

.notification-slider:before {
  position: absolute;
  content: "";
  height: 14px; /* Küçültüldü */
  width: 14px;
  left: 2px;
  bottom: 3px;
  background-color: white;
  transition: transform 0.2s ease-in-out;
  border-radius: 50%;
}

input:checked + .notification-slider {
  background-color: #000000; /* Açık olduğunda mavi renk */
}

input:checked + .notification-slider:before {
  transform: translateX(22px); /* Buton açılınca tam kayacak */
}

/* Dark Mode Ayarları */
body.dark .notification-slider {
  background-color: #444;
}

body.dark input:checked + .notification-slider {
  background-color: #10a37f;
}

/* Web Arama Buton Grubu */
.web-search-toggle-group {
  display: flex;
  gap: 1rem;
}

/* Web Arama Butonları */
.web-search-toggle-group .web-search-btn {
  flex: 1;  /* Butonlar eşit genişlikte olacak */
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0.5rem;
  border: 1px solid var(--code-border);
  border-radius: 8px;
  background-color: var(--sidebar-bg);
  color: var(--text-color);
  font-size: 0.8rem;
  font-weight: 600;
  box-sizing: border-box;
  cursor: pointer;
}

/* Hover ve aktif durum: */
.web-search-toggle-group .web-search-btn:hover,
.web-search-toggle-group .web-search-btn.active {
  background-color: #c0c0c0;
}

/* Web Arama Butonundaki İkon */
.web-search-toggle-group .web-search-btn .web-search-icon {
  width: 14px;
  height: 14px;
  margin-right: 0.5rem;
  object-fit: contain;
}

/* Dark Mode için */
body.dark .web-search-toggle-group .web-search-btn {
  background-color: var(--sidebar-bg);
  border-color: #444;
  color: var(--text-color);
}

body.dark .web-search-toggle-group .web-search-btn:hover,
body.dark .web-search-toggle-group .web-search-btn.active {
  background-color: #c0c0c0;
  color: var(--sidebar-bg);
}

body.dark .web-search-toggle-group .web-search-btn .web-search-icon {
  filter: brightness(0) invert(1);
}

body.dark .web-search-toggle-group .web-search-btn:not(.active):hover .web-search-icon {
  filter: none;
}

.web-search-toggle-group .web-search-btn.active .web-search-icon {
  filter: none !important;
}

/* Tablo Stilleri */
table {
  width: 100%;
  border-collapse: collapse;
  margin-bottom: 1.5rem;
  background-color: var(--sidebar-bg);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  border-radius: 8px;
  overflow: hidden;
}

th, td {
  padding: 12px 16px;
  text-align: left;
  border-bottom: 1px solid var(--code-border);
}

th {
  background-color: var(--code-bg);
  font-weight: 600;
  color: var(--text-color);
}

td {
  color: var(--text-color);
}

tr:last-child td {
  border-bottom: none;
}

/* Dark Mode için Tablo Stilleri */
body.dark table {
  background-color: var(--input-bg);
  box-shadow: 0 2px 8px rgba(192, 192, 192, 0.1);
}

body.dark th {
  background-color: #2a2a2a;
  color: #e0e0e0;
}

body.dark td {
  color: #e0e0e0;
}

/* Responsive Tablo */
@media (max-width: 768px) {
  table {
    font-size: 0.9rem;
  }
  th, td {
    padding: 8px 12px;
  }
}

    /* Model Seçici Stilleri */
    .model-selector {
      position: fixed;
      top: 7px;
      left: 60px;
      z-index: 101;
    }
    .model-toggle-btn {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background-color: var(--sidebar-bg);
      border: none;
      border-radius: 12px;
      cursor: pointer;
      padding-left: 5px;
      color: var(--text-color);
      font-size: 1rem;
      font-weight: 750;
      height: 40px;
      margin-top: 2px;
      min-width: 110px;
    }
    .model-toggle-btn:hover {
      background-color: #c0c0c0;
    }
    body.dark .model-toggle-btn {
      background-color: var(--bg-color);
    }
    body.dark .model-toggle-btn:hover {
      background-color: #c0c0c0;
      color: var(--sidebar-bg);
    }
    body.dark .model-toggle-btn img {
      filter: brightness(0) invert(1);
    }
    body.dark .model-toggle-btn:hover img {
      filter: none;
    }
    .model-dropdown {
      display: none;
      position: absolute;
      top: 45px;
      left: 0;
      background-color: var(--input-bg);
      border-radius: 6px;
      min-width: 118px;
      z-index: 305;
      box-shadow: 0 0 8px rgba(192, 192, 192, 0.75);
    }
    
    body.dark .model-dropdown {
      box-shadow: none;
    }

    .model-dropdown.show {
      display: block;
    }
.model-option {
  background: none;
  border: none;
  width: 100%;
  padding: 10px 5px;
  text-align: left;
  cursor: pointer;
  display: flex;
  flex-direction: column;
  gap: 4px;
  color: var(--text-color);
  transition: background-color 0.2s ease, color 0.2s ease; /* Renk geçişi için transition eklendi */
  border-radius: 12px;
}

.model-option:hover {
  background: #c0c0c0;
}

/* Model Adı */
.model-name {
  font-size: 1rem;
  font-weight: 600;
}

/* Model Açıklaması */
.model-description {
  font-size: 0.8rem;
  color: var(--accent-color);
  font-weight: 400;
}

/* Dark Mode Hover Durumu */
body.dark .model-option:hover {
  background-color: #c0c0c0; /* Mevcut hover arka plan rengi korundu */
  color: var(--sidebar-bg); /* Model adı rengi */
}

body.dark .model-option:hover .model-name {
  color: var(--sidebar-bg); /* Model adı için özel renk */
}

body.dark .model-option:hover .model-description {
  color: var(--sidebar-bg); /* Model açıklaması için özel renk */
}

/* Dark Mode Genel Durum */
body.dark .model-description {
  color: #adb5bd; /* Normal durumda açık gri */
}

.typing-indicator {
  display: inline-flex;
  align-items: center;
  gap: 4px;
}

.typing-indicator span {
  display: block;
  width: 8px;
  height: 8px;
  background-color: var(--text-color);
  border-radius: 50%;
  animation: bounce 1.4s infinite ease-in-out;
}

.typing-indicator span:nth-child(1) {
  animation-delay: 0s;
}

.typing-indicator span:nth-child(2) {
  animation-delay: 0.2s;
}

.typing-indicator span:nth-child(3) {
  animation-delay: 0.4s;
}

@keyframes bounce {
  0%, 80%, 100% {
    transform: scale(0);
  }
  40% {
    transform: scale(1);
  }
}

/* Feedback Kontrolleri */
.feedback-controls {
  display: inline-flex;
  gap: 0.5rem;
  padding: 0;
  opacity: 0; /* Varsayılan olarak gizli */
  margin-left: -7px;
  z-index: 300; /* Chat-input’un (302) altında */
  transition: opacity 0.2s ease; /* Pürüzsüz geçiş */
}

.assistant-bubble:hover .feedback-controls {
  opacity: 1; /* Mesajın üzerine gelince görünür */
}

.assistant-bubble a {
  color: var(--text-color);
}

.feedback-controls button {
  border: none;
  background: var(--sidebar-bg);
  border-radius: 6px;
  cursor: pointer;
  font-size: 1rem;
  color: var(--text-color);
  display: flex;
  align-items: center;
  justify-content: center;
  width: 30px;
  height: 30px;
  z-index: 300; /* Chat-input’un altında */
  position: relative; /* Tooltip için gerekli */
  transition: background 0.2s ease; /* Hover geçişi */
}

.feedback-controls button:hover {
  background: #c0c0c0;
}

.feedback-controls button:active {
  transform: translateY(0); /* Aktif durumda hareket yok */
}

/* Dark Mode için Buton Stilleri */
body.dark .feedback-controls button {
  background: transparent; /* Dark modda arka plan şeffaf */
  color: #c0c0c0;
  box-shadow: none;
}

body.dark .feedback-controls button:hover {
  background: #c0c0c0;
}

/* İkonların Dark Mode Ayarları */
body.dark .feedback-controls button img {
  filter: brightness(0) invert(1); /* Beyaz ikonlar */
}

body.dark .feedback-controls button:hover img {
  filter: none; /* Hover’da orijinal renk */
}

/* Kopyalandı Durumu */
.feedback-controls button.copied {
  background: transparent;
  color: #004085;
}

.feedback-controls button.copied:hover {
  background: #c0c0c0;
}

.feedback-controls button.copied img {
  filter: none; /* Kopyalandı ikonunu orijinal haliyle bırak */
}

/* Animasyonlu Durumlar */
.feedback-controls button.copied,
.feedback-controls button.liked,
.feedback-controls button.disliked {
  animation: pulse 0.3s ease;
}

/* Tooltip Stilleri */
.feedback-controls button[data-tooltip]::after {
  content: attr(data-tooltip);
  position: absolute;
  background-color: #1e1e1e; /* Sabit koyu arka plan */
  color: #fff; /* Sabit beyaz metin */
  padding: 7px 7px; /* Daha geniş iç boşluk */
  border-radius: 8px;
  font-size: 0.7rem; /* Daha okunabilir font boyutu */
  font-family: 'Inter', sans-serif;
  white-space: nowrap; /* Tek satırda tut */
  text-align: center; /* Metni ortala */
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.2s ease, transform 0.2s ease; /* Sidebar tarzı geçiş */
  z-index: 310; /* Feedback kontrollerinden üstte */
  pointer-events: none; /* Tooltip’in hover’ı engellemesini önler */
  margin-top: 8px;
}

.feedback-controls button[data-tooltip]:hover::after {
  opacity: 1;
  visibility: visible;
}

/* Dark Mode için Tooltip Ayarları */
body.dark .feedback-controls button[data-tooltip]::after {
  background-color: #1e1e1e; /* Koyu modda biraz daha açık gri */
  color: #fff; /* Beyaz metin */
}

/* Pulse Animasyonu */
@keyframes pulse {
  0%, 50%, 100% {
    transform: scale(1);
  }
}

/* Özel Tooltip Stilleri */
[data-tooltip] {
  position: relative;
  cursor: pointer;
  z-index: 10001; /* Butonun kendi z-index’i */
}

/* Tooltip pozisyonunu ayarlama */
[data-tooltip]::after {
  content: attr(data-tooltip);
  position: absolute;
  top: 100%; /* Butonun hemen altına */
  left: 50%;
  transform: translateX(-50%);
  background-color: #333;
  color: #fff;
  padding: 8px 11px;
  border-radius: 8px;
  font-size: 0.8rem;
  font-weight: 500;
  white-space: nowrap;
  opacity: 0; /* Varsayılan olarak gizli */
  visibility: hidden; /* Görünmez */
  transition-property: opacity;
  transition-timing-function: ease;
  transition-delay: 0.5s;
  z-index: 10000; /* Her şeyin üstünde */
  pointer-events: none;
}

/* Hover durumunda görünüm (JS ile kontrol edilecek) */
[data-tooltip].show-tooltip::after {
  opacity: 1;
  visibility: visible;
  transform: var(--tooltip-transform, translateX(-50%) translateY(5px));
}

/* Dark Mode */
body.dark [data-tooltip]::after {
  background-color: #e0e0e0;
  color: #333;
}

/* Hover durumunda görünüm */
[data-tooltip]:hover::after {
  opacity: 1;
  visibility: visible;
  transform: var(--tooltip-transform, translateX(-50%) translateY(5px)); /* Varsayılan transform */
}

/* Sidebar aç/kapa butonu için özel tooltip konumlandırması */
#toggle-sidebar-btn[data-tooltip]::after {
  top: 50% !important;
  left: calc(100% + 8px) !important;
  transform: translateY(-50%) !important;
}

.settings-btn[data-tooltip] {
  position: fixed;
}

/* ==============================
   BİLDİRİMLER SEKMESİ YENİ CSS
============================== */

/* Bildirimler sekmesinin ana kapsayıcısı */
.notifications-container {
  display: flex;
  flex-direction: column;
  gap: 1rem;           /* Kartlar arasında boşluk */
}

/* Her bildirim ayarı için “kart” görünümü */
.notification-card {
  background-color: var(--sidebar-bg);
  border: 1px solid var(--code-border);
  border-radius: 12px;
  padding: 1rem;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

/* Kart üst kısmı (ikon, isim, toggle) */
.notification-header {
  display: flex;
  align-items: center;
  justify-content: space-between; /* Sağda toggle, solda başlık+ikon */
}

/* Başlık + ikon yan yana */
.notification-heading-left {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

/* İkon boyutu */
.notification-icon {
  width: 18px;
  height: 18px;
  object-fit: contain;
  filter: none; /* Dark mod için isterseniz invert(1) ekleyebilirsiniz */
}

/* Bildirim ayarının adı */
.notification-name {
  font-size: 0.8rem;
  font-weight: 600;
  color: var(--text-color);
}

/* Açıklama metni */
.notification-description {
  font-size: 0.8rem;
  color: var(--text-color);
  line-height: 1.5;
  margin: 0;
}

/* Dark mode düzenlemeleri */
body.dark .notification-card {
  background-color: var(--sidebar-bg); /* Ör: #1e1e1e */
  border-color: #444;
}

body.dark .notification-icon {
  filter: brightness(0) invert(1); /* İkonu beyaz yapmak için */
}

/* GENEL SEKMESİ (Kart Mantığı) */
.general-container {
  display: flex;
  flex-direction: column;
  gap: 1rem;           /* Kartlar arasında boşluk */
  width: 100%;
  box-sizing: border-box;
}

/* Kart Yapısı */
.general-card {
  width: 100%;
  background-color: var(--sidebar-bg);
  border: 1px solid var(--code-border);
  border-radius: 12px;
  padding: 1rem;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  box-sizing: border-box;
}

/* Kart üst kısmı (ikon + başlık) */
.general-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
}

/* Sol tarafta ikon + başlık ismi */
.general-heading-left {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

/* İkon boyutu */
.general-icon {
  width: 18px;
  height: 18px;
  object-fit: contain;
}

/* Ayar adı (ör. "Görünüm", "Web Arama", "Dil Seçimi") */
.general-name {
  font-size: 0.8rem;
  font-weight: 600;
  color: var(--text-color);
}

/* Açıklama metni */
.general-description {
  font-size: 0.8rem;
  color: var(--text-color);
  line-height: 1.5;
  margin: 0;
}

/* Dark Mode Düzenlemeleri */
body.dark .general-card {
  background-color: var(--sidebar-bg);
  border-color: #444;
}

body.dark .general-icon {
  filter: brightness(0) invert(1); /* İkonu beyaz yapmak isterseniz */
}

/* Dropdown (Select) Stili */
.language-selection select {
  width: 100%;
  padding: 0.5rem;
  border: 1px solid var(--code-border);
  border-radius: 8px;
  font-size: 0.8rem;
  font-weight: bold;
  background-color: #c0c0c0;
  color: var(--text-color);
  transition: border-color 0.3s ease;
  box-sizing: border-box;
}

/* Dark Mode için */
body.dark .language-selection select {
  background-color: #c0c0c0;
  border-color: #444;
  color: #000000;
}

/* Personalization (Statik Prompt) Girişi */
.personalization-input textarea {
  width: 100%;
  padding: 0.75rem;
  border: 1px solid var(--code-border);
  border-radius: 8px;
  font-size: 0.8rem;
  font-family: 'Inter', sans-serif;
  background-color: var(--input-bg);
  color: var(--text-color);
  resize: none;
  box-sizing: border-box;
}

.personalization-input textarea:focus {
  outline: none;
  border-color: var(--primary-color);
}

body.dark .personalization-input textarea {
  background-color: var(--input-bg);
  border-color: #444;
  color: #e0e0e0;
}

body.dark .theme-btn {
  background-color: var(--bg-color);
  border-color: #444;
  color: white;
}
body.dark .theme-btn:hover,
body.dark .theme-btn.active {
  background-color: #c0c0c0;
  color: var(--sidebar-bg);
}

.data-control-card {
  display: flex;
  flex-direction: column; /* İçerik dikey olarak dizilsin */
  padding: 16px; /* Daha geniş iç boşluk */
  background-color: var(--input-bg);
  border: 1px solid var(--code-border);
  border-radius: 12px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
}

.data-control-card .description-list {
  display: block;
  justify-content: space-between;
  align-items: center;
  width: 100%;
}

.data-control-card .danger-btn {
  margin: 10px 0; /* Butonun üstünde ve altında boşluk */
  align-self: flex-start; /* Sola hizalı */
}

.data-control-card p {
  margin: 0;
  font-size: 0.8rem;
  color: var(--text-color);
}

body.dark .data-control-card {
  background-color: #1e1e1e;
  border-color: #444;
  box-shadow: 0 2px 4px rgba(255, 255, 255, 0.05);
}

.general-count {
  font-size: 0.9rem;
}

  </style>
</head>

<body>
  <!-- Sabit Toggle Sidebar Butonu -->
  <button id="toggle-sidebar-btn">
    <img src="icons/sidebar_close_btn.png" alt="Sidebar Icon" style="width:24px; height:21px;">
  </button>

<!-- Yeni Model Seçme Alanı -->
<div id="model-selector" class="model-selector">
  <button id="model-toggle-btn" class="model-toggle-btn">
    <span id="current-model-name">Quik-Prime</span>
    <img src="icons/quik_icon.png" alt="Dropdown Arrow" style="width:16px; height:16px; margin-left: 5px;">
  </button>
  <div id="model-dropdown" class="model-dropdown">
    <button class="model-option" data-model="quik-prime">
      <span class="model-name">Quik-Prime</span>
      <span class="model-description">Günlük ve hızlı</span>
    </button>
    <button class="model-option" data-model="quik-think">
      <span class="model-name">Quik-Think</span>
      <span class="model-description">Mantık ve analiz</span>
    </button>
  </div>
</div>


  <div id="app">
  <!-- Sidebar -->
  <div id="sidebar" class="sidebar">
<div class="sidebar-header">
  <span class="brand" id="sidebar-brand">
    <img src="icons/quik_icon.png" alt="Quik Logo" id="sidebar-brand-icon">
  </span>
</div>
    <button id="new-chat-btn" data-tooltip="Yeni Sohbet" class="new-chat-btn">
      <img src="icons/new_chat_btn.png" alt="Chat Icon" style="width:21px; height:21px;">
    </button>
    <ul id="chat-history-list" class="chat-history-list"></ul>
  </div>
  
  <!-- Main İçerik -->
  <div class="main-content">
    <div class="top-bar">
      <!-- Top bar içerikleri (varsa) -->
    </div>
    
    <div class="scroll-wrapper">
      <div id="chat-container" class="chat-container">
<div id="welcome-message" class="welcome-message">
  <div class="logo-container">
  </div>

  <h1>Nasıl yardımcı olabilirim?</h1>
</div>

        <!-- Diğer mesajlar buraya eklenir -->
      </div>
    </div>
  </div>
</div>

<div class="chat-input">
  <!-- Yeni Web Arama Butonu -->
<button id="web-search-btn" data-tooltip="Web Araması">
  <img src="icons/web_search_btn.png" alt="Web Search Icon" style="width:19px; height:19px; vertical-align: middle; margin-right: 5px;">
  <span>Ara</span>
</button>
  
  <textarea id="chat-input-textarea" placeholder="Quik uygulamasına ileti gönder..."></textarea>
<button id="send-btn" class="send-btn" data-tooltip="Gönder">
  <img src="icons/send_btn.png" alt="Send Icon" style="width:17px; height:17px;">
</button>
</div>

<!-- Ayarlar Butonu -->
<button id="settings-btn" data-tooltip="Ayarlar" class="settings-btn">
  <img src="icons/settings_icon.png" alt="Settings Icon" style="width:24px; height:21px;">
</button>

<!-- Ayarlar Modal'ı (GÜNCELLENMİŞ, Estetik) -->
<div id="settings-modal" class="modal">
  <div class="modal-content settings-modal-content">
    <!-- Kapat Butonu -->
    <span id="settings-close" class="modal-close settings-close">&times;</span>
    <!-- Başlık -->
    <div class="settings-header">
      <h2>Ayarlar</h2>
    </div>

    <!-- Ayarlar Gövdesi -->
    <div class="settings-body">
      <!-- SOL: Sekme Menüsü -->
      <nav class="settings-nav" aria-label="Ayar Kategorileri">
        <ul>

  <li class="active" data-tab="genel">
    <img src="icons/genel.png" class="settings-icon" alt="Genel">
    Genel
  </li>

  <li data-tab="bildirimler">
    <img src="icons/bildirimler.png" class="settings-icon" alt="Bildirimler">
    Bildirimler
  </li>

<li data-tab="kisisellestirme">
    <img src="icons/kisisellestirme.png" class="settings-icon" alt="Kişiselleştirme">
    Kişiselleştirme
  </li>

<li data-tab="konusma">
    <img src="icons/konusma.png" class="settings-icon" alt="Konuşma">
    Konuşma
  </li>

<li data-tab="gecmis">
    <img src="icons/gecmis.png" class="settings-icon" alt="Geçmiş">
    Geçmiş
  </li>
          <li data-tab="yapiciprofili">Yapıcı Profili</li>
          <li data-tab="bagliuygulamalar">Bağlı Uygulamalar</li>
          <li data-tab="abonelik">Abonelik</li>
        </ul>
      </nav>

      <!-- SAĞ: Sekme İçerikleri -->
      <div class="settings-content">


<!-- GENEL Sekmesi (YENİ) -->
<div class="tab-content active" id="genel">
  <div class="general-container">

    <!-- 1. Kart: Görünüm -->
<div class="general-card">
  <div class="card-topbar">
    <div class="general-heading-left">
      <img src="icons/appearance.png" alt="Görünüm" class="general-icon">
      <span class="general-name">Görünüm</span>
    </div>
  </div>
  <p class="general-description">
    Tema seçimini buradan yapabilirsiniz.
  </p>
  <div class="theme-selection">
    <button id="light-mode-btn" class="theme-btn">
      <img src="icons/aydinlik.png" alt="Aydınlık Mod" class="theme-icon">
      Aydınlık
    </button>
    <button id="dark-mode-btn" class="theme-btn">
      <img src="icons/karanlik.png" alt="Karanlık Mod" class="theme-icon">
      Karanlık
    </button>
    <button id="system-mode-btn" class="theme-btn">
      <img src="icons/sistem.png" alt="Sistem Modu" class="theme-icon">
      Sistem
    </button>
  </div>
</div>

    <!-- 2. Kart: Web Arama -->
    <div class="general-card">
      <div class="general-header">
        <div class="general-heading-left">
          <img src="icons/web_search.png" alt="Web Arama" class="general-icon">
          <span class="general-name">Web Arama</span>
        </div>
      </div>
      <p class="general-description">
        Web aramasını açıp kapatabilir veya devre dışı bırakabilirsiniz.
      </p>
<div class="web-search-toggle-group">
  <button id="web-search-on-btn" class="web-search-btn active">
    <img src="icons/web_search_btn.png" alt="Web Açık" class="web-search-icon">
    Açık
  </button>
  <button id="web-search-off-btn" class="web-search-btn">
    <img src="icons/web_search_btn_cancel.png" alt="Web Kapalı" class="web-search-icon">
    Kapalı
  </button>
  <button id="web-search-disable-btn" class="web-search-btn">
    <img src="icons/web_search_disable.png" alt="Devre Dışı" class="web-search-icon">
    Devre Dışı
  </button>
</div>
</div>

<!--3. Kart: Dil Seçimi Kartı -->
<div class="general-card">
  <div class="card-topbar">
    <div class="general-heading-left">
      <img src="icons/language.png" alt="Dil Seçimi" class="general-icon">
      <span class="general-name">Dil Seçimi</span>
    </div>
  </div>
  <p class="general-description">
    Uygulama arayüzü için tercih ettiğiniz dili seçin.
  </p>
  <div class="language-selection">
    <select id="language-select">
      <option value="tr">Türkçe</option>
      <option value="en">English</option>
      <option value="es">Español</option>
      <option value="fr">Français</option>
      <!-- Diğer diller ekleyebilirsiniz -->
    </select>
  </div>
</div>


  </div> <!-- /general-container -->
</div>

<!-- BİLDİRİMLER Sekmesi (YENİ) -->
<div class="tab-content" id="bildirimler">
  <!-- Konteyner: Tüm bildirim ayarlarını saran ana kapsayıcı -->
  <div class="notifications-container">

    <!-- 1. Kart: Anlık mesaj bildirimi -->
    <div class="notification-card">
      <div class="notification-header">
        <!-- İkon (opsiyonel) -->
        <div class="notification-heading-left">
          <img src="icons/notification.png" alt="Bildirim" class="notification-icon">
          <span class="notification-name">Anlık mesaj bildirimi</span>
        </div>

        <!-- Switch (Toggle) -->
        <label class="notification-switch">
          <input type="checkbox" id="toggle-unread-messages" checked>
          <span class="notification-slider"></span>
        </label>
      </div>
      <p class="notification-description">
        Okunmamış mesajları uygulama üzerinden haber verir.
      </p>
    </div>

    <!-- 2. Kart: Masaüstü bildirimi -->
    <div class="notification-card">
      <div class="notification-header">
        <div class="notification-heading-left">
          <img src="icons/desktop_notification.png" alt="Masaüstü" class="notification-icon">
          <span class="notification-name">Masaüstü bildirimi</span>
        </div>

        <label class="notification-switch">
          <input type="checkbox" id="toggle-desktop-notifications" checked>
          <span class="notification-slider"></span>
        </label>
      </div>
      <p class="notification-description">
        Okunmamış mesajları masaüstünden haber verir.
      </p>
    </div>

    <!-- 3. Kart: E-posta bildirimi -->
    <div class="notification-card">
      <div class="notification-header">
        <div class="notification-heading-left">
          <img src="icons/email_notification.png" alt="E-posta" class="notification-icon">
          <span class="notification-name">E-posta bildirimi</span>
        </div>

        <label class="notification-switch">
          <input type="checkbox" id="toggle-email-notifications" checked>
          <span class="notification-slider"></span>
        </label>
      </div>
      <p class="notification-description">
        Uzun süre okunmamış mesajları e-posta üzerinden haber verir.
      </p>
    </div>

<!-- 4. Kart: Dosya İndirme Bildirimi -->
<div class="notification-card">
  <div class="notification-header">
    <div class="notification-heading-left">
      <img src="icons/download.png" alt="Dosya İndirme" class="notification-icon">
      <span class="notification-name">Dosya indirme bildirimi</span>
    </div>
    <label class="notification-switch">
      <input type="checkbox" id="toggle-download-notifications" checked>
      <span class="notification-slider"></span>
    </label>
  </div>
  <p class="notification-description">
    İndirilen dosyaları uygulama üzerinden haber verir.
  </p>
</div>
  </div> <!-- /notifications-container -->
</div>

        <!-- KİŞİSELLEŞTİRME Sekmesi (Yeni, card mantığında) -->
        <div class="tab-content" id="kisisellestirme">
          <div class="general-card">
            <!-- Kartın Üst Barı (Top Bar) -->
            <div class="card-topbar">
              <div class="general-heading-left">

                <span class="general-name">Merhaba, ben ajan Quik!</span>
              </div>
            </div>

            <!-- Açıklayıcı Metin -->
            <p class="general-description">
              Sana daha iyi bir tecrübe sunmak için aşağıdaki kutucuğu doldurabilirsin.
            </p>
             
            <p class="general-description">
              Bu sayede:
            </p>

            <!-- Madde Listesi -->
            <ul class="description-list">
              <li>Seninle olan sohbetlerimiz daha akıcı hale gelir.</li>
              <li>Tamamen sana özel yanıtlar üretmeye çalışırım.</li>
              <li>Detayları unutmam ve ona göre hareket ederim. </li>
            </ul>

            <!-- Statik Prompt Girişi -->
            <div class="personalization-input">
              <textarea id="static-prompt" placeholder="Örnek: 'Her zaman kısa ve öz cevap ver' veya 'Bana esprili bir şekilde yanıt ver'" rows="5"></textarea>
            </div>

            <!-- Ayarları Kaydet Butonu -->
            <div class="save-button-container">
              <button id="save-personalization" class="theme-btn">Kişiselleştirmeyi Kaydet</button>
            </div>
          </div>
        </div>

<!-- KONUŞMA Sekmesi -->
<div class="tab-content" id="konusma">
  <div class="settings-list">
    <div class="general-card">
      <div class="card-topbar">
        <div class="general-heading-left">
          <span class="general-name">Sesli Konuşma Seçimi</span>
        </div>
      </div>
      <p class="general-description">
        Seçtiğiniz kişi, konuşma tarzını etkileyebilir.
      </p>
      <div class="language-selection">
        <select id="conversation-person">
          <option value="sam">Sam</option>
          <option value="gil">Gil</option>
          <option value="dan">Dan</option>
          <option value="dom">Dom</option>
        </select>
      </div>
    </div>
  </div>
</div>

<!-- GEÇMİŞ Sekmesi -->
<div class="tab-content" id="gecmis">
  <div class="settings-list">
    <div class="general-card">
      <div class="card-topbar">
        <div class="general-heading-left">
          <span class="general-name">Mevcut Geçmiş Sohbet Sayısı: <span id="chat-count">0</span>/200</span></span>
        </div>
      </div>
      <div class="description-list">
        <span class="general-count">
        <div class="progress-container">
          <div id="progress-bar" class="progress-bar">
            <div id="progress-bar-fill" class="progress-bar-fill"></div>
          </div>
          <button id="delete-all-chats" class="danger-btn">Bütün Sohbetleri Sil</button>
        </div>
      </div>
      <p class="general-description">En fazla 200 geçmiş sohbet saklanabilir. Eğer bu sınır aşılırsa en eski sohbetler otomatik olarak silinir.</p>
    </div>
  </div>
</div>

        <!-- YAPICI PROFİLİ Sekmesi -->
        <div class="tab-content" id="yapiciprofili">
          <div class="settings-list">
            <div class="setting-item">
              <label>Yapıcı Profili</label>
              <p>Örnek yapıcı profil ayarları.</p>
            </div>
          </div>
        </div>

        <!-- BAĞLI UYGULAMALAR Sekmesi -->
        <div class="tab-content" id="bagliuygulamalar">
          <div class="settings-list">
            <div class="setting-item">
              <label>Bağlı Uygulamalar</label>
              <p>Örnek bağlı uygulama ayarları.</p>
            </div>
          </div>
        </div>

        <!-- ABONELİK Sekmesi -->
        <div class="tab-content" id="abonelik">
          <div class="settings-list">
            <div class="setting-item">
              <label>Abonelik</label>
              <p>Örnek abonelik detayları.</p>
            </div>
          </div>
        </div>

      </div><!-- /settings-content -->
    </div><!-- /settings-body -->
  </div><!-- /settings-modal-content -->
</div><!-- /settings-modal -->


  <!-- Marked ve Highlight.js Kütüphaneleri -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>

  <script>
    
/* ======================
     GLOBAL DEĞİŞKENLER & STATE
====================== */
let conversations = [];
let currentConversation = null;
let currentAssistantBubble = null;
let currentFetchAbortController = null;
let isStreaming = false;
let enableWebSearch = false;
let selectedModel = localStorage.getItem("selectedModel") || "quik-prime"; // Yeni: Seçilen model
let globalFeedbackTooltipDelayed = false;
let botSettings = {
  staticPrompt: localStorage.getItem("staticPrompt") || "" // Varsayılan boş prompt
};

const chatContainer = document.getElementById("chat-container");
const chatInput = document.getElementById("chat-input-textarea");
const sendBtn = document.getElementById("send-btn");
const newChatBtn = document.getElementById("new-chat-btn");
const chatHistoryList = document.getElementById("chat-history-list");
const sidebar = document.getElementById("sidebar");
const toggleSidebarBtn = document.getElementById("toggle-sidebar-btn");
const welcomeMessage = document.getElementById("welcome-message");
const sidebarBrand = document.getElementById("sidebar-brand");
const mainContent = document.querySelector(".main-content");
const scrollWrapper = document.querySelector(".scroll-wrapper");

/* ======================
     LOCAL STORAGE İŞLEMLERİ
====================== */
function saveConversations() {
  localStorage.setItem("conversations", JSON.stringify(conversations));
}

function loadConversations() {
  const saved = localStorage.getItem("conversations");
  if (saved) {
    conversations = JSON.parse(saved);
    // Mevcut sohbetlere timestamp ekle (eğer yoksa)
    conversations = conversations.map(conv => ({
      ...conv,
      timestamp: conv.timestamp || Date.now() // Varsayılan olarak şu anki zaman
    }));
    if (conversations.length > 0) {
      currentConversation = null;
    }
  }
}

function updateChatCount() {
  const chatCountSpan = document.getElementById("chat-count");
  const progressBar = document.getElementById("progress-bar");
  if (chatCountSpan && progressBar) {
    const currentCount = conversations.length;
    chatCountSpan.textContent = currentCount;
    const percentage = Math.round((currentCount / 200) * 100);

    // Progress bar doldurma
    let fillElement = progressBar.querySelector(".progress-bar-fill");
    if (!fillElement) {
      fillElement = document.createElement("div");
      fillElement.className = "progress-bar-fill";
      progressBar.appendChild(fillElement);
    }

    // Yüzdeye göre renk ve genişlik ayarla
    fillElement.style.width = `${percentage}%`;
    fillElement.textContent = `${percentage}% dolu`;

    if (percentage <= 33) {
      fillElement.style.backgroundColor = "#4CAF50"; // Yeşil (az yüklü)
    } else if (percentage <= 66) {
      fillElement.style.backgroundColor = "#FFC107"; // Sarı (orta yüklü)
    } else {
      fillElement.style.backgroundColor = "#F44336"; // Kırmızı (çok yüklü)
    }
  }
}

// İlk yüklemede ve her değişiklikte güncelle
loadConversations();
updateChatCount();

/* ======================
     YARDIMCI FONKSİYONLAR
====================== */

// Tüm tooltip’li elementlere fonksiyonu uygula
document.addEventListener("DOMContentLoaded", () => {

  // Sidebar toggle butonuna tooltip ekleme
  const toggleSidebarBtn = document.getElementById("toggle-sidebar-btn");
  if (toggleSidebarBtn && toggleSidebarBtn.dataset.tooltip) {
    console.log("Sidebar butonu bulundu:", toggleSidebarBtn.dataset.tooltip);
  } else {
    console.log("Sidebar butonu bulunamadı veya tooltip yok.");
  }

  // Diğer tooltip’li butonlara tooltip ekleme
  const otherButtons = document.querySelectorAll('[data-tooltip]');
  console.log("Toplam tooltip’li buton sayısı:", otherButtons.length);
  otherButtons.forEach(button => {
    console.log("Diğer buton işleme alındı:", button.dataset.tooltip);
  });
});

function renderChatHistory() {
  chatHistoryList.innerHTML = ""; // Clear once

  const groupedConversations = conversations.reduce((acc, conv) => {
    const dateKey = formatRelativeDate(conv.timestamp);
    if (!acc[dateKey]) acc[dateKey] = [];
    acc[dateKey].push(conv);
    return acc;
  }, {});

  const sortedDates = Object.keys(groupedConversations).sort((a, b) => {
    const dateA = groupedConversations[a][0].timestamp;
    const dateB = groupedConversations[b][0].timestamp;
    return dateB - dateA;
  });

  sortedDates.forEach(date => {
    const headerLi = document.createElement("li");
    headerLi.className = "chat-history-group";
    headerLi.innerHTML = `<div class="chat-history-header">${date}</div>`;
    chatHistoryList.appendChild(headerLi);

    const sortedConversations = groupedConversations[date].sort((a, b) => b.timestamp - a.timestamp);
    sortedConversations.forEach(conv => {
      const li = document.createElement("li");
      li.className = `chat-history-item${currentConversation?.id === conv.id ? " active" : ""}`;
      li.dataset.id = conv.id;
      li.innerHTML = `
        <span class="chat-history-title">${conv.title || "Yeni Sohbet"}</span>
        <div class="history-actions">
          <button class="edit-btn"><img src="icons/edit_btn.png" alt="Düzenle" /></button>
          <button class="delete-btn"><img src="icons/delete_btn.png" alt="Sil" /></button>
        </div>
      `;
      li.addEventListener("click", () => {
        currentConversation = conv;
        renderChat();
        document.querySelectorAll(".chat-history-item").forEach(item => item.classList.remove("active"));
        li.classList.add("active");
        chatInput.focus();
      });
li.querySelector(".edit-btn").addEventListener("click", (e) => {
  e.stopPropagation();
  const titleSpan = li.querySelector(".chat-history-title");
  const currentTitle = conv.title || "Yeni Sohbet";
  
  // Giriş (input) alanını oluşturuyoruz ve chat history başlığıyla aynı sınıfı ekliyoruz
  const input = document.createElement("input");
  input.type = "text";
  input.value = currentTitle;
  // Chat history başlığı için tanımlanan CSS sınıfını da ekleyerek stil uyumunu sağlıyoruz
  input.className = "chat-history-title edit-input";
  input.style.width = "80%";
  
  // Mevcut başlık (span) elemanının stil özelliklerini alıp input alanına uyguluyoruz
  const computedStyle = window.getComputedStyle(titleSpan);
  input.style.fontFamily = computedStyle.fontFamily;
  input.style.fontSize = computedStyle.fontSize;
  input.style.fontWeight = computedStyle.fontWeight;
  input.style.color = computedStyle.color;
  
  // Mevcut span'ı input ile değiştiriyoruz
  titleSpan.replaceWith(input);
  input.focus();

  // Düzenleme tamamlandığında (blur veya Enter basıldığında) başlığı güncelleyen fonksiyon
  function finishEditing() {
    conv.title = input.value.trim() || currentTitle;
    renderChatHistory();
    saveConversations();
  }
  
  input.addEventListener("blur", finishEditing);
  input.addEventListener("keydown", (event) => {
    if (event.key === "Enter") {
      input.blur(); // Enter ile düzenleme tamamlanır
    } else if (event.key === "Escape") {
      // ESC tuşuna basıldığında düzenleme iptal edilir, eski başlık geri getirilir
      conv.title = currentTitle;
      renderChatHistory();
      saveConversations();
    }
  });
});

li.querySelector(".delete-btn").addEventListener("click", (e) => {
  e.stopPropagation();
  if (confirm("Bu sohbeti silmek istediğinize emin misiniz?")) {
    conversations = conversations.filter(c => c.id !== conv.id);
    if (currentConversation?.id === conv.id) {
      currentConversation = null;
      chatContainer.innerHTML = "";
      chatContainer.appendChild(welcomeMessage);
      welcomeMessage.style.display = "block";
    }
    renderChatHistory();
    saveConversations();
    updateChatCount(); // Ekle: Sohbet silindiğinde sayıyı güncelle
  }
});
      chatHistoryList.appendChild(li);
    });
  });
}

function formatRelativeDate(timestamp) {
  const now = new Date();
  const date = new Date(timestamp);

  // Normalize to start of the day (00:00:00)
  const startOfToday = new Date(now.setHours(0, 0, 0, 0));
  const startOfInputDate = new Date(date.setHours(0, 0, 0, 0));

  // Calculate difference in days
  const diffTime = startOfToday - startOfInputDate;
  const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));

  if (diffDays === 0) return "Bugün"; // Same calendar day
  if (diffDays === 1) return "Dün";   // Previous calendar day
  if (diffDays >= 2 && diffDays <= 6) return `${diffDays} Gün Önce`; // 2 to 6 days ago
  return date.toLocaleDateString("tr-TR", { day: "numeric", month: "short" }); // Older dates
}

function isUserAtBottom(threshold = 50) {
  return chatContainer.scrollTop + chatContainer.clientHeight >= chatContainer.scrollHeight - threshold;
}

function scrollChatToBottom() {
  setTimeout(() => {
    scrollWrapper.scrollTop = scrollWrapper.scrollHeight;
  }, 100);
}

// Mevcut mesajları yüklerken feedback butonlarını eklemek için renderChat güncellemesi
function renderChat() {
  chatContainer.innerHTML = "";
  if (currentConversation && currentConversation.messages.length > 0) {
    currentConversation.messages.forEach(msg => {
      const bubble = appendMessageBubble(msg.sender, msg.text, msg.id);
      if (msg.sender === "assistant" && msg.complete) {
        addFeedbackControls(bubble, msg.text);
      }
    });
  } else {
    chatContainer.appendChild(welcomeMessage);
  }
  styleCodeBlocks();
  scrollChatToBottom();
}


// appendMessageBubble fonksiyonunu geri dönüş değeriyle güncelle
function appendMessageBubble(sender, text, messageId) {
  const bubble = document.createElement("div");
  bubble.className = "chat-bubble " + (sender === "user" ? "user-bubble" : "assistant-bubble");

  // Burada ID’yi dataset’e atıyoruz
  bubble.dataset.msgId = messageId;

  if (sender === "assistant") {
    bubble.innerHTML = marked.parse(text);
    bubble.querySelectorAll('pre code').forEach(block => hljs.highlightElement(block));
    styleCodeBlocks();
  } else {
    bubble.innerHTML = marked.parse(text);
  }

  chatContainer.appendChild(bubble);
  scrollChatToBottom();
  return bubble;
}

// Düz metni tabloya çeviren yardımcı fonksiyon
function convertTextToTable(text) {
  const lines = text.trim().split("\n");
  const rows = lines.map(line => line.split("|").map(cell => cell.trim()).filter(cell => cell));

  if (rows.length < 2 || rows[0].length < 2) return marked.parse(text); // Tablo değilse normal işleme

  let html = '<table>\n<thead>\n<tr>';
  rows[0].forEach(header => {
    html += `<th>${header}</th>`;
  });
  html += '</tr>\n</thead>\n<tbody>';

  for (let i = 1; i < rows.length; i++) {
    if (rows[i].length > 0 && !rows[i][0].startsWith("---")) { // Ayırıcı satırı atla
      html += '<tr>';
      rows[i].forEach(cell => {
        html += `<td>${cell}</td>`;
      });
      html += '</tr>';
    }
  }
  html += '</tbody>\n</table>';
  return html;
}

function createAssistantBubble(assistantMessageId) {
  currentAssistantBubble = document.createElement("div");
  currentAssistantBubble.className = "chat-bubble assistant-bubble";

  // ID’yi dataset’e atıyoruz
  if (assistantMessageId) {
    currentAssistantBubble.dataset.msgId = assistantMessageId;
  }

  // İçerik (typing indicator vs.)
  const contentDiv = document.createElement("div");
  contentDiv.className = "assistant-content";
  contentDiv.innerHTML = `
    <div class="typing-indicator">
      <span></span>
      <span></span>
      <span></span>
    </div>
  `;
  currentAssistantBubble.appendChild(contentDiv);
  chatContainer.appendChild(currentAssistantBubble);
  scrollChatToBottom();
  return currentAssistantBubble;
}


function removeTrailingWhitespaceNodes(container) {
  while (
    container.lastChild &&
    container.lastChild.nodeType === Node.TEXT_NODE &&
    container.lastChild.textContent.trim() === ""
  ) {
    container.removeChild(container.lastChild);
  }
}

function updateAssistantBubble(text) {
  const contentDiv = currentAssistantBubble.querySelector('.assistant-content');
  if (contentDiv) {

    // Ardından render işlemini yapın
    contentDiv.innerHTML = marked.parse(text);
    contentDiv.querySelectorAll('pre code').forEach(block => hljs.highlightElement(block));
    styleCodeBlocks();
  }
  if (isUserAtBottom()) scrollChatToBottom();
}

async function startNewConversation() {
  if (conversations.length >= 200) {
    conversations.shift(); // En eski sohbeti sil
  }
  currentConversation = { 
    id: Date.now(), 
    title: "Yeni Sohbet",
    messages: [], 
    timestamp: Date.now()
  };
  conversations.push(currentConversation);
  renderChatHistory();
  saveConversations();
  chatContainer.innerHTML = "";
  welcomeMessage.style.display = "none";
  updateChatCount(); // Sayıyı güncelle
}

function openSidebar() {
  sidebar.classList.add("open");
  mainContent.classList.add("sidebar-open");
  document.body.classList.add("sidebar-open");
  newChatBtn.classList.remove("sidebar-closed");
  toggleSidebarBtn.dataset.tooltip = "Kenar çubuğunu kapat"; // title yerine dataset
  const img = toggleSidebarBtn.querySelector("img");
  if (img) {
    img.src = "icons/sidebar_open_btn.png";
    img.alt = "Sidebar Open Icon";
  chatInput.focus();
  }
}

function closeSidebar() {
  sidebar.classList.remove("open");
  mainContent.classList.remove("sidebar-open");
  document.body.classList.remove("sidebar-open");
  newChatBtn.classList.add("sidebar-closed");
  toggleSidebarBtn.dataset.tooltip = "Kenar çubuğunu aç"; // title yerine dataset
  const img = toggleSidebarBtn.querySelector("img");
  if (img) {
    img.src = "icons/sidebar_close_btn.png";
    img.alt = "Sidebar Close Icon";
  chatInput.focus();
  }
}

function setSendButtonToStopState() {
  let img = sendBtn.querySelector('img');
  if (!img) {
    img = document.createElement("img");
    img.src = "icons/stop_btn.png";
    img.alt = "Stop Icon";
    img.style.width = "50px";
    img.style.height = "50px";
    sendBtn.appendChild(img);
  } else {
    img.src = "icons/stop_btn.png";
    img.alt = "Stop Icon";
  }
  sendBtn.classList.add("stop-state");
  if (document.body.classList.contains("dark")) img.classList.add("dark-icon");
  else img.classList.remove("dark-icon");
  sendBtn.style.borderRadius = "12px";
}

function setSendButtonToSendState() {
  sendBtn.innerHTML = `<img src="icons/send_btn.png" alt="Send Icon" style="width:17px; height:17px;">`;
  sendBtn.style.backgroundColor = "";
  sendBtn.style.borderRadius = "";
}


function addFeedbackControls(bubble, answerText) {
  if (!bubble) {
    console.error("Feedback eklenemedi: Bubble tanımlı değil.");
    return;
  }

  // Mesajı tekrar render et
  const contentDiv = bubble.querySelector('.assistant-content');
  if (contentDiv) {
    contentDiv.innerHTML = marked.parse(answerText);
    contentDiv.querySelectorAll('pre code').forEach(block => hljs.highlightElement(block));
    styleCodeBlocks();
  }

  // Feedback butonlarını ekle
  const feedbackDiv = document.createElement("div");
  feedbackDiv.className = "feedback-controls";
// Beğen Butonu
const likeBtn = document.createElement("button");
const likeIcon = document.createElement("img");
likeIcon.src = "icons/like_btn.png";
likeIcon.alt = "Beğen";
likeIcon.style.width = "16px";
likeIcon.style.height = "16px";
likeBtn.appendChild(likeIcon);
likeBtn.dataset.tooltip = "Beğendim"; // title yerine dataset
likeBtn.addEventListener("click", () => {
  if (likeIcon.src.includes("liked_btn.png")) return; // Zaten beğenilmişse çık
  likeIcon.src = "icons/liked_btn.png"; // İkonu değiştir
  dislikeIcon.src = "icons/dislike_btn.png"; // Dislike'ı sıfırla
  console.log("Cevap beğenildi:", answerText);
});

// Beğenme Butonu
const dislikeBtn = document.createElement("button");
const dislikeIcon = document.createElement("img");
dislikeIcon.src = "icons/dislike_btn.png";
dislikeIcon.alt = "Beğenme";
dislikeIcon.style.width = "16px";
dislikeIcon.style.height = "16px";
dislikeBtn.appendChild(dislikeIcon);
dislikeBtn.dataset.tooltip = "Beğenmedim"; // title yerine dataset
dislikeBtn.addEventListener("click", () => {
  if (dislikeIcon.src.includes("disliked_btn.png")) return; // Zaten beğenilmemişse çık
  dislikeIcon.src = "icons/disliked_btn.png"; // İkonu değiştir
  likeIcon.src = "icons/like_btn.png"; // Like'ı sıfırla
  console.log("Cevap beğenilmedi:", answerText);
});

// Kopyala Butonu (HTML Formatıyla)
  const copyBtn = document.createElement("button");
  const copyIcon = document.createElement("img");
  copyIcon.src = "icons/copy_btn.png";
  copyIcon.alt = "Kopyala";
  copyIcon.style.width = "16px";
  copyIcon.style.height = "16px";
  copyBtn.appendChild(copyIcon);
  copyBtn.dataset.tooltip = "Kopyala";
  copyBtn.addEventListener("click", async () => {
    try {
      // Markdown’ı HTML’e çevir
      const htmlContent = marked.parse(answerText);
      // Düz metni de hazırla (Markdown işaretleri temizlenmiş)
      const plainText = answerText
        .replace(/\*\*/g, '') // Bold işaretlerini kaldır
        .replace(/\*/g, '')   // Tek yıldızları kaldır
        .replace(/_/g, '')    // Alt çizgileri kaldır
        .replace(/~~/g, '');  // Üstü çizili işaretlerini kaldır
      
      // ClipboardItem ile HTML ve düz metni panoya yaz
      const htmlBlob = new Blob([htmlContent], { type: 'text/html' });
      const plainBlob = new Blob([plainText], { type: 'text/plain' });
      const data = [new ClipboardItem({
        'text/html': htmlBlob,
        'text/plain': plainBlob
      })];

      await navigator.clipboard.write(data);
      copyBtn.classList.add("copied");
      copyIcon.src = "icons/copied_btn.png";
      console.log("Formatlı cevap kopyalandı:", htmlContent);
      console.log("Düz metin hali:", plainText);
    } catch (err) {
      console.error("Kopyalama hatası:", err);
      // Fallback: Düz metni kopyala
      navigator.clipboard.writeText(answerText).then(() => {
        copyBtn.classList.add("copied");
        copyIcon.src = "icons/copied_btn.png";
        console.log("Fallback: Düz metin kopyalandı:", answerText);
      }).catch(fallbackErr => {
        console.error("Fallback kopyalama hatası:", fallbackErr);
      });
    }
    // Buton animasyonu için zamanlayıcı (syntax hatası düzeltildi)
    setTimeout(() => {
      copyBtn.classList.remove("copied");
      copyIcon.src = "icons/copy_btn.png"; // Fazla parantez kaldırıldı
    }, 2000);
  });

// Yeniden Üret Butonu (İkonlu)
  const regenBtn = document.createElement("button");
  const regenIcon = document.createElement("img");
  regenIcon.src = "icons/quik_icon.png";
  regenIcon.alt = "Yeniden Üret";
  regenIcon.style.width = "16px";
  regenIcon.style.height = "16px";
  regenBtn.appendChild(regenIcon);
  regenBtn.dataset.tooltip = "Tekrar Dene"; // title yerine dataset
  regenBtn.addEventListener("click", () => {
    console.log("Cevap yeniden üretiliyor...");
    regenerateAnswer(bubble);
  });

  feedbackDiv.appendChild(likeBtn);
  feedbackDiv.appendChild(dislikeBtn);
  feedbackDiv.appendChild(copyBtn);
  feedbackDiv.appendChild(regenBtn);
  bubble.appendChild(feedbackDiv);
}

function regenerateAnswer(bubble) {
  if (isStreaming) {
    console.log("Streaming devam ediyor, önce durdurulmalı!");
    return;
  }

  const lastUserMessage = currentConversation.messages
    .filter(msg => msg.sender === "user")
    .slice(-1)[0]?.text;
  if (!lastUserMessage) {
    console.error("Yeniden üretilecek kullanıcı mesajı bulunamadı!");
    return;
  }

  // Balonun data-msg-id’si
  const oldAssistantId = bubble.dataset.msgId;
  // currentConversation’da bu ID’yi bulalım
  const assistantIndex = currentConversation.messages.findIndex(
    msg => msg.id === oldAssistantId
  );

  if (assistantIndex === -1) {
    console.error("Eski asistan mesajı bulunamadı, ekleme yapılıyor...");
    // buraya girerse push da yapabilirsiniz ama genelde bulamaması imkânsız
  }

  // Eski balonu DOM’dan kaldır
  bubble.remove();

  // Yeni asistan mesajı oluşturmak için ID üret
  const newAssistantMessageId = (Date.now() + "_regen").toString();
  const newAssistantMessage = {
    id: newAssistantMessageId,
    sender: "assistant",
    text: "",
    complete: true
  };

  // Eski mesajın yerine koy
  currentConversation.messages[assistantIndex] = newAssistantMessage;
  saveConversations();

  // Yeni balonu DOM’a ekle
  createAssistantBubble(newAssistantMessageId);

  currentFetchAbortController = new AbortController();
  isStreaming = true;
  setSendButtonToStopState();

  // Streaming isteği
  fetch("http://localhost:5000/chat", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      message: lastUserMessage,
      history: currentConversation.messages.slice(0, -1),
      enable_web_search: enableWebSearch,
      model: selectedModel,
      static_prompt: botSettings.staticPrompt
    }),
    signal: currentFetchAbortController.signal
  })
    .then(response => response.body.getReader())
    .then(reader => {
      let buffer = "";
      const decoder = new TextDecoder();
      let assistantText = "";

      function read() {
        reader.read().then(({ value, done }) => {
          if (done) {
            addFeedbackControls(currentAssistantBubble, assistantText);
            isStreaming = false;
            setSendButtonToSendState();
            return;
          }
          buffer += decoder.decode(value, { stream: true });
          const events = buffer.split("\n\n");
          for (let i = 0; i < events.length - 1; i++) {
            const event = events[i];
            if (event.startsWith("data: ")) {
              const dataStr = event.substring(6).trim();
              if (dataStr === "[DONE]") continue;
              try {
                const dataObj = JSON.parse(dataStr);
                const content = dataObj.text;
                assistantText += content;
                updateAssistantBubble(assistantText);
                newAssistantMessage.text = assistantText;
                saveConversations();
              } catch (e) {
                console.error("JSON parse hatası:", e, dataStr);
              }
            }
          }
          buffer = events[events.length - 1];
          read();
        });
      }
      read();
    })
    .catch(err => {
      if (err.name !== "AbortError") {
        console.error("Yeniden üretme hatası:", err);
        updateAssistantBubble("Yeniden üretme başarısız: " + err.message);
      }
    });
}

async function sendMessage() {
  const userMessage = chatInput.value.trim();
  if (!userMessage) return;

  // Yeni sohbet oluşturma kontrolü
  if (!currentConversation) {
    startNewConversation();
  }

  // 1) Kullanıcı mesajına ID ekleyin
  const userMessageId = Date.now().toString() + "_user";
  currentConversation.messages.push({
    id: userMessageId,
    sender: "user",
    text: userMessage
  });

  // Kullanıcı balonu oluştururken ID'yi de gönder
  appendMessageBubble("user", userMessage, userMessageId);

  chatInput.value = "";
  chatInput.style.height = "auto";
  scrollChatToBottom();

  // Eğer ilk mesajsa başlık oluştur (aynı mantık)
  if (currentConversation.messages.length === 1) {
    try {
      const response = await fetch("http://localhost:5000/generate-title", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message: userMessage })
      });
      const data = await response.json();
      currentConversation.title = data.title || "Yeni Sohbet";
      renderChatHistory();
    } catch (err) {
      console.error("Title fetch error:", err);
      currentConversation.title = "Yeni Sohbet"; // Fallback
      renderChatHistory();
    }
  }

  saveConversations();

  // 2) Asistan cevabı için de ID ekleyin
  const assistantMessageId = (Date.now() + 1).toString() + "_assistant";
  createAssistantBubble(assistantMessageId);

  let assistantText = "";
  let newAssistantMessage = {
    id: assistantMessageId,
    sender: "assistant",
    text: "",
    complete: true
  };
  currentConversation.messages.push(newAssistantMessage);
  saveConversations();

  // Streaming için hazırlık
  currentFetchAbortController = new AbortController();
  isStreaming = true;
  setSendButtonToStopState();

  try {
    const response = await fetch("http://localhost:5000/chat", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        message: userMessage,
        history: currentConversation.messages,
        enable_web_search: enableWebSearch,
        model: selectedModel,
        static_prompt: botSettings.staticPrompt
      }),
      signal: currentFetchAbortController.signal
    });

    if (!response.ok) {
      console.error("Fetch hatası:", response.statusText);
      updateAssistantBubble("Hata: " + response.statusText);
      return;
    }
    if (!response.body) {
      console.error("Response body boş!");
      updateAssistantBubble("Hata: Response body boş, tarayıcınız stream desteği sunmuyor.");
      return;
    }

    let buffer = "";
    const decoder = new TextDecoder();
    const reader = response.body.getReader();
    let done = false;

    while (!done) {
      const { value, done: doneReading } = await reader.read();
      done = doneReading;
      if (value) {
        buffer += decoder.decode(value, { stream: true });
        const events = buffer.split("\n\n");

        for (let i = 0; i < events.length - 1; i++) {
          const event = events[i];
          if (event.startsWith("data: ")) {
            const dataStr = event.substring(6).trim();

            // [DONE] kontrolü
            if (dataStr === "[DONE]") {
              done = true;
              addFeedbackControls(currentAssistantBubble, assistantText);
              break;
            }

            try {
              const dataObj = JSON.parse(dataStr);
              const content = dataObj.text;
              assistantText += content;
              updateAssistantBubble(assistantText);
              newAssistantMessage.text = assistantText;
              saveConversations();
            } catch (e) {
              console.error("JSON parse hatası:", e, dataStr);
            }
          }
        }
        buffer = events[events.length - 1];
      }
    }

    // Streaming bitti ama [DONE] gelmediyse yine de feedback ekle
    if (!done) {
      addFeedbackControls(currentAssistantBubble, assistantText);
    }

  } catch (err) {
    if (err.name === "AbortError") {
      newAssistantMessage.complete = false;
      console.log("Streaming iptal edildi.");
    } else {
      updateAssistantBubble("Bir hata oluştu: " + err.message);
    }
  } finally {
    isStreaming = false;
    setSendButtonToSendState();
    currentFetchAbortController = null;
  }
}

/* ======================
     KOD BLOKLARI İÇİN FONKSİYONLAR
====================== */
const LANGUAGE_MAP = {
  'js': 'JavaScript', 'jsx': 'JSX', 'javascript': 'JavaScript',
  'py': 'Python', 'python': 'Python', 'ts': 'TypeScript', 'tsx': 'TSX',
  'html': 'HTML', 'css': 'CSS', 'sql': 'SQL', 'md': 'markdown', 'sh': 'Shell'
};

function styleCodeBlocks() {
  document.querySelectorAll('pre code[class^="language-"]').forEach(code => {
    if (!code.dataset.styled) {
      code.dataset.styled = 'true';
      let rawLang = ([...code.classList].find(c => c.startsWith("language-")) || "").replace("language-", "").toLowerCase();
      if (!rawLang || rawLang === "undefined") {
        rawLang = "plaintext";
        code.className = code.className.replace(/\blanguage-undefined\b/g, "").trim();
        if (!code.classList.contains("language-plaintext")) code.classList.add("language-plaintext");
      }
      let languageName = LANGUAGE_MAP[rawLang] || (rawLang.charAt(0).toUpperCase() + rawLang.slice(1));

      const pre = code.parentElement;
      const container = document.createElement("div");
      container.className = "code-block";
      const header = document.createElement("div");
      header.className = "code-header";
      const langSpan = document.createElement("span");
      langSpan.className = "code-language";
      langSpan.textContent = languageName;

      const copyBtn = document.createElement("button");
      copyBtn.className = "copy-btn";
      const copyIcon = document.createElement("img");
      copyIcon.src = "icons/copy_btn.png";
      copyIcon.alt = "Kopyala";
      copyIcon.style.width = "20px";
      copyIcon.style.height = "20px";
      copyBtn.appendChild(copyIcon);

      copyBtn.addEventListener("click", () => {
        const codeText = code.innerText;
        navigator.clipboard.writeText(codeText).then(() => {
          copyBtn.classList.add("copied");
          copyIcon.src = "icons/copied_btn.png";
          setTimeout(() => {
            copyIcon.src = "icons/copy_btn.png";
            copyBtn.classList.remove("copied");
          }, 3000);
        }).catch(err => console.error("Error copying code:", err));
      });

      header.appendChild(langSpan);
      header.appendChild(copyBtn);
      pre.parentElement.insertBefore(container, pre);
      container.appendChild(header);
      container.appendChild(pre);
    }
  });
}

marked.setOptions({
  breaks: true,
  gfm: true,
  langPrefix: 'language-',
  highlight: function(code, lang) {
    const language = lang && hljs.getLanguage(lang) ? lang : 'plaintext';
    return hljs.highlight(code, { language }).value;
  }
});

/* ======================
     BAŞLATMA VE OLAY DİNLEYİCİLERİ
====================== */
document.addEventListener("DOMContentLoaded", () => {
  loadConversations();
  currentConversation = null;
  renderChatHistory();
  closeSidebar();
  chatInput.focus();

// If no conversations exist, start with a placeholder
  if (conversations.length === 0) {
    startNewConversation(); // Creates a new conversation with "Yeni Sohbet"
  }

  // Yeni: Model Seçici Başlatma
  const modelToggleBtn = document.getElementById("model-toggle-btn");
  const modelDropdown = document.getElementById("model-dropdown");
  const modelOptions = document.querySelectorAll(".model-option");

  function setModel(model) {
    selectedModel = model;
    localStorage.setItem("selectedModel", model);
    document.getElementById("current-model-name").textContent = model === "quik-prime" ? "Quik-Prime" : "Quik-Think";
  }

  setModel(selectedModel); // İlk durumu yükle

  modelToggleBtn.addEventListener("click", () => {
    modelDropdown.classList.toggle("show");
  });

  modelOptions.forEach(option => {
    option.addEventListener("click", () => {
      const model = option.getAttribute("data-model");
      setModel(model);
      modelDropdown.classList.remove("show");
    });
  });

  window.addEventListener("click", (e) => {
    if (!modelToggleBtn.contains(e.target) && !modelDropdown.contains(e.target)) {
      modelDropdown.classList.remove("show");
    }
  });

  window.originalWelcomeHTML = `
    <div class="logo-container">
    </div>
  <h1>Nasıl yardımcı olabilirim?</h1>
  `;

  // Scroll Pozisyonu Yönetimi
  const savedScrollPosition = localStorage.getItem("scrollPosition");
  if (savedScrollPosition !== null) {
    scrollWrapper.scrollTop = parseInt(savedScrollPosition, 10);
  }
  scrollWrapper.addEventListener("scroll", () => {
    localStorage.setItem("scrollPosition", scrollWrapper.scrollTop);
  });

// Tema Ayarları (Görünüm)
  const lightModeBtn = document.getElementById("light-mode-btn");
  const darkModeBtn = document.getElementById("dark-mode-btn");
  const systemModeBtn = document.getElementById("system-mode-btn");

  function applyTheme(theme) {
    const body = document.body;
    body.classList.remove("dark");
    if (theme === "dark") body.classList.add("dark");
    else if (theme === "system") {
      if (window.matchMedia("(prefers-color-scheme: dark)").matches) body.classList.add("dark");
    }
    lightModeBtn.classList.toggle("active", theme === "light");
    darkModeBtn.classList.toggle("active", theme === "dark");
    systemModeBtn.classList.toggle("active", theme === "system");
  }

// localStorage'dan son temayı al, yoksa varsayılan "system" olsun
  let savedTheme = localStorage.getItem("theme") || "system";
  applyTheme(savedTheme);

  lightModeBtn.addEventListener("click", () => {
    applyTheme("light");
    localStorage.setItem("theme", "light");
  });
  darkModeBtn.addEventListener("click", () => {
    applyTheme("dark");
    localStorage.setItem("theme", "dark");
  });
  systemModeBtn.addEventListener("click", () => {
    applyTheme("system");
    localStorage.setItem("theme", "system");
  });
  window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change", (e) => {
    if (localStorage.getItem("theme") === "system") applyTheme("system");
  });

// Yeni eklenen otomatik odaklama mantığı
  document.addEventListener("keydown", (e) => {
    const chatInput = document.getElementById("chat-input-textarea");
    const settingsModal = document.getElementById("settings-modal");

    // Eğer ayarlar modalı açıksa veya başka bir input alanında yazıyorsak, odak kaydırmasını engelle
    if (
      settingsModal.style.display === "block" ||
      document.activeElement.tagName === "INPUT" ||
      document.activeElement.tagName === "TEXTAREA"
    ) {
      return;
    }

    // Eğer chat-input zaten odaklanmış değilse, odakla
    if (document.activeElement !== chatInput) {
      chatInput.focus();
      console.log("Chat-input otomatik olarak odaklandı.");
    }
  });

  // Bildirim Ayarları
  const unreadMessagesToggle = document.getElementById("toggle-unread-messages");
  const desktopNotificationsToggle = document.getElementById("toggle-desktop-notifications");
  const emailNotificationsToggle = document.getElementById("toggle-email-notifications");

  unreadMessagesToggle.checked = localStorage.getItem("unreadMessagesToggle") !== "false";
  desktopNotificationsToggle.checked = localStorage.getItem("desktopNotificationsToggle") !== "false";
  emailNotificationsToggle.checked = localStorage.getItem("emailNotificationsToggle") !== "false";

  unreadMessagesToggle.addEventListener("change", () => {
    localStorage.setItem("unreadMessagesToggle", unreadMessagesToggle.checked);
  });
// Eklenecek kod:
const conversationPersonSelect = document.getElementById("conversation-person");
conversationPersonSelect.value = localStorage.getItem("conversationPerson") || "sam"; // Varsayılan "Sam"
conversationPersonSelect.addEventListener("change", () => {
  localStorage.setItem("conversationPerson", conversationPersonSelect.value);
  console.log("Seçilen konuşma kişisi:", conversationPersonSelect.value);
});

const deleteAllChatsBtn = document.getElementById("delete-all-chats");
deleteAllChatsBtn.addEventListener("click", () => {
  if (confirm("Bütün sohbetleri silmek istediğinizden emin misiniz?")) {
    conversations = [];
    currentConversation = null;
    localStorage.setItem("conversations", JSON.stringify(conversations));
    renderChatHistory();
    chatContainer.innerHTML = "";
    welcomeMessage.style.display = "block";
    updateChatCount(); // Sayıyı sıfırla
    console.log("Tüm sohbetler silindi.");
  }
});

  desktopNotificationsToggle.addEventListener("change", () => {
    localStorage.setItem("desktopNotificationsToggle", desktopNotificationsToggle.checked);
  });
  emailNotificationsToggle.addEventListener("change", () => {
    localStorage.setItem("emailNotificationsToggle", emailNotificationsToggle.checked);
  });

  // Sekme Geçişleri ve Varsayılan "Genel" Sekmesi
  const navItems = document.querySelectorAll(".settings-nav li");
  const tabContents = document.querySelectorAll(".tab-content");

  function setActiveTab(tabId) {
    console.log("setActiveTab çağrıldı, sekme:", tabId); // Teşhis için log
    navItems.forEach(i => i.classList.remove("active"));
    tabContents.forEach(tc => {
      tc.classList.remove("active");
      tc.style.display = "none";
    });
    const selectedNav = Array.from(navItems).find(item => item.getAttribute("data-tab") === tabId);
    const selectedTab = document.getElementById(tabId);
    if (selectedNav && selectedTab) {
      selectedNav.classList.add("active");
      selectedTab.classList.add("active");
      selectedTab.style.display = "block";
    } else {
      console.error("Sekme bulunamadı:", tabId); // Hata teşhisi
    }
  }

  navItems.forEach(item => {
    item.addEventListener("click", () => {
      const tabName = item.getAttribute("data-tab");
      setActiveTab(tabName);
    });
  });

  // İlk açılışta "Genel" sekmesini aktif yap
  setActiveTab("genel");

// Web Arama Butonu (sayfanın sol altındaki)
  const webSearchBtn = document.getElementById("web-search-btn"); // Sol alttaki buton
  webSearchBtn.classList.toggle("active", enableWebSearch); // İlk durumunu güncelle

// Sol alttaki Web Arama Butonu
  webSearchBtn.addEventListener("click", () => {
    enableWebSearch = !enableWebSearch; // Durumu tersine çevir
    setWebSearchState(enableWebSearch); // Modal içindeki butonlarla senkronize et
  });

// Web Arama Ayarları
  const webSearchOnBtn = document.getElementById("web-search-on-btn");
  const webSearchOffBtn = document.getElementById("web-search-off-btn");

function setWebSearchState(isEnabled) {
    enableWebSearch = isEnabled;
    if (isEnabled) {
      webSearchOnBtn.classList.add("active");
      webSearchOffBtn.classList.remove("active");
      webSearchBtn.classList.add("active"); // Sol alttaki buton aktif görünüyor
    } else {
      webSearchOnBtn.classList.remove("active");
      webSearchOffBtn.classList.add("active");
      webSearchBtn.classList.remove("active"); // Sol alttaki buton inaktif görünüyor
    }
    localStorage.setItem("webSearchEnabled", isEnabled); // Durumu kaydet
  }

// localStorage'dan son web arama durumunu al, yoksa varsayılan "true" (açık) olsun
  const savedWebSearchState = localStorage.getItem("webSearchEnabled");
  const initialWebSearchState = savedWebSearchState !== null ? JSON.parse(savedWebSearchState) : true;
  setWebSearchState(initialWebSearchState);

  webSearchOnBtn.addEventListener("click", () => setWebSearchState(true));
  webSearchOffBtn.addEventListener("click", () => setWebSearchState(false));


  // Hoş Geldin Mesajı Animasyonu
  function wrapWords(element) {
    const parts = element.textContent.split(/(\s+)/);
    element.innerHTML = '';
    parts.forEach(part => {
      if (part.trim() === '') element.appendChild(document.createTextNode(part));
      else {
        const span = document.createElement('span');
        span.textContent = part;
        element.appendChild(span);
      }
    });
  }

  const h1 = welcomeMessage.querySelector('h1');
  const p = welcomeMessage.querySelector('p');
  if (h1) wrapWords(h1);
  if (p) wrapWords(p);

  function animateWelcomeElements() {
    const spans = welcomeMessage.querySelectorAll('span');
    spans.forEach((span, index) => {
      span.style.animation = `fadeIn 2s ease forwards`;
      span.style.animationDelay = `${index * 0.2}s`;
    });
    const quikIcon = document.getElementById("quik-icon");
    if (quikIcon) {
      quikIcon.style.opacity = "0";
      quikIcon.style.animation = "fadeIn 2s ease forwards";
      quikIcon.style.animationDelay = "0.2s";
    }
  }
  setTimeout(animateWelcomeElements, 200);
});

// Diğer Olay Dinleyicileri
sendBtn.addEventListener("click", () => {
  if (isStreaming) {
    console.log("Streaming devam ediyor, durduruluyor...");
    if (currentFetchAbortController) currentFetchAbortController.abort();
  } else {
    console.log("Yeni mesaj gönderiliyor...");
    const userMessage = chatInput.value.trim();
    if (!userMessage) return;
    welcomeMessage.style.display = "none";
    sendMessage();
  }
});

chatInput.addEventListener("keydown", (e) => {
  if (e.key === "Enter" && !e.shiftKey && !isStreaming) {
    e.preventDefault();
    const userMessage = chatInput.value.trim();
    if (!userMessage) {
      console.log("Enter’a basıldığında input boş!");
      return;
    }
    welcomeMessage.style.display = "none";
    sendMessage();
  }
});

// Kişiselleştirme Ayarlarını Yükle
  const staticPromptTextarea = document.getElementById("static-prompt");
  const savePersonalizationBtn = document.getElementById("save-personalization");

  // Varsayılan değeri yükle
  staticPromptTextarea.value = botSettings.staticPrompt;

  // Ayarları Kaydet
savePersonalizationBtn.addEventListener("click", () => {
  botSettings.staticPrompt = staticPromptTextarea.value.trim();
  localStorage.setItem("staticPrompt", botSettings.staticPrompt);

// Toast mesajı
  const toast = document.createElement("div");
  toast.textContent = "Ayarlar kaydedildi!";
  toast.style.cssText = `
    position: fixed;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    background-color: var(--success-color);
    color: white;
    padding: 12px 12px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    z-index: 1000;
    animation: fadeInOut 2s ease forwards;
    text-align: center;
    width: 170px; /* Sabit genişlik ile daha kontrollü görünüm */
  `;
  document.body.appendChild(toast);

  setTimeout(() => toast.remove(), 2000);

  // Animasyon
  const styleSheet = document.styleSheets[0];
  styleSheet.insertRule(`
    @keyframes fadeInOut {
      0% { opacity: 0; transform: translateY(20px); }
      10% { opacity: 1; transform: translateY(0); }
      90% { opacity: 1; transform: translateY(0); }
      100% { opacity: 0; transform: translateY(20px); }
    }
  `, styleSheet.cssRules.length);
});


chatInput.addEventListener("input", function () {
  this.style.height = "auto";
  this.style.height = this.scrollHeight + "px";
});

newChatBtn.addEventListener("click", () => {
  currentConversation = null;
  chatContainer.innerHTML = "";
  welcomeMessage.innerHTML = window.originalWelcomeHTML;
  welcomeMessage.style.display = "block";
  chatContainer.appendChild(welcomeMessage);
  makeWelcomeActive();
  renderChatHistory(); // Sidebar'ı güncellemek için eklendi
  chatInput.focus(); // Burada inputa otomatik odaklanır
});

toggleSidebarBtn.addEventListener("click", () => {
  if (sidebar.classList.contains("open")) closeSidebar();
  else openSidebar();
});

sidebarBrand.addEventListener("click", () => {
  currentConversation = null;
  chatContainer.innerHTML = "";
  welcomeMessage.innerHTML = window.originalWelcomeHTML;
  welcomeMessage.style.display = "block";
  chatContainer.appendChild(welcomeMessage);
  makeWelcomeActive();
  renderChatHistory(); // Sidebar'ı güncellemek için eklendi
  chatInput.focus(); // Burada inputa otomatik odaklanır
});


function makeWelcomeActive() {
  const welcomeMsg = document.getElementById('welcome-message');
  if (!welcomeMsg) return;
  welcomeMsg.querySelectorAll('span').forEach(span => {
    span.style.opacity = '1';
    span.style.animation = 'none';
  });
  const quikIcon = document.getElementById("quik-icon");
  if (quikIcon) {
    quikIcon.style.opacity = '1';
    quikIcon.style.animation = 'none';
  }
}

document.getElementById("settings-btn").addEventListener("click", () => {
  console.log("Ayarlar modalı açılıyor, Genel sekmesi zorlanıyor"); // Teşhis için log
  document.getElementById("settings-modal").style.display = "block";
  setActiveTab("genel"); // Modal açıldığında her zaman "Genel" sekmesini aktif yap
});

document.getElementById("settings-close").addEventListener("click", () => {
  document.getElementById("settings-modal").style.display = "none";
  // Kapanırken sekme durumunu değiştirmiyoruz, açılışta sıfırlıyoruz
});

window.addEventListener("click", (event) => {
  const modal = document.getElementById("settings-modal");
  if (event.target == modal) {
    modal.style.display = "none";
    // Kapanırken sekme durumunu değiştirmiyoruz, açılışta sıfırlıyoruz
  }
});

window.addEventListener("keydown", (e) => {
  if (e.key === "Escape") {
    const modal = document.getElementById("settings-modal");
    if (modal && modal.style.display === "block") {
      modal.style.display = "none";
      // Kapanırken sekme durumunu değiştirmiyoruz, açılışta sıfırlıyoruz
    }
  }
});

function adjustTooltipPosition(element) {
  // Sidebar toggle butonu için özel yan pozisyonlandırma
  if (element.id === 'toggle-sidebar-btn') {
    element.style.setProperty('--tooltip-left', 'calc(100% + 8px)');
    element.style.setProperty('--tooltip-transform', 'translateY(-50%)');
  } else {
    // Diğer butonlar için tooltip ortada ve aşağıda hizalı
    element.style.setProperty('--tooltip-left', '50%');
    element.style.setProperty('--tooltip-transform', 'translateX(-50%) translateY(10px)');
  }
}

function copyFormattedContent(element) {
  // Kopyalanacak HTML içeriğini al
  const htmlData = element.innerHTML;
  // Aynı zamanda düz metin versiyonunu al
  const plainTextData = element.innerText;

  const data = {
    "text/html": new Blob([htmlData], { type: "text/html" }),
    "text/plain": new Blob([plainTextData], { type: "text/plain" })
  };

  navigator.clipboard.write([new ClipboardItem(data)])
    .then(() => {
      console.log("Biçimlendirilmiş içerik kopyalandı!");
    })
    .catch(err => {
      console.error("Kopyalama hatası:", err);
    });
}

document.addEventListener('keydown', function (e) {
  // Sadece ayarlar modali açıkken çalışmasını istiyorsak kontrol ekleyebilirsiniz:
  const settingsModal = document.getElementById("settings-modal");
  if (!settingsModal || settingsModal.style.display !== "block") return;

  const navItems = Array.from(document.querySelectorAll(".settings-nav li"));
  const activeIndex = navItems.findIndex(item => item.classList.contains("active"));
  
  if (e.key === "ArrowDown") {
    // Sonraki sekmeye geçiş
    if (activeIndex < navItems.length - 1) {
      navItems[activeIndex + 1].click();
      navItems[activeIndex + 1].focus();
    }
  } else if (e.key === "ArrowUp") {
    // Önceki sekmeye geçiş
    if (activeIndex > 0) {
      navItems[activeIndex - 1].click();
      navItems[activeIndex - 1].focus();
    }
  }
});


  </script>
</body>
</html>
