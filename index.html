<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>Quik</title>
  <link rel="icon" href="icons/quik_icon.png" type="image/png">

  <!-- Google Fonts: Inter -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  
  <!-- Highlight.js CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css">

<style>
    /* Renk Değişkenleri */
    :root {
      --bg-color: #f7f7f8;
      --text-color: #333;
      --primary-color: #007bff;
      --sidebar-bg: #ffffff;
      --input-bg: #ffffff;
      --bubble-user-bg: #dcf8c6;
      --bubble-assistant-bg: #ececec;
      --topbar-bg: #ffffff;
      --code-bg: #f7f7f8;
      --code-text: #333;
      --code-border: #ddd;
      --hover-bg: #3e3f4b;
      --modal-shadow: rgba(0, 0, 0, 0.5);
      --sidebar-width: 258px;
      --success-color: #28a745;
      --danger-color: #dc3545;
      --warning-color: #ffc107;
      --accent-color: #6c757d;
    }
    body.dark {
      transition: none;
      --bg-color: #202020;
      --text-color: #e0e0e0;
      --primary-color: #0a84ff;
      --sidebar-bg: #171717; 
      --input-bg: #303030;
      --bubble-user-bg: #055160;
      --bubble-assistant-bg: #333333;
      --topbar-bg: #000000;
      --code-bg: #171717;
      --code-text: #f0f0f0;
      --code-border: #333;
      --success-color: #34c759;
      --danger-color: #ff4d4f;
      --warning-color: #ffca2c;
      --accent-color: #adb5bd;
    }
    body.dark .top-bar {
      background-color: var(--bg-color);
      box-shadow: none;
    }

    /* Genel Stil ve Modern Font */
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      font-family: 'Arial', sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
      overflow-y: auto;
      opacity: 0; /* Başlangıçta görünmez */
      animation: fadeIn 1s ease forwards; /* 0.5 saniyede animasyon */
    }

    /* Fade-in ve hafif kayma animasyonu */
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px); /* Aşağıdan yukarı doğru hafif kayma */
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Sabit Toggle Butonu (sol üst köşe) */
    #toggle-sidebar-btn {
      position: fixed;
      display: flex;
      align-items: center;
      justify-content: center;
      top: 9px;
      left: 13px;
      z-index: 304;
      background-color: var(--background-bg);
      border: none;
      height: 40px;
      width: 40px;
      cursor: pointer;
      color: var(--text-color);
      transition: transform 0.3s;
      border-radius: 12px;
    }
    #toggle-sidebar-btn:hover {
      background-color: #c0c0c0;
    }
    body.dark #toggle-sidebar-btn {
      color: #f0f0f0;
    }
    body.dark #toggle-sidebar-btn:hover {
      color: var(--sidebar-bg);
      background-color: #c0c0c0;
    }

    /* Dark modda ikonlar normalde ters çevrilmiş olsun */
    body.dark #toggle-sidebar-btn img,
    body.dark .new-chat-btn img,
    body.dark #web-search-btn img {
      filter: invert(1);
    }

    /* Hover durumunda filtreyi kaldırarak ikonların doğal rengine dönmesini sağla */
    body.dark #toggle-sidebar-btn:hover img,
    body.dark .new-chat-btn:hover img,
    body.dark #web-search-btn:hover img {
      filter: none;
    }

    /* Uygulama konteyneri */
    #app {
      display: flex;
      min-height: 100vh;
      overflow: visible;
    }

    /* Sidebar */
    .sidebar {
      position: fixed;
      top: 0;
      left: 0;
      width: var(--sidebar-width);
      height: 100%;
      background-color: var(--sidebar-bg);
      transform: translateX(-100%);
      transition: transform 0.5s cubic-bezier(0.2, 1, 0.4, 1), opacity 0.5s ease, box-shadow 0.5s ease-out, backdrop-filter 0.5s ease-in-out;
      z-index: 303;
      display: flex;
      flex-direction: column;
      padding: 1rem;
    }
    
    .sidebar.open {
      transform: translateX(0);
      box-shadow: 1px 0 10px rgba(192, 192, 192, 0.5);
    }

    body.dark .sidebar.open {
      box-shadow: none;
    }

    /* Mobilde Sidebar Tam Ekran */
    @media (max-width: 768px) {
      .sidebar {
        width: 100%;
        max-width: 100%;
      }
      .main-content.sidebar-open {
        margin-left: 0;
      }
    }

    .sidebar-header {
      position: sticky;
      top: 0;
      left: 0;
      width: 100%;
      text-align: center;
      margin: 0;
      padding: 0.54rem 0;
      border-bottom: 1px solid rgba(128, 128, 128, 0.2);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #sidebar-brand {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      margin-top: -16px;
      padding: 0;
      border-radius: 12px;
      border: 1px solid transparent;
      cursor: pointer;
    }

    #sidebar-brand:hover {
      background-color: #c0c0c0;
    }

    body.dark #sidebar-brand:hover {
      color: var(--sidebar-bg);
    }

    #sidebar-brand-icon {
      width: 24px;
      height: 24px;
      vertical-align: middle;
    }

    body.dark #sidebar-brand-icon {
      filter: brightness(0) invert(1);
    }

    body.dark #sidebar-brand:hover #sidebar-brand-icon {
      filter: none;
    }

    #sidebar-brand:hover {
      background-color: #c0c0c0;
    }

    body.dark #sidebar-brand:hover {
      color: var(--sidebar-bg);
    }

    .close-sidebar-btn {
      display: none;
    }

    .new-chat-btn {
      position: absolute;
      top: 9px;
      right: 10px;
      font-size: 0.5rem;
      width: 40px;
      height: 40px;
      background-color: transparent;
      border: none;
      outline: none;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: transform 0.3s ease, color 0.3s ease;
      color: var(--text-color);
      z-index: 301 !important; /* Geçici olarak düşür */
    }

    .new-chat-btn:hover {
      background-color: #c0c0c0;
    }

    .new-chat-btn[data-tooltip] {
      position: absolute;
    }

    .new-chat-btn[data-tooltip]::after,
    .sidebar-search-toggle[data-tooltip]::after {
      left: auto !important;
      right: 232% !important;
      top: 50% !important;
      transform: translate(50%, -50%) !important;
    }

    /* Tıklama sonrası tooltip’i gizle */
    [data-tooltip].no-tooltip::after {
      opacity: 0 !important;
      visibility: hidden !important;
    }

    body.dark .new-chat-btn img {
      filter: brightness(0) invert(1);
    }

    body.dark .new-chat-btn:hover {
      color: var(--sidebar-bg);
    }

    body.dark .new-chat-btn:hover img {
      filter: none; /* ikon doğal renginde (muhtemelen siyah) görünsün */
    }

    .chat-history-list {
      list-style: none;
      padding: 0.5rem 0;
      margin: 0;
      overflow-y: auto;
      flex: 1;
      scrollbar-width: thin;
      scrollbar-color: rgba(85, 85, 85, 0.2) transparent;
    }

    /* Tarih Grubu (Başlık ve Sohbetler) */
    .chat-history-group {
      margin-bottom: 0.5rem;
    }

    /* Tarih Başlığı */
    .chat-history-header {
      font-size: 0.8rem;
      font-weight: 600;
      color: var(--text-color);
      padding: 0.5rem 0.25rem;
      border-top: 1.5px solid #c0c0c0;
      border-bottom: 1.5px solid #c0c0c0;
      border-radius: 12px;
      margin-top: 15px;
    }

.chat-history-list::-webkit-scrollbar {
  width: 6px;
}

.chat-history-list::-webkit-scrollbar-track {
  background: transparent;
}

.chat-history-list::-webkit-scrollbar-thumb {
  background-color: rgba(85, 85, 85, 0.2);
  border-radius: 10px;
  border: 2px solid transparent;
  background-clip: content-box;
}

.chat-history-list::-webkit-scrollbar-thumb:hover {
  background-color: rgba(85, 85, 85, 0.5);
}


/* Chat History Date (Tarih Bilgisi) */
.chat-history-date {
  font-size: 0.8rem; /* Küçük font boyutu */
  color: var(--accent-color); /* Soluk renk (örneğin, #6c757d) */
  white-space: nowrap; /* Tarih tek satırda kalsın */
  margin-right: 0.5rem; /* Butonlarla arasında boşluk */
}

/* Aktif Durumda Tarih Rengi */
.chat-history-item.active .chat-history-date {
  color: #000000; /* Light modda siyah */
}

body.dark .chat-history-item.active .chat-history-date {
  color: var(--sidebar-bg); /* Dark modda sidebar rengi */
}

/* Hover Durumunda Tarih Rengi */
.chat-history-item:hover .chat-history-date {
  color: var(--text-color); /* Hover’da metin rengiyle uyumlu */
}

body.dark .chat-history-item:hover .chat-history-date {
  color: var(--text-color);
}


    /* Chat History Item (Her Bir Sohbet Öğesi) */
    .chat-history-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
      padding: 0.25rem 0.25rem;
      border-radius: 8px;
      background-color: transparent;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
    }

.chat-history-item:hover {
  background-color: #c0c0c0;
}

body.dark .chat-history-item {
  box-shadow: 0 1px 3px rgba(255, 255, 255, 0.05);
}

body.dark .chat-history-item:hover {
  background-color: #333; /* Dark modda koyu gri */
}

.chat-history-item.active {
  background-color: #c0c0c0; /* Her zaman sabit arka plan rengi */
  transition: none; /* Hover geçişini devre dışı bırak, sabit renk için */
}

body.dark .chat-history-item.active {
  background-color: #c0c0c0;
  color: #fff;
}

.chat-history-title {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  font-size: 0.8rem;
  padding-top: 6px;
  padding-bottom: 6px;
  font-weight: 500;
  color: var(--text-color);
  flex: 1; /* Başlık alanı genişlesin */
  margin-right: 0.5rem;
}

.chat-history-item.active .chat-history-title {
  color: #000000; /* Light modda siyah metin */
}

/* History Actions (Düzenleme ve Silme Butonları) */
.history-actions {
  display: flex;
  gap: 0.25rem; /* Butonlar arasında daha az boşluk */
  opacity: 0; /* Varsayılan olarak gizli */

}

.chat-history-item:hover .history-actions {
  opacity: 1; /* Hover’da butonlar görünür */
}

.history-actions button {
  background: none;
  border: none;
  cursor: pointer;
  color: var(--text-color);
  transition: background-color 0.3s ease;
  border-radius: 6px;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 24px; /* Daha küçük ve simetrik butonlar */
  height: 24px;
}

.history-actions button:hover {
  background-color: var(--sidebar-bg); /* Hafif gri arka plan */
}

body.dark .history-actions button {
  color: var(--text-color);
}

body.dark .history-actions button:hover {
  background-color: #c0c0c0; /* Hafif gri arka plan */
}

.history-actions button img {
  width: 14px; /* İkon boyutu */
  height: 14px;
  filter: none; /* Varsayılan olarak filtre yok */
}

body.dark .history-actions button img {
  filter: brightness(0) invert(1); /* Dark modda ikonlar beyaz */
}

body.dark .history-actions button:hover img {
  filter: none; /* Hover’da orijinal ikon rengi */
}

/* Dark mode’da ikonu tersine çevir */
body.dark .history-icon {
  filter: brightness(0) invert(1);
}


    /* Main İçerik */
    .main-content {
      flex: 1;
      margin-left: 0;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      position: relative;
      width: 100%;
      transition: margin-left 0.3s;
    }
    .main-content.sidebar-open {
      margin-left: 258px;
    }

@media (max-width: 768px) {
  body.sidebar-open .main-content {
    margin-left: 0 !important;
  }
}

    .top-bar {
      display: flex;
      align-items: center;
      justify-content: flex-end;
      padding: 1.5rem 3rem;
      background-color: var(--topbar-bg);
      border-bottom: 1px solid rgba(128, 128, 128, 0.2);
      z-index: 100;
      height: 58px;
    }

    body. dark .top-bar {
      border-bottom: 1px solid rgba(128, 128, 128, 0.5);
    }

    @media (max-width: 768px) {
      .top-bar {
        padding: 0.5rem 1rem;
      }
    }

    .dark-mode-toggle {
      position: fixed;
      display: flex;
      align-items: center;
      justify-content: center;
      top: 7px;
      right: 7px;
      z-index: 304;
      background: none;
      border: none;
      font-size: 1.8rem;
      cursor: pointer;
      color: var(--text-color);
      width: 40px;
      height: 40px;
      border-radius: 12px;
    }

    .dark-mode-toggle:hover {
      background-color: #c0c0c0;
    }

    .dark-mode-toggle img {
      transition: filter 0s;
    }

    body.dark .dark-mode-toggle img {
      filter: invert(1);
    }

    body.dark .dark-mode-toggle:hover img {
      filter: none;
    }

    body.dark .dark-mode-toggle:hover {
      background-color: #c0c0c0;
      color: var(--sidebar-bg);
    }

    .scroll-wrapper {
      width: 100%;
      height: calc(100vh - 150px);
      overflow-y: auto;
      scroll-behavior: smooth;
    }

    .chat-container {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
      display: flex;
      flex-direction: column;
      padding-top: 1rem;
      background-color: var(--bg-color);
      max-width: 760px;
      margin: 0 auto;
      width: 100%;
      scroll-behavior: smooth;
    }

    @media (max-width: 768px) {
      .chat-container {
        padding: 0.5rem;
        max-width: 100%;
      }
    }

    .chat-container::after {
      content: "";
      display: block;
      height: 100px; /* Chat input yüksekliğine göre ayarlayın */
    }

.welcome-message {
  position: absolute; /* absolute yerine fixed, ekranın ortasında sabit kalır */
  top: 43%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
  width: 90%; /* Mobil cihazlarda daha esnek */
  max-width: 600px; /* Masaüstünde maksimum genişlik sınırı */
  box-sizing: border-box;
}

.welcome-message h1 {
  font-size: clamp(1.5rem, 4vw, 2rem); /* Esnek font boyutu: min 1.5rem, max 2rem */
  margin: 0 0 0.5rem;
}

.welcome-message p {
  font-size: clamp(1rem, 3vw, 1.5rem); /* Esnek font boyutu: min 1rem, max 1.5rem */
  margin: 0;
}

/* Media query for small screens (max-width: 768px) */
@media (max-width: 768px) {
  .welcome-message {
    width: 85%; /* Slightly narrower for smaller screens */
    padding: 0.75rem;
  }

  .welcome-message h1 {
    font-size: clamp(1.5rem, 4vw, 2rem); /* Increased from 1.25rem-1.75rem range */
  }

  .welcome-message p {
    font-size: clamp(1rem, 3vw, 1.5rem); /* Increased from 0.875rem-1.25rem range */
  }
}

/* Media query for very small screens (max-width: 480px) */
@media (max-width: 480px) {
  .welcome-message {
    width: 90%;
    padding: 0.5rem;
  }

  .welcome-message h1 {
    font-size: clamp(1.25rem, 3.5vw, 1.75rem); /* Increased from 1rem-1.5rem range */
  }

  .welcome-message p {
    font-size: clamp(0.875rem, 2.5vw, 1.25rem); /* Increased from 0.75rem-1rem range */
  }
}



/* Chat Mesaj Balonları */
.chat-bubble {
  max-width: 70%;
  margin-bottom: 0.5rem; /* Azaltılmış alt boşluk */
  margin-right: 0.2rem;
  margin-left: 0.5rem;
  border-radius: 16px;
  word-wrap: break-word;
  line-height: 1.5;       /* Sıkıştırılmış satır yüksekliği */
  font-size: 0.9rem;
  white-space: normal;  /* Yeni satırları korumak istemiyorsanız normal */
}

.user-bubble {
  align-self: flex-end;
  border-bottom-right-radius: 0;
  background-color: var(--input-bg);
  font-family: Arial, sans-serif;
  font-size: 0.9rem;
  padding-left: 1rem;
  padding-right: 1rem;
  border-radius: 24px;
  line-height: 1.5;
  margin-bottom: 2rem;
}

.assistant-bubble {
  position: relative;
  font-family: 'Arial', system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  font-size: 0.9rem;
  white-space: normal;   /* Fazla boşluklar ortadan kalksın */
  overflow-wrap: break-word;
  max-width: 100% !important;
  flex-direction: column;
  gap: 0;
  padding-bottom: 0;
  line-height: 1.5;
  margin-bottom: 3rem;
}

.assistant-bubble pre code {
  display: block;
  background: #f8f8f8;
  overflow-x: auto;
}

.feedback-container, .feedback-button {
  margin-top: 0;
  padding-top: 0;
}

    /* Chat Input */
    .chat-input {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      transition: left 0.3s ease;
      display: flex;
      flex-direction: column;
      align-items: stretch;
      background-color: var(--input-bg);
      border-radius: 30px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      width: 100%;
      max-width: 760px;
      margin: 0 auto;
      padding: 1rem 0.5rem; /* padding-bottom daha düşük */
      box-sizing: border-box;
      z-index: 302;
      transition: left 0.3s ease, width 0.3s ease;
    }

     body.dark .chat-input {
       box-shadow: none;
    } 


    body.sidebar-open .chat-input {
      left: calc(50% + (var(--sidebar-width) / 2));
      width: calc(100% - var(--sidebar-width) - 1rem);
    }

    /* Responsive ayar: Küçük ekranlar için minimum genişlik */
    @media (max-width: 768px) {
      .chat-input {
        width: 100%;
        bottom: 20px;
        padding-bottom: 1rem;
        border-radius: 20px;
      }
      body.sidebar-open .chat-input {
        left: 50%;
        width: 100%;
      }
    }

#chat-input-textarea {
  font-family: 'Inter', sans-serif;
  font-size: 0.9rem;
  line-height: 1.5;
  flex: 1 1 auto; /* Esnek genişlik, küçülme ve büyüme izni */
  border: none;
  outline: none;
  background: transparent;
  resize: none;
  max-height: calc(1.35rem * 7); /* 7 satır */
  min-height: 1.35rem;
  min-width: 0; /* Flex küçülme sorunlarını önler */
  overflow-y: auto;
  margin: 0 0.5rem;
  box-sizing: border-box;
  margin-bottom: 0.5rem;
}


    body.dark #chat-input-textarea {
      color: #fff;
      caret-color: #fff;
    }

    body.dark #chat-input-textarea::placeholder {
      color: #bbb;
    }

.send-btn {
  position: absolute; /* Chat-input'a göre konumlanacak */
  background-color: var(--input-bg);
  border: none;
  border-radius: 12px;
  width: 40px;
  height: 35px;
  cursor: pointer;
  display: flex;
  align-items: center;
  align-self: flex-end;
  justify-content: center;
  right: 10px; /* Chat-input'un sağından 10px içeride */
  bottom: -1px;
  box-shadow: 0 4px 6px -2px rgba(0, 0, 0, 0.15), 4px 0 6px -2px rgba(0, 0, 0, 0.15), -4px 0 6px -2px rgba(0, 0, 0, 0.15), 0 -4px 6px -2px rgba(0, 0, 0, 0.15);
}

.send-btn:hover {
  background-color: #c0c0c0;
}

body.dark #send-btn {
  box-shadow: 
    /* Aşağıya doğru gölge */
    0 4px 6px -2px rgba(0, 0, 0, 0.15),
    /* Sağa doğru gölge */
    4px 0 6px -2px rgba(0, 0, 0, 0.15),
    /* Sola doğru gölge */
    -4px 0 6px -2px rgba(0, 0, 0, 0.15),
    /* Yukarıya doğru gölge */
    0 -4px 6px -2px rgba(0, 0, 0, 0.15);
}

body.dark #send-btn img {
  filter: brightness(0) invert(1);
}

body.dark #send-btn:hover img {
  filter: none;
}

    /* Modern Scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    ::-webkit-scrollbar-track {
      background: transparent;
    }
    ::-webkit-scrollbar-thumb {
      background-color: rgba(85, 85, 85, 0.2);
      border-radius: 10px;
      border: 2px solid transparent;
      background-clip: content-box;
      transition: background-color 0.3s;
    }
    ::-webkit-scrollbar-thumb:hover {
      background-color: #555;
    }
    * {
      scrollbar-width: thin;
      scrollbar-color: rgba(85, 85, 85, 0.2) transparent;
    }

.delete-btn:hover,
.edit-btn:hover {
  color: var(--sidebar-bg);
  filter: brightness(100%);
}

body.dark .delete-btn:hover,
body.dark .edit-btn:hover {
  filter: none;
  color: var(--sidebar-bg);
}

body.dark .chat-history-item.active .edit-btn:hover,
body.dark .chat-history-item.active .delete-btn:hover {
  background-color: #666666;
}

    /* === Kod Blokları ve Kopyalama Butonu Stilleri === */
   
/* Kod bloklarına relative konumlandırma */
pre {
  position: relative;
  background: var(--code-bg);
  padding: 16px;
  font-family: 'Fira Code', monospace;
  font-size: 14px;
  overflow-x: auto;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
  color: var(--code-text);
  border-top-left-radius: 0;
  border-top-right-radius: 0;
  border-bottom-left-radius: 12px;
  border-bottom-right-radius: 12px;
}

/* Dark Mode */
body.dark pre {
  background: var(--code-bg);
  border: 1px solid var(--code-border);
  box-shadow: 0 4px 12px rgba(255, 255, 255, 0.05);
  color: var(--code-text);
}

/* Copy butonu sağ üstte */
.copy-btn {
  display: flex;
  align-items: center;
  gap: 6px;
  background-color: transparent;
  color: #777;
  border: none;
  padding: 3px 8px;
  border-radius: 6px;
  font-size: 0.85rem;
  cursor: pointer;
  transition: background-color 0.2s, color 0.2s;
}

.copy-btn:hover {
  background-color: #ddd;
  color: #333;
}

.btn-text {
  display: inline-block;
  transition: transform 0.3s;
}

body.dark .copy-btn {
  color: #bbb;
}

body.dark .copy-btn img {
  filter: brightness(0) invert(1);
}

body.dark .copy-btn:hover {
  background-color: #444;
  color: #fff;
}

.copy-btn.copied {
  background-color: #28a745; /* yeşil ton */
  color: #fff !important;
}

body.dark .copy-btn:hover img {
  filter: none; /* ikon doğal renginde (muhtemelen siyah) görünsün */
}

/* Dark mode'da kopyalandıktan sonra da zıt renk kalsın */
body.dark .copy-btn.copied {
  background-color: var(--success-color, #28a745);
  color: #fff;
}

.code-block {
  background-color: var(--code-bg);    /* Light mod için açık gri arka plan */
  border: 1px solid var(--code-border); 
  margin-bottom: 1.5rem;
  overflow: hidden;
  box-shadow: 0 4px 12px rgba(0,0,0,0.05); 
  border-top-left-radius: 12px;
  border-top-right-radius: 12px;
  border-bottom-left-radius: 12px;
  border-bottom-right-radius: 12px;
}

body.dark .code-block {
  background-color: #1e1e1e;  /* Koyu arka plan */
  border-color: #333;
  box-shadow: 0 4px 14px rgba(255,255,255,0.05);
}

/* Üstteki başlık çubuğu */
.code-header {
  position: relative;
  background: var(--code-bg);
  padding: 8px 12px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

body.dark .code-header {
  background-color: #2a2a2a;
  border-bottom-color: #444;
}


/* Dil adı */
.code-language {
  font-weight: 600;
  font-size: 0.9rem;
  color: #666;
}

body.dark .code-language {
  color: #ccc;
}

/* Asıl kod alanı (pre) */
.code-block pre {
  background: transparent;;
  padding: 12px;
  margin: 0;
  position: relative;
}

/* Copy butonu */
.code-header .copy-btn {
  position: absolute;
  top: 4px;
  right: 8px;
  background-color: transparent;
  color: var(--text-color);
  border: none;
  padding: 3px 6px;
  border-radius: 4px;
  cursor: pointer;
  font-size: 0.5rem;
  opacity: 0.8;
  transition: opacity 0.3s;
  z-index: 10; /* Butonu öne çıkarmak için */
}

:root .code-header .copy-btn {
  color: var(--text-color);
}

body.dark .code-header .copy-btn {
  background-color: transparent; /* Dark mode'da şeffaf veya istediğin başka renk */
  color: var(--text-color);
}

body.dark .code-header .copy-btn:hover {
  background-color: #f0f0f0; /* Dark mode'da şeffaf veya istediğin başka renk */
  color: var(--sidebar-bg);
  opacity: 1;
}

.code-header .copy-btn:hover {
  background-color: #c0c0c0;
  opacity: 1;
}

.hljs {
  color: #333;             /* Light mod */
  background-color: none;  /* .code-block backgroundı kullan */
}
body.dark .hljs {
  color: #eee;            /* Dark modda açık metin rengi */
}

pre code {
  background: none !important;
}

/* --- Web Arama Butonu Stilleri --- */
#web-search-btn {
  position: fixed;    /* Sayfanın sol altına sabitle */
  bottom: 15px;       /* Alttan 20px boşluk */
  left: 70px;         /* Soldan 20px boşluk */
  z-index: 200;       /* Chat inputtan daha üstte veya altta olmasına göre ayarla */
  width: 60px;
  height: 35px;
  background-color: var(--input-bg);
  border: none;
  border-radius: 12px;
  box-shadow: 
    /* Aşağıya doğru gölge */
    0 4px 6px -2px rgba(0, 0, 0, 0.15),
    /* Sağa doğru gölge */
    4px 0 6px -2px rgba(0, 0, 0, 0.15),
    /* Sola doğru gölge */
    -4px 0 6px -2px rgba(0, 0, 0, 0.15),
    /* Yukarıya doğru gölge */
    0 -4px 6px -2px rgba(0, 0, 0, 0.15);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--text-color);

}

#web-search-btn:hover {
  background-color: #c0c0c0;  /* Hover durumunda benzer kutu efekti */
}

body.dark #web-search-btn {
  color: var(--text-color);
  box-shadow: 
    /* Aşağıya doğru gölge */
    0 4px 6px -2px rgba(0, 0, 0, 0.15),
    /* Sağa doğru gölge */
    4px 0 6px -2px rgba(0, 0, 0, 0.15),
    /* Sola doğru gölge */
    -4px 0 6px -2px rgba(0, 0, 0, 0.15),
    /* Yukarıya doğru gölge */
    0 -4px 6px -2px rgba(0, 0, 0, 0.15);
}

/* Dark modda ikonu bembeyaz yap */
body.dark #web-search-btn img {
  filter: brightness(0) invert(1);
}

body.dark #web-search-btn:hover img {
  filter: none;
}

body.dark #web-search-btn:hover {
  background-color: #c0c0c0;  /* Dark modda da aynı hover efekti */
  color: var(--sidebar-bg);
}

#web-search-btn.active {
  background-color: #96bfff;
}

#web-search-btn.active:hover {
  color: #fff;
}

#web-search-btn.active:hover img {
  filter: brightness(0) invert(1);
}

body.dark #web-search-btn.active {
  background-color: #2171cc;
}

body.dark #web-search-btn.active:hover {
  background-color: #2171cc;
}

@media (max-width: 768px) {
  #web-search-btn span {
    display: none;
  }
  #web-search-btn {
    display: flex;
    justify-content: center;
    align-items: center;
    width: 40px;
  }
  #web-search-btn img {
    margin-right: 0 !important;
  }
}




body.dark #send-btn.stop-state img {
  filter: brightness(0) invert(1);
}

/* Dark modda, hover durumunda ikonu normale döndür (filter sıfır) */
body.dark #send-btn.stop-state:hover img {
  filter: none;
}

/* Hover durumunda arka plan rengini #c0c0c0 yap (ara butonuyla aynı mantık) */
#send-btn.stop-state:hover {
  background-color: #c0c0c0;
}

.emoji-icon {
  width: 16px;
  height: 16px;
  margin-right: 3px;
  margin-bottom: 3px;
  vertical-align: middle;
}

@media (max-width: 768px) {
  #quik-icon {
    width: 36px; /* Küçük ekranlarda ikon boyutunu küçült */
  }
}

@media (max-width: 480px) {
  #quik-icon {
    width: 28px; /* Daha küçük ekranlarda daha da küçült */
  }
}

/* Logo için kapsayıcı */
.logo-container {
  display: flex;
  justify-content: center; /* Logoyu yatayda ortala */
}

@keyframes fadeIn {
  0% { opacity: 0; }
  100% { opacity: 1; }
}

#quik-icon {
  width: 50px; /* Varsayılan genişlik */
  height: auto; /* Oranları korumak için otomatik yükseklik */
  max-width: 50px; /* Maksimum genişlik sınırı */
  max-height: 50px; /* Maksimum yükseklik sınırı */
  vertical-align: middle;
  opacity: 0; /* İlk başta görünmeyecek */
}

body.dark #quik-icon {
  filter: brightness(0) invert(1);
}

    /* Ayarlar Butonu (Sağ Üst Köşe) */
    .settings-btn {
      position: fixed;
      top: 9px;
      right: 13px;
      width: 40px;
      height: 40px;
      background-color: #fff;
      border: none;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 1000;
    }

.settings-btn img {
  width: 24px;
  height: 21px;
}

.settings-btn.blurred {
  filter: blur(3px);
  pointer-events: none;
  transition: filter 0.3s ease;
  opacity: 0.8;
  z-index: 200; /* Modalın altına düşür */
}


.settings-btn:hover {
  background-color: #c0c0c0;
}

body.dark .settings-btn img {
  filter: brightness(0) invert(1);
}

body.dark .settings-btn:hover img {
  filter: none;
}

body.dark .settings-btn {
  background-color: transparent;
}

body.dark .settings-btn:hover {
  background-color: #c0c0c0;
}

    /* Modal Genel Ayarları */
    .modal {
      display: none;
      position: fixed;
      z-index: 306;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0, 0, 0, 0.7); /* Her iki modal için aynı karartma */
      backdrop-filter: blur(4px);
      -webkit-backdrop-filter: blur(4px);
      animation: fadeIn 0.3s ease;
    }


    /* Ayarlar Modal'ı İçin Genel Stil */
    .modal-content {
      background-color: var(--sidebar-bg);
      margin: 10% auto;
      padding: 20px;
      border-radius: 12px;
      width: 100%;
      max-width: 500px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      position: relative;
    }

    @media (max-width: 768px) {
      .modal-content {
        margin: 0;
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        max-height: 80vh;
        border-radius: 12px 12px 0 0;
        overflow-y: auto;
      }
    }

    /* Kapatma Butonu */
    .modal-close {
      position: absolute;
      top: 12px;
      right: 12px;
      font-size: 24px;
      cursor: pointer;
      color: var(--text-color);
    }

body.dark .modal-close:hover {
  color: var(--sidebar-bg);
}

/* Başlık */
.modal-content h2 {
  margin: 0 0 20px;
  font-size: 1.5rem;
  color: var(--text-color);
}

/* Modal içindeki Dark Mode Toggle butonunun stili */
.dark-mode-toggle-modal {
  background: none;
  border: none;
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  border-radius: 12px;
}

.dark-mode-toggle-modal:hover {
  background-color: #c0c0c0;
}

body.dark .dark-mode-toggle-modal img {
  filter: invert(1);
}

body.dark .dark-mode-toggle-modal:hover img {
  filter: none;
}

body.dark .dark-mode-toggle-modal:hover {
  background-color: #c0c0c0;
  color: var(--sidebar-bg);
}

/* Genel Toggle Buton Stili (Web Arama gibi) */
.toggle-btn {
  background: none;
  border: none;
  padding: 5px 10px;
  border-radius: 8px;
  cursor: pointer;
  color: var(--text-color);
}

.toggle-btn:hover {
  background-color: #c0c0c0;
}

.toggle-state {
  font-size: 0.9rem;
}

/* Modal Arka Planı ve Animasyon */
.settings-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.7);
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.3s ease, visibility 0.3s ease;
  z-index: 999;
}
.settings-modal.show {
  opacity: 1;
  visibility: visible;
}

/* Modal İçeriği */
.settings-modal-content {
  background-color: var(--sidebar-bg);
  width: 90%;
  max-width: 700px;
  min-height: 90vh;
  margin: 3vh auto;
  border-radius: 3vh;
  box-shadow: 0 8px 30px rgba(0, 0, 0, 0.5);
  overflow: hidden; /* İç taşmayı engelle */
  display: flex;
  flex-direction: column;
  box-sizing: border-box;
}

body.dark .settings-modal-content {
  background-color: var(--sidebar-bg); /* ya da sidebar rengi olarak kullandığın değişken */
}

/* Responsive Ayarlar */
@media (max-width: 768px) {
  .settings-modal-content,
  .chat-search-modal-content {
    width: 100%;
    height: 100vh; /* Tam ekran yüksekliği */
    margin: 0 !important;  
    position: fixed;
    top: 0;
    left: 0;
    border-radius: 0 !important;
    overflow: hidden; /* Modalın kendisi taşmasın */
    display: flex;
    flex-direction: column; /* Dikey düzen */
  }

  .settings-nav {
    border-bottom: 1px solid var(--code-border);
  }

  .settings-nav ul {
    flex-direction: row; /* Mobil için yatay liste */
    padding: 5px 10px;
  }

  .settings-nav li {
    margin-right: 10px;
    margin-bottom: 0;
    padding: 8px 10px;
    min-width: auto; /* Mobil için sabit genişlik kaldır */
  }

  .settings-content {
    height: 100%; /* Mobil için de sabit */
    overflow-y: auto; /* Kaydırma çubuğu aktif */
  }
}
  .settings-header {
    padding: 8px 10px;
  }
}
@media (max-width: 480px) {
  .settings-modal-content {
    max-height: 85vh; /* Çok küçük ekranlarda daha fazla alan */
  }

  /* Header kısmı örneğin 60px kaplıyorsa */
  .settings-body {
    height: calc(85vh - 60px); /* Header ve diğer üst elemanların yüksekliği çıkarıldı */
  }

  .settings-nav li {
    font-size: clamp(0.6875rem, 1.8vw, 0.75rem);
    padding: 6px 8px;
  }

  .settings-header h2 {
    font-size: clamp(0.875rem, 2vw, 1rem);
  }

  .settings-content {
    flex: 1;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch; /* Daha yumuşak kaydırma için */
  }

  .setting-item label,
  .setting-label {
    font-size: clamp(0.75rem, 1.8vw, 0.875rem);
  }

  .setting-item textarea {
    font-size: clamp(0.6875rem, 1.5vw, 0.75rem);
    padding: 8px;
  }

  .save-btn,
  #save-personalization {
    padding: 6px 12px;
    font-size: clamp(0.75rem, 1.8vw, 0.875rem);
  }
}

/* Header */
.settings-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding-bottom: 5px;
  padding-top: 10px;
  background-color: var(--nav-bg);
  border-bottom: 2px solid #c0c0c0;
  margin-bottom: 20px;
}
.settings-header h2 {
  font-size: clamp(1rem, 2.5vw, 1.1rem); /* Esnek font boyutu */
  color: var(--text-color);
}

.settings-close {
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: var(--sidebar-bg);  /* Light modda sidebar rengi, örn: beyaz */
  border: none;
  width: 35px;
  height: 35px;
  top: 25px;
  right: 7px;
  border-radius: 18px;
  cursor: pointer;
  color: var(--text-color);
}

/* Hover durumunda sidebar'dakine benzer davranış */
.settings-close:hover {
  background-color: #c0c0c0;
}

body.dark .settings-close:hover {
  background-color: #c0c0c0; /* Dark modda sidebar rengi */
}


/* =========================
   SEKMELİ AYARLAR EK CSS
========================= */

/* Ayarlar gövdesi: solda menü, sağda içerik */
.settings-body {
  display: flex;
  flex: 1; /* Modalın içini doldursun */
  min-height: 0; /* Flex taşmasını önler */
  height: 100%; /* Üst kapsayıcının tam yüksekliği */
  overflow: hidden; /* Taşma gizlensin */
}

/* Sol Sekme Menüsü */
.settings-nav {
  background-color: var(--nav-bg);
  overflow-x: auto; /* Yatay kaydırma mobil için */
  white-space: nowrap; /* Sekmeler tek satırda kalsın */
}

.settings-nav ul {
  list-style: none;
  margin: 0;
  padding: 0;

  flex-direction: column;
}

.settings-nav li {
  padding: 10px 12px;
  margin-right: 30px;
  margin-bottom: 10px;
  cursor: pointer;
  border-bottom: 1px solid var(--border-color);
  color: var(--text-color);
  font-size: clamp(0.75rem, 2vw, 0.8rem); /* Esnek font */
  border-radius: 8px;
  display: flex;
  justify-content: flex-start;
  min-width: 120px; /* Her durumda aynı genişlik */
  font-weight: 600; /* Normalde biraz daha kalın yaparak değişimi minimize et */
  text-rendering: optimizeLegibility;
  align-items: center;
  gap: 8px; /* Yazıyla ikon arasında boşluk bırak */
}

.settings-nav li .settings-icon {
  width: 14px; /* İkon boyutu */
  height: 14px;
  flex-shrink: 0; /* Küçük ekranlarda bile ikonu küçültme */
}

/* Dark modda tüm ikonlar beyaz olur */
body.dark .settings-nav li .settings-icon {
  filter: invert(1);
}

/* AMA! Eğer aktif (seçili) sekmeyse ikon eski renginde kalmalı */
body.dark .settings-nav li.active .settings-icon,
body.dark .settings-nav li:hover .settings-icon {
  filter: none; /* Dark modda aktif ve hover durumundaki ikon değişmez */
}

.settings-nav li:hover {
  background-color: #c0c0c0;
  font-weight: 600;
}

body.dark .settings-nav li:hover {
  color: var(--sidebar-bg);
  font-weight: 600;
}

.settings-nav li.active {
  background-color: #c0c0c0;
  font-weight: 700;
  color: var(--text-color);
}

body.dark .settings-nav li.active {
  background-color: #c0c0c0;
  font-weight: 600;
  color: var(--sidebar-bg);
}

/* Sağ içerik */
.settings-content {
  flex: 1; /* Genişlik esnek kalsın */
  overflow-y: auto; /* İçerik taşarsa dikey kaydırma çubuğu */
  overflow-x: hidden; /* Yatay taşma olmasın */
  height: 100%; /* Üst kapsayıcının tam yüksekliği */
  box-sizing: border-box;
}

/* Sekme içeriğini gizle/göster */
/* Varsayılan olarak tüm sekmeleri gizle */
.tab-content {
  display: none;
  position: absolute; /* Sekmelerin üst üste binmesini önler */
  width: 100%; /* İçeriği tam oturtur */
  top: 0;
  left: 0;
}

/* Sadece aktif olan sekmeyi göster */
.tab-content.active {
  display: block !important;
  position: relative; /* Çakışmayı engeller */
}

/* Açıklayıcı Metin Stili */
.setting-description {
  padding-bottom: 0.5rem; /* Çizgiyle metin arasında boşluk */
  border-bottom: 1px solid var(--code-border); /* Mevcut çizgi mantığı */
}

/* Bildirimler Sekmesinde Açıklama ile Üstteki Ayar Arasındaki Boşluk */
#bildirimler .setting-description {
  margin-top: 0.5rem;
}

.setting-description p {
  margin: 0;
  font-size: 0.8rem; /* Biraz daha büyük ve okunabilir */
  color: var(--text-color);
  line-height: 2;
}

.note-text {
  font-size: 0.8rem; /* Boyutu biraz artırdık */
  font-style: italic; /* Eğik stil ekledik */
  color: var(--accent-color);
}

.setting-description .note-text {
  font-size: 0.8rem; /* Not kısmı daha küçük */
  color: var(--accent-color); /* Hafif gri ton (örneğin #6c757d) */
}

.progress-container {
  display: flex;
  flex-direction: column;
  align-items: flex-end; /* Sağ hizalı */
  width: 100%; /* Tam genişlik */
  margin-top: 10px; /* Üst boşluk */
}

.progress-bar {
  width: 100%;
  height: 30px;
  background-color: #e0e0e0; /* Arka plan rengi */
  border-radius: 8px;
  overflow: hidden;
  margin-bottom: 5px; /* Butonla aralık */
  position: relative; /* Çocuk eleman için referans */
}

.progress-bar-fill {
  height: 100%;
  border-radius: 8px;
  transition: width 0.3s ease; /* Yumuşak geçiş */
  text-align: center;
  color: #fff;
  font-size: 0.8rem;
  line-height: 30px; /* Yükseklikle uyumlu */
}

body.dark .progress-bar {
  background-color: #444; /* Dark modda arka plan */
}

.progress-text {
  font-size: 0.8rem;
  color: var(--text-color-secondary, #666); /* Varsayılan renk, temana göre değişebilir */

}

body.dark .progress-text {
  color: #bbb; /* Dark modda daha açık renk */
}

/* Maddeler Listesi Stili */
.description-list {
  list-style-type: disc; /* Maddeler için yuvarlak işaret */
}

/* Maddelerin Başlık Stili */
.description-title {
  font-size: 0.8rem; /* Daha büyük font boyutu */
  font-weight: 600; /* Orta kalınlık (bold'dan daha az yoğun) */
  color: var(--text-color); /* Vurgu rengi (örneğin mavi) */
}

/* List Item Genel Stilini Güncelle (isteğe bağlı) */
.description-list li {
  font-size: 0.8rem; /* Maddelerin geri kalanı için mevcut boyut */
  color: var(--text-color); /* Metin rengi */
  line-height: 1.5; /* Satır aralığı */
  margin-bottom: 0.25rem; /* Maddeler arası boşluk */
}

/* Dark Mode için Renk Ayarları */
body.dark .description-list li {
  color: var(--text-color); /* Dark mode'da metin rengi */
}

/* Dark Mode için Renk Ayarları */
body.dark .setting-description {
  border-bottom: 1px solid var(--code-border); /* Dark mode'da çizgi rengi */
}

body.dark .setting-description p {
  color: var(--text-color); /* Dark mode'da metin rengi */
}

body.dark .setting-description .note-text {
  color: #adb5bd; /* Dark mode'da not için açık gri */
}

/* Sadece örnek: .settings-list, .setting-item vb. 
   Senin mevcut CSS’inde varsa dokunma, yoksa ekleyebilirsin. */

.settings-list {
  list-style: none;
  margin: 0;
  padding: 0;
  display: flex;
  flex-direction: column;
}

.setting-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  border-bottom: 1px solid var(--code-border);
  /* Ekstra margin veya padding ayarlarını burada düzenleyebilirsin */
}

.setting-item label {
  font-size: 0.8rem;
  font-weight: bold;
  color: var(--text-color);
}

/* Yeni Label Stili */
.setting-label {
  font-size: 0.9rem;
  color: var(--text-color);
  font-weight: 600;
  margin-bottom: 0.5rem;
  display: block;
}

/* Textarea Güzelleştirme */
.setting-item textarea {
  width: 100%;
  max-width: 100%;
  background-color: var(--input-bg);
  color: var(--text-color);
  border: 1px solid var(--code-border);
  border-radius: 8px;
  padding: 12px; /* Artırılmış iç boşluk */
  font-size: 0.8rem;
  font-family: 'Inter', sans-serif;
  resize: none;
  box-sizing: border-box;
  font-weight: 500; /* Hafif kalın yazı */
  transition: box-shadow 0.3s ease, border-color 0.3s ease;
}

.setting-item textarea:focus {
  outline: none;
  border-color: var(--primary-color);
  box-shadow: 0 4px 8px rgba(0, 123, 255, 0.2); /* Odaklandığında gölge artışı */
}

/* Placeholder metninin boyutunu ayarlama */
.setting-item textarea::placeholder {
  font-size: 0.8rem;
  color: var(--accent-color); /* Mevcut renk mantığını koru */
  opacity: 0.5; /* Hafif saydamlık */
}

/* Dark Mode uyumu */
body.dark .setting-item textarea::placeholder {
  color: #adb5bd; /* Dark mode'da okunabilir gri */
}

.setting-item textarea:focus::placeholder {
  opacity: 0.5;
}

/* Kaydet Butonu Güzelleştirme */
.save-btn {
  background: linear-gradient(90deg, #007bff, #0056b3); /* Gradient efekti */
  color: #fff;
  padding: 8px 16px;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  display: flex;
  align-items: center;
  border: none;
  transition: transform 0.3s ease, background 0.3s ease;
}

.save-btn:hover {
  background: linear-gradient(90deg, #0056b3, #003d80); /* Hover'da koyulaşma */
  transform: scale(1.05); /* Hafif büyüme */
}

.save-btn:active {
  transform: scale(0.98); /* Tıklama efekti */
}

body.dark .save-btn {
  background: linear-gradient(90deg, #0a84ff, #0066cc); /* Dark mode için gradient */
}

body.dark .save-btn:hover {
  background: linear-gradient(90deg, #0066cc, #004d99); /* Dark mode hover */
}

/* İkon Stili */
.save-icon {
  margin-right: 5px;
  vertical-align: middle;
  filter: brightness(0) invert(1); /* Dark mode'da beyaz */
}

body.dark .save-icon {
  filter: none; /* Dark mode'da orijinal renk */
}

body.dark .save-icon:hover {
  filter: brightness(0) invert(1); /* Hover'da tersine çevirme */
}

.setting-item p {
  margin: 0;
  line-height: 1.4;
}

body.dark .setting-item textarea {
  color: #fff;
  border-color: #444;
}

.save-button-container {
  display: flex;
  justify-content: flex-start; /* Buton sağa hizalı */
  margin-top: 0; /* Butonu alta yasla */
}

#save-personalization {
  background-color: transparent;
  color: #000000;
  padding: 8px 16px;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  border: 1px solid rgba(0, 0, 0, 0.2); /* Hafif opak, ince border */
}

body.dark #save-personalization {
  border: 1px solid rgba(255, 255, 255, 0.2);
  background-color: transparent;
  color: #fff;
}

#save-personalization:hover {
  background-color: #c0c0c0;
}

body.dark #save-personalization:hover {
  background-color: #c0c0c0;
  color: #000000;
}

/* Toggle Switch (ChatGPT Benzeri) */
.switch, .toggle-btn {
  position: relative;
  display: inline-block;
  width: 50px;
  height: 30px;
}
.switch input, .toggle-btn input {
  opacity: 0;
  width: 0;
  height: 0;
}
.slider {
  position: absolute;
  cursor: pointer;
  top: 0; left: 0;
  right: 0; bottom: 0;
  background-color: #5a5b68;
  border-radius: 24px;
}
.slider:before {
  position: absolute;
  content: "";
  height: 18px;
  width: 18px;
  left: 3px;
  bottom: 3px;
  background-color: #fff;
  border-radius: 50%;
}
input:checked + .slider {
  background-color: var(--primary-color);
}
input:checked + .slider:before {
  transform: translateX(18px);
}

/* Buton (Örneğin tehlikeli butonlar) */
.danger-btn {
  background-color: #ff4b4b;
  border: none;
  color: #fff;
  padding: 7px 12px;
  border-radius: 8px;
  cursor: pointer;
  transition: background-color 0.3s;
  align-self: flex-start;
  margin-top: 12px;
  margin-bottom: 8px;
}
.danger-btn:hover {
  background-color: #ff6666;
}

/* Select (Dil seçimi vs.) */
.setting-row select {
  width: 100%;
  max-width: 200px;
  padding: 8px;
  font-size: 0.9rem;
  border-radius: 8px;
  border: 1px solid var(--code-border);
  background-color: var(--input-bg);
  color: var(--text-color);
  cursor: pointer;
}
body.dark .setting-row select {
  border-color: #444;
  background-color: #1e1e1e;
}
.theme-selection {
  display: flex;
  gap: 1rem; /* Butonlar arası boşluk */
  flex-wrap: wrap; /* Küçük ekranlarda veya zoomda taşmayı önler */
  justify-content: center; /* Butonları ortalar */
}

.theme-selection .theme-btn {
  cursor: pointer;
  flex: 1; /* Eşit genişlikte büyür */
  min-width: 100px; /* Minimum genişlik, sıkışmayı önler */
  max-width: 200px; /* Maksimum genişlik sınırı */
  padding: 0.5rem;
  display: flex;
  align-items: center;
  justify-content: center;
  border: 1px solid var(--code-border);
  border-radius: 8px;
  background-color: var(--sidebar-bg);
  color: var(--text-color);
  font-weight: 600;
  box-sizing: border-box;
}
.theme-selection .theme-btn:hover,
.theme-selection .theme-btn.active {
  background-color: #c0c0c0;
}

.theme-selection .theme-btn .theme-icon {
  width: 11px;
  height: 11px;

  object-fit: contain;
}

/* Mobil ve Küçük Ekranlar */
@media (max-width: 768px) {
  .theme-selection {
    gap: 0.75rem; /* Daha az boşluk */
    flex-direction: column; /* Dikey düzen, mobil için daha temiz */
    align-items: stretch; /* Butonlar tam genişlikte */
  }

  .theme-selection .theme-btn {
    min-width: unset; /* Mobil için minimum genişlik sınırı kaldır */
    max-width: unset; /* Tam genişlikte esneklik */
    padding: 0.75rem; /* Daha fazla dokunma alanı */
  }

}

@media (max-width: 480px) {
  .theme-selection {
    gap: 0.5rem;
  }

  .theme-selection .theme-btn {
    font-size: clamp(0.75rem, 2vw, 0.875rem); /* Esnek font boyutu */
    padding: 0.5rem;
  }

  .theme-selection .theme-btn .theme-icon {
    width: 10px;
    height: 10px;
  }
}

/* Dark mod için: */
body.dark .theme-selection .theme-btn {
  background-color: var(--sidebar-bg);
  border-color: #444;
  color: white; /* veya istediğiniz renk */
}

body.dark .theme-selection .theme-btn:hover,
body.dark .theme-selection .theme-btn.active {
  background-color: #c0c0c0;
  color: var(--sidebar-bg);
}

body.dark .theme-selection .theme-btn .theme-icon {
  filter: invert(1);
}

body.dark .theme-selection .theme-btn.active .theme-icon,
body.dark .theme-selection .theme-btn:not(.active):hover .theme-icon {
  filter: none;
}

/* Bildirim Switch Toggle Butonu */
.notification-switch {
  position: relative;
  display: inline-block;
  /* Ebeveyn boyut: 2.5em x 1.25em */
  width: 2.5em;   
  height: 1.25em;
  vertical-align: middle;
}


.notification-switch input {
  /* Görünmez input */
  opacity: 0;
  width: 0;
  height: 0;
}

.notification-slider {
  position: absolute;
  inset: 0;                /* top:0; right:0; bottom:0; left:0; */
  cursor: pointer;
  background-color: #c0c0c0;
  transition: 0.3s;
  border-radius: 9999px;   /* Tam yuvarlak uçlar */
  overflow: hidden;        /* İç taşmaları gizle */
}

.notification-slider:before {
  position: absolute;
  content: "";
  /* Top, ebeveynin 1em'ine denk gelecek şekilde boyutlanır */
  width: 1em;
  height: 1em;
  /* Pist kenarından 0.125em boşluk bırakalım */
  left: 0.15em;
  bottom: 0.125em;
  background-color: #fff;
  border-radius: 50%;
  transition: transform 0.2s ease-in-out;
}

/* Switch açılınca arka plan rengi ve topun kayma mesafesi */
input:checked + .notification-slider {
  background-color: #10a37f; /* Veya istediğiniz renk */
}
input:checked + .notification-slider:before {
  /* Top, sağ tarafa 1em kayacak (pist genişliğinin geri kalanı kadar) */
  transform: translateX(1.2em);
}

@media (max-width: 768px) {
  .notification-switch {
    width: 2em;    /* Biraz küçültülmüş */
    height: 1em;   /* Boyutu düşürdük */
  }
  .notification-slider:before {
    width: 0.8em;
    height: 0.8em;
    left: 0.1em;
    bottom: 0.1em;
  }
  input:checked + .notification-slider:before {
    /* 2em genişlik - top (0.8em) = 1.2em kalan; 
       kenarlardan (0.1em x2) çıkarınca ~1em kayma */
    transform: translateX(1em);
  }
}


/* Dark Mode Ayarları */
body.dark .notification-slider {
  background-color: #444;
}

body.dark input:checked + .notification-slider {
  background-color: #10a37f;
}

/* Web Arama Buton Grubu */
.web-search-toggle-group {
  display: flex;
  gap: 1rem;
  flex-wrap: wrap; /* Zoomda alt alta kayacak */
  justify-content: center; /* Ortalı hizalama */
}

/* Web Arama Butonları */
.web-search-toggle-group .web-search-btn {
  flex: 1; /* Esnek genişlik */
  min-width: 100px; /* Minimum genişlik */
  max-width: 200px; /* Maksimum genişlik */
  padding: 0.5rem; /* Sabit padding */
  display: flex;
  align-items: center;
  justify-content: center;
  border: 1px solid var(--code-border);
  border-radius: 8px;
  background-color: var(--sidebar-bg);
  color: var(--text-color);
  font-size: 0.8rem;
  font-weight: 600;
  box-sizing: border-box;
  cursor: pointer;
}

/* Hover ve aktif durum: */
.web-search-toggle-group .web-search-btn:hover,
.web-search-toggle-group .web-search-btn.active {
  background-color: #c0c0c0;
}

/* Web Arama Butonundaki İkon */
.web-search-toggle-group .web-search-btn .web-search-icon {
  width: 14px;
  height: 14px;
  margin-right: 0.5rem;
  object-fit: contain;
}

/* Dark Mode için */
body.dark .web-search-toggle-group .web-search-btn {
  background-color: var(--sidebar-bg);
  border-color: #444;
  color: var(--text-color);
}

body.dark .web-search-toggle-group .web-search-btn:hover,
body.dark .web-search-toggle-group .web-search-btn.active {
  background-color: #c0c0c0;
  color: var(--sidebar-bg);
}

body.dark .web-search-toggle-group .web-search-btn .web-search-icon {
  filter: brightness(0) invert(1);
}

body.dark .web-search-toggle-group .web-search-btn:not(.active):hover .web-search-icon {
  filter: none;
}

.web-search-toggle-group .web-search-btn.active .web-search-icon {
  filter: none !important;
}

/* Responsive Ayarlar: Görünüm kartındaki gibi */
@media (max-width: 768px) {
  .web-search-toggle-group {
    gap: 0.75rem;
    flex-direction: column;
    align-items: stretch;
  }
  .web-search-toggle-group .web-search-btn {
    min-width: unset;
    max-width: unset;
    padding: 0.75rem;
    font-size: clamp(0.75rem, 2vw, 0.875rem);
  }
}

@media (max-width: 480px) {
  .web-search-toggle-group {
    gap: 0.5rem;
    flex-direction: column;
    align-items: stretch;
  }
  .web-search-toggle-group .web-search-btn {
    font-size: clamp(0.75rem, 2vw, 0.875rem);
    padding: 0.5rem;
  }
  .web-search-toggle-group .web-search-btn .web-search-icon {
    width: 10px;
    height: 10px;
    margin-right: 0.4rem;
  }
}

@media (max-width: 768px) {
  .card {
    padding: 10px;
  }
}

/* Tablo Stilleri */
table {
  width: 100%;
  border-collapse: collapse;
  margin-bottom: 1.5rem;
  background-color: var(--sidebar-bg);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  border-radius: 8px;
  overflow: hidden;
}

th, td {
  padding: 12px 16px;
  text-align: left;
  border-bottom: 1px solid var(--code-border);
}

th {
  background-color: var(--code-bg);
  font-weight: 600;
  color: var(--text-color);
}

td {
  color: var(--text-color);
}

tr:last-child td {
  border-bottom: none;
}

/* Dark Mode için Tablo Stilleri */
body.dark table {
  background-color: var(--input-bg);
  box-shadow: 0 2px 8px rgba(192, 192, 192, 0.1);
}

body.dark th {
  background-color: #2a2a2a;
  color: #e0e0e0;
}

body.dark td {
  color: #e0e0e0;
}

/* Responsive Tablo */
@media (max-width: 768px) {
  table {
    font-size: 0.9rem;
  }
  th, td {
    padding: 8px 12px;
  }
}

    /* Model Seçici */
    .model-selector {
      position: fixed;
      top: 7px;
      left: 94px;
      z-index: 101;
    }

    @media (max-width: 768px) {
      .model-selector {
        left: 94px;
      }
      .model-dropdown {
        width: 95px;
      }
    }

    .model-toggle-btn {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background-color: var(--sidebar-bg);
      border: none;
      border-radius: 12px;
      cursor: pointer;

      color: var(--text-color);
      font-size: 1rem;
      font-weight: 750;
      height: 40px;
      margin-top: 2px;
      min-width: 95px;
    }
    .model-toggle-btn:hover {
      background-color: #c0c0c0;
    }
    body.dark .model-toggle-btn {
      background-color: var(--bg-color);
    }
    body.dark .model-toggle-btn:hover {
      background-color: #c0c0c0;
      color: var(--sidebar-bg);
    }
    body.dark .model-toggle-btn img {
      filter: brightness(0) invert(1);
    }
    body.dark .model-toggle-btn:hover img {
      filter: none;
    }
    .model-dropdown {
      display: none;
      position: absolute;
      top: 45px;
      left: 0;
      background-color: var(--input-bg);
      border-radius: 6px;
      min-width: 95px;
      z-index: 305;
      box-shadow: 0 0 8px rgba(192, 192, 192, 0.75);
    }

    body.dark .model-dropdown {
      box-shadow: none;
    }

    .model-dropdown.show {
      display: block;
    }
    .model-option {
      display: block;
      width: 100%;
      padding: 8px 4px;
      background: none;
      border: none;
      border-radius: 6px;
      text-align: left;
      color: var(--text-color);
      font-size: 1rem;
      cursor: pointer;
    }

    .model-option:hover {
      background-color: #c0c0c0;
    }
    body.dark .model-option:hover {
      background-color: #c0c0c0;
      color: var(--sidebar-bg);
    }
    body.sidebar-open .model-selector {
      left: calc(var(--sidebar-width) + 10px);
      transition: left 0.29s ease;
    }

.model-option:hover {
  background: #c0c0c0;
}

/* Model Adı */
.model-name {
  font-size: 1rem;
  font-weight: 600;
}

/* Model Açıklaması */
.model-description {
  font-size: 0.7rem;
  color: var(--accent-color);
  font-weight: 400;
}

/* Dark Mode Hover Durumu */
body.dark .model-option:hover {
  background-color: #c0c0c0; /* Mevcut hover arka plan rengi korundu */
  color: var(--sidebar-bg); /* Model adı rengi */
}

body.dark .model-option:hover .model-name {
  color: var(--sidebar-bg); /* Model adı için özel renk */
}

body.dark .model-option:hover .model-description {
  color: var(--sidebar-bg); /* Model açıklaması için özel renk */
}

/* Dark Mode Genel Durum */
body.dark .model-description {
  color: #adb5bd; /* Normal durumda açık gri */
}

.typing-indicator {
  display: inline-flex;
  align-items: center;
  gap: 4px;
}

.typing-indicator span {
  display: block;
  width: 8px;
  height: 8px;
  background-color: var(--text-color);
  border-radius: 50%;
  animation: bounce 1.4s infinite ease-in-out;
}

.typing-indicator span:nth-child(1) {
  animation-delay: 0s;
}

.typing-indicator span:nth-child(2) {
  animation-delay: 0.2s;
}

.typing-indicator span:nth-child(3) {
  animation-delay: 0.4s;
}

@keyframes bounce {
  0%, 80%, 100% {
    transform: scale(0);
  }
  40% {
    transform: scale(1);
  }
}

/* Feedback Kontrolleri */
.feedback-controls {
  display: inline-flex;
  gap: 0.5rem;
  padding: 0;
  opacity: 0; /* Varsayılan olarak gizli */
  margin-left: -7px;
  z-index: 300; /* Chat-input’un (302) altında */
  transition: opacity 0.2s ease; /* Pürüzsüz geçiş */
}

.assistant-bubble:hover .feedback-controls {
  opacity: 1; /* Mesajın üzerine gelince görünür */
}

.assistant-bubble a {
  color: var(--text-color);
}

.feedback-controls button {
  border: none;
  background: var(--sidebar-bg);
  border-radius: 6px;
  cursor: pointer;
  font-size: 1rem;
  color: var(--text-color);
  display: flex;
  align-items: center;
  justify-content: center;
  width: 30px;
  height: 30px;
  z-index: 300; /* Chat-input’un altında */
  position: relative; /* Tooltip için gerekli */
  transition: background 0.2s ease; /* Hover geçişi */
}

.feedback-controls button:hover {
  background: #c0c0c0;
}

.feedback-controls button:active {
  transform: translateY(0); /* Aktif durumda hareket yok */
}

/* Dark Mode için Buton Stilleri */
body.dark .feedback-controls button {
  background: transparent; /* Dark modda arka plan şeffaf */
  color: #c0c0c0;
  box-shadow: none;
}

body.dark .feedback-controls button:hover {
  background: #c0c0c0;
}

/* İkonların Dark Mode Ayarları */
body.dark .feedback-controls button img {
  filter: brightness(0) invert(1); /* Beyaz ikonlar */
}

body.dark .feedback-controls button:hover img {
  filter: none; /* Hover’da orijinal renk */
}

/* Kopyalandı Durumu */
.feedback-controls button.copied {
  background: transparent;
  color: #004085;
}

.feedback-controls button.copied:hover {
  background: #c0c0c0;
}

.feedback-controls button.copied img {
  filter: none; /* Kopyalandı ikonunu orijinal haliyle bırak */
}

/* Animasyonlu Durumlar */
.feedback-controls button.copied,
.feedback-controls button.liked,
.feedback-controls button.disliked {
  animation: pulse 0.3s ease;
}

/* Tooltip Stilleri */
.feedback-controls button[data-tooltip]::after {
  content: attr(data-tooltip);
  position: absolute;
  background-color: #1e1e1e; /* Sabit koyu arka plan */
  color: #fff; /* Sabit beyaz metin */
  padding: 7px 7px; /* Daha geniş iç boşluk */
  border-radius: 8px;
  font-size: 0.7rem; /* Daha okunabilir font boyutu */
  font-family: 'Inter', sans-serif;
  white-space: nowrap; /* Tek satırda tut */
  text-align: center; /* Metni ortala */
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.2s ease, transform 0.2s ease; /* Sidebar tarzı geçiş */
  z-index: 310; /* Feedback kontrollerinden üstte */
  pointer-events: none; /* Tooltip’in hover’ı engellemesini önler */
  margin-top: 8px;
}

.feedback-controls button[data-tooltip]:hover::after {
  opacity: 1;
  visibility: visible;
}

/* Dark Mode için Tooltip Ayarları */
body.dark .feedback-controls button[data-tooltip]::after {
  background-color: var(--input-bg); /* Koyu modda biraz daha açık gri */
  color: #fff; /* Beyaz metin */
}

/* Pulse Animasyonu */
@keyframes pulse {
  0%, 50%, 100% {
    transform: scale(1);
  }
}

/* Özel Tooltip Stilleri */
[data-tooltip] {
  position: relative;
  cursor: pointer;
  z-index: 10001; /* Butonun kendi z-index’i */
}

/* Tooltip pozisyonunu ayarlama */
[data-tooltip]::after {
  content: attr(data-tooltip);
  position: absolute;
  top: 100%; /* Butonun hemen altına */
  left: 50%;
  transform: translateX(-50%);
  background-color: #333;
  color: #fff;
  padding: 8px 11px;
  border-radius: 8px;
  font-size: 0.8rem;
  font-weight: 500;
  white-space: nowrap;
  opacity: 0; /* Varsayılan olarak gizli */
  visibility: hidden; /* Görünmez */
  transition-property: opacity;
  transition-timing-function: ease;
  transition-delay: 0.5s;
  z-index: 10000; /* Her şeyin üstünde */
  pointer-events: none;
}

/* Hover durumunda görünüm (JS ile kontrol edilecek) */
[data-tooltip].show-tooltip::after {
  opacity: 1;
  visibility: visible;
  transform: var(--tooltip-transform, translateX(-50%) translateY(5px));
}

#file-upload-btn[data-tooltip]::after,
#web-search-btn[data-tooltip]::after,
#send-btn[data-tooltip]::after,
#voice-record-btn[data-tooltip]::after,
#voice-page-btn[data-tooltip]::after,
#emoji-btn[data-tooltip]::after {
  left: 50%;
  top: -9px; /* Butonun üstüne yerleştir */
  transform: translateX(-50%) translateY(-100%); /* Yatayda ortala, dikeyde yukarı kaydır */
}

/* Dark Mode */
body.dark [data-tooltip]::after {
  background-color: #e0e0e0;
  color: #333;
}

/* Hover durumunda görünüm */
[data-tooltip]:hover::after {
  opacity: 1;
  visibility: visible;
  transform: var(--tooltip-transform, translateX(-50%) translateY(5px)); /* Varsayılan transform */
}

/* Sidebar aç/kapa butonu için özel tooltip konumlandırması */
#toggle-sidebar-btn[data-tooltip]::after {
  top: 50% !important;
  left: calc(100% + 8px) !important;
  transform: translateY(-50%) !important;
}

.settings-btn[data-tooltip] {
  position: fixed;
}

#settings-btn[data-tooltip]::after {
  top: 43px; /* Butonun üstüne yerleştir */

}

/* ==============================
   BİLDİRİMLER SEKMESİ YENİ CSS
============================== */

/* Bildirimler sekmesinin ana kapsayıcısı */
.notifications-container {
  display: flex;
  flex-direction: column;
  gap: 1rem;           /* Kartlar arasında boşluk */
}

/* Her bildirim ayarı için “kart” görünümü */
.notification-card {
  background-color: var(--sidebar-bg);
  border: 1px solid var(--code-border);
  border-radius: 12px;
  padding: 1rem;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

/* Kart üst kısmı (ikon, isim, toggle) */
.notification-header {
  display: flex;
  align-items: center;
  justify-content: space-between; /* Sağda toggle, solda başlık+ikon */
}

/* Başlık + ikon yan yana */
.notification-heading-left {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

/* İkon boyutu */
.notification-icon {
  width: 16px;
  height: 16px;
  object-fit: contain;
  filter: none; /* Dark mod için isterseniz invert(1) ekleyebilirsiniz */
}

/* Bildirim ayarının adı */
.notification-name {
  font-size: 0.8rem;
  font-weight: 600;
  color: var(--text-color);
}

/* Açıklama metni */
.notification-description {
  font-size: 0.8rem;
  color: var(--text-color);
  line-height: 1.5;
  margin: 0;
}

/* Dark mode düzenlemeleri */
body.dark .notification-card {
  background-color: var(--sidebar-bg); /* Ör: #1e1e1e */
  border-color: #444;
}

body.dark .notification-icon {
  filter: brightness(0) invert(1); /* İkonu beyaz yapmak için */
}

/* GENEL SEKMESİ (Kart Mantığı) */
.general-container {
  display: flex;
  flex-direction: column;
  width: 100%;
  box-sizing: border-box;
}

/* Kart Yapısı */
.general-card {
  width: 100%;
  background-color: var(--sidebar-bg);
  border: 1px solid var(--code-border);
  border-radius: 12px;
  padding: 1rem;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  box-sizing: border-box;
}

/* Kart üst kısmı (ikon + başlık) */
.general-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
}

/* Sol tarafta ikon + başlık ismi */
.general-heading-left {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

/* İkon boyutu */
.general-icon {
  width: 18px;
  height: 18px;
  object-fit: contain;
}

/* Ayar adı (ör. "Görünüm", "Web Arama", "Dil Seçimi") */
.general-name {
  font-size: 0.8rem;
  font-weight: 600;
  color: var(--text-color);
}

/* Açıklama metni */
.general-description {
  font-size: 0.8rem;
  color: var(--text-color);
  line-height: 1.5;
  margin: 0;
}

/* Dark Mode Düzenlemeleri */
body.dark .general-card {
  background-color: var(--sidebar-bg);
  border-color: #444;
}

body.dark .general-icon {
  filter: brightness(0) invert(1); /* İkonu beyaz yapmak isterseniz */
}

/* Dropdown (Select) Stili */
.language-selection select {
  width: 100%;
  padding: 0.5rem;
  border: 1px solid var(--code-border);
  border-radius: 8px;
  font-size: 0.8rem;
  font-weight: bold;
  background-color: #c0c0c0;
  color: var(--text-color);
  transition: border-color 0.3s ease;
  box-sizing: border-box;
}

/* Dark Mode için */
body.dark .language-selection select {
  background-color: #c0c0c0;
  border-color: #444;
  color: #000000;
}

/* Personalization (Statik Prompt) Girişi */
.personalization-input textarea {
  width: 100%;
  padding: 0.75rem;
  border: 1px solid var(--code-border);
  border-radius: 8px;
  font-size: 0.8rem;
  font-family: 'Inter', sans-serif;
  background-color: var(--input-bg);
  color: var(--text-color);
  resize: none;
  box-sizing: border-box;
}

.personalization-input textarea:focus {
  outline: none;
  border-color: var(--primary-color);
}

body.dark .personalization-input textarea {
  background-color: var(--input-bg);
  border-color: #444;
  color: #e0e0e0;
}

body.dark .theme-btn {
  background-color: var(--bg-color);
  border-color: #444;
  color: white;
}
body.dark .theme-btn:hover,
body.dark .theme-btn.active {
  background-color: #c0c0c0;
  color: var(--sidebar-bg);
}

.data-control-card {
  display: flex;
  flex-direction: column; /* İçerik dikey olarak dizilsin */
  padding: 16px; /* Daha geniş iç boşluk */
  background-color: var(--input-bg);
  border: 1px solid var(--code-border);
  border-radius: 12px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
}

.data-control-card .description-list {
  display: block;
  justify-content: space-between;
  align-items: center;
  width: 100%;
}

.data-control-card .danger-btn {
  margin: 10px 0; /* Butonun üstünde ve altında boşluk */
  align-self: flex-start; /* Sola hizalı */
}

.data-control-card p {
  margin: 0;
  font-size: 0.8rem;
  color: var(--text-color);
}

body.dark .data-control-card {
  background-color: #1e1e1e;
  border-color: #444;
  box-shadow: 0 2px 4px rgba(255, 255, 255, 0.05);
}

.general-count {
  font-size: 0.9rem;
}

/* File Upload Button */
.file-upload-btn {
  position: fixed;
  background-color: var(--input-bg);
  border: none;
  border-radius: 12px;
  width: 40px;
  height: 35px;
  bottom: 15px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-left: 10px; /* Butonu soldan 10px sağa kaydırır */
  margin-right: 10px; /* Space between file upload and web search buttons */
  box-shadow: 0 4px 6px -2px rgba(0, 0, 0, 0.15), 4px 0 6px -2px rgba(0, 0, 0, 0.15), -4px 0 6px -2px rgba(0, 0, 0, 0.15), 0 -4px 6px -2px rgba(0, 0, 0, 0.15);
}

.file-upload-btn:hover {
  background-color: #c0c0c0;
}

body.dark .file-upload-btn img {
  filter: brightness(0) invert(1);
}

body.dark .file-upload-btn:hover img {
  filter: none;
}

/* File Container */
.file-container {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
  width: 100%;
  max-width: 760px;
  margin: 0 auto;
  box-sizing: border-box;
  max-height: 200px;
  overflow-y: hidden;
  align-items: flex-start;
}

/* Individual File Box */
.file-box {
  display: flex;
  align-items: center;
  background-color: var(--input-bg);
  border: 1px solid var(--code-border);
  border-radius: 8px;
  padding: 0.4rem 0.8rem;
  margin-bottom: 0.15rem;
  margin-left: 0.60rem;
  flex: 0 0 auto;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.file-box:last-child {
  margin-bottom: 0.65rem;
}

body.dark .file-box {
  background-color: #303030;
  border-color: #444;
}

.file-icon {
  width: 20px;
  height: 20px;
  margin-right: 0.5rem;
}



.file-name {
  font-size: 0.8rem;
  color: var(--text-color);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.remove-file-btn {
  background: none;
  border: none;
  cursor: pointer;
  margin-left: 5px;
  padding: 0;
  width: 20px;
  height: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.remove-file-btn img {
  width: 16px;
  height: 16px;
}

body.dark .remove-file-btn img {
  filter: brightness(0) invert(1);
}

body.dark .remove-file-btn:hover img {
  filter: brightness(0) invert(1);
}

/* Drop zone penceresi */
.drop-zone {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 400px;
  padding: 20px;
  background-color: rgba(255, 255, 255, 0.95); /* Hafif şeffaf beyaz */
  border: 2px dashed #007bff; /* Kesikli mavi çerçeve */
  border-radius: 10px;
  text-align: center;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
  z-index: 1000; /* En üstte olsun */
  display: none; /* Normalde gizli */
  transition: opacity 0.3s ease;
}

.drop-zone.active {
  display: block; /* Sürükleme sırasında görünür */
  opacity: 1;
}

.drop-zone p {
  margin: 10px 0;
  font-size: 1.2rem;
  color: #333;
}

.drop-zone .subtext {
  font-size: 0.9rem;
  color: #666;
}

/* Dark mod uyumluluğu */
body.dark .drop-zone {
  background-color: rgba(50, 50, 50, 0.95); /* Koyu tema için */
  border-color: #1e90ff;
}

body.dark .drop-zone p {
  color: #fff;
}

body.dark .drop-zone .subtext {
  color: #ccc;
}

#voice-record-btn {
  position: absolute; /* Chat-input'a göre konumlanacak */
  background-color: var(--input-bg);
  border: none;
  border-radius: 12px;
  width: 40px;
  height: 35px;
  cursor: pointer;
  display: flex;
  align-items: center;
  align-self: flex-end;
  justify-content: center;
  right: 70px; /* Chat-input'un sağından 10px içeride */
  bottom: 15px;
  box-shadow: 0 4px 6px -2px rgba(0, 0, 0, 0.15), 4px 0 6px -2px rgba(0, 0, 0, 0.15), -4px 0 6px -2px rgba(0, 0, 0, 0.15), 0 -4px 6px -2px rgba(0, 0, 0, 0.15);
}


#voice-record-btn:hover {
  background-color: #c0c0c0;
}

#voice-record-btn.recording {
  background-color: #f44336; /* Kayıt sırasında kırmızı */
}

body.dark #voice-record-btn img {
  filter: brightness(0) invert(1);
}

body.dark #voice-record-btn:hover img {
  filter: none;
}

body.dark #voice-record-btn.recording img {
  filter: brightness(0) invert(1);
}

.chat-history-title.edit-input {
  color: #000 !important;
}

.language-selection hr {
  margin-bottom: 1rem;
  margin-top: 1rem;
}

.credentials-container label {
  font-size: 0.8rem;
}

.credential-input {
  margin-bottom: 10px;
}

.credential-input label {
  display: block;
  font-weight: bold;
  margin-bottom: 5px;
}

.credential-input input {
  width: 100%;
  padding: 7px;
  border: 1px solid #ccc;
  border-radius: 4px;
}

.credential-save-btn {
  padding: 8px 16px;
  background-color: #10a37f;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

.credential-save-btn:hover {
  background-color: #45a049;
}

.voice-options {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.voice-option {
  display: flex;
  align-items: center;
  gap: 10px;
}

.voice-check-btn {
  max-height: 30px;
  min-height: 30px;
  max-width: 100px;
  min-width: 100px;
  background-color: #10a37f;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

.voice-check-btn:hover {
  background-color: #0056b3; /* Daha koyu mavi */
}

.voice-description {
  margin: 0;
  flex: 1; /* Kalan alanı doldurur */
}

/* Responsive: Ekran genişliği 768px ve altı için */
@media (max-width: 768px) {
  .voice-option {
    flex-direction: column;
    align-items: flex-start;
  }
  .voice-check-btn {
    width: 100%;
    max-width: none;
  }
}

/* Daha küçük ekranlar (480px altı) için de aynı ayarlar uygulanabilir */
@media (max-width: 480px) {
  .voice-option {
    flex-direction: column;
    align-items: flex-start;
  }
  .voice-check-btn {
    width: 100%;
    max-width: none;
  }
}

p.voice-description {
  font-size: 0.8rem;
}

.general-description p:last-child {
  margin-bottom: 0;
}

ul.description-list {
  margin-top: 0;
  margin-bottom: 0;
}

button.theme-btn {
  border-radius: 12px;
  padding: 0.5rem;
  border: 1px solid #e0e0e0;
  cursor: pointer;
  display: flex;
  gap: 1rem;
  flex-wrap: wrap;
      align-items: center;
      justify-content: center;
}

.prompt-selection {
  margin-top: 0.8rem;
}

  @media (max-width: 768px) {
    .prompt-selection {
      button.theme-btn: column;
    }
  }

  @media (max-width: 480px) {
    .prompt-selection {
      button.theme-btn: column;
    }
  }

button.theme-btn:hover {
  background: #c0c0c0;
}

  .connect-btn {
    background-color: #007bff;
    color: white;
    border: none;
    border-radius: 4px;
    padding: 4px 8px;
    cursor: pointer;
    font-size: 0.7rem;
  }
  .connect-btn:hover {
    background-color: #0056b3;
  }

#gmail-profile-photo {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  cursor: pointer;
  border: 2px solid var(--primary-color);
  transition: transform 0.2s ease;
}

#gmail-profile-photo:hover {
  transform: scale(1.1);
}

.danger-btn {
  background-color: var(--danger-color);
  border: none;
  color: #fff;
  padding: 7px 12px;
  border-radius: 8px;
  cursor: pointer;
  transition: background-color 0.3s;
}

.danger-btn:hover {
  background-color: #ff6666;
}

body.dark .danger-btn {
  background-color: var(--danger-color);
}

body.dark .danger-btn:hover {
  background-color: #ff6666;
}

.setting-row.select {
  width: 100%;
  max-width: 300px; /* Dropdown genişliğini sınırlıyoruz */
  padding: 8px;
  font-size: 0.8rem;
  border-radius: 8px;
  border: 1px solid var(--code-border);
  background-color: var(--input-bg);
  color: var(--text-color);
  cursor: pointer;
  margin-top: 0.5rem;
  margin-bottom: 0.5rem;
}

body.dark .setting-row.select {
  border-color: #444;
  background-color: #1e1e1e;
  color: #fff;
}

/* Kartlar arasında boşluk */
.general-card + .general-card {
  margin-top: 1rem; /* Kartlar arasında dikey boşluk */
}

.summary-actions-container {
  display: flex;
  align-items: center;
  gap: 0.5rem; /* Dropdown ile butonlar arasında boşluk */
}

.summary-actions {
  display: flex;
  gap: 0.25rem; /* Butonlar arasında boşluk */
  opacity: 1; /* Varsayılan olarak görünür, ama devre dışıysa soluk olacak */
}

.summary-actions button:disabled {
  opacity: 0.3; /* Devre dışı butonlar soluk görünür */
  cursor: not-allowed; /* İmleç devre dışı olduğunu gösterir */
}

.summary-text {
  margin-top: 0.5rem; /* Özet metni ile üstteki açıklama arasında boşluk */
  font-style: italic; /* Özet metnini biraz farklı gösterelim */
}



.code-block-container pre {
  background: var(--code-bg);
  padding: 16px;
  font-family: 'Fira Code', monospace;
  font-size: 14px;
  color: var(--code-text);
  border: 1px solid var(--code-border);
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
  user-select: none; /* Kodun seçilmesini engeller */
  pointer-events: none; /* Tıklanmasını ve düzenlenmesini engeller */
}

body.dark .code-block-container pre {
  background: var(--code-bg);
  border-color: #333;
  color: var(--code-text);
  box-shadow: 0 4px 12px rgba(255, 255, 255, 0.05);
}

.system-label {
  font-size: 0.8rem;
  font-weight: 600;
  color: var(--text-color);
  margin-right: 10px;
}

/* Ensure the tooltip for new-chat-btn appears to the right when sidebar is closed */
body:not(.sidebar-open) .new-chat-btn[data-tooltip]::after {
  left: calc(100% + 8px) !important; /* Position it to the right of the button */
  right: auto !important;             /* Override the existing right positioning */
  top: 50% !important;                /* Vertically center it */
  transform: translateY(-50%) !important; /* Adjust for vertical centering */
}

/* Style for the new voice page button */
#voice-page-btn {
  position: absolute;
  background-color: var(--input-bg);
  border: none;
  border-radius: 12px;
  width: 40px;
  height: 35px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  right: 122.5px; /* Positioned to the left of the send button, next to the mic */
  bottom: 15px;
  box-shadow: 0 4px 6px -2px rgba(0, 0, 0, 0.15), 4px 0 6px -2px rgba(0, 0, 0, 0.15), -4px 0 6px -2px rgba(0, 0, 0, 0.15), 0 -4px 6px -2px rgba(0, 0, 0, 0.15);
}

#voice-page-btn:hover {
  background-color: #c0c0c0;
}

body.dark #voice-page-btn img {
  filter: brightness(0) invert(1);
}

body.dark #voice-page-btn:hover img {
  filter: none;
}

/* Fade-out animation */
@keyframes fadeOut {
  0% { opacity: 1; }
  100% { opacity: 0; }
}

.fade-out {
  animation: fadeOut 0.5s ease forwards;
}

/* Emoji Button Styling */
.emoji-btn {
  position: fixed;
  bottom: 15px;
  left: 142px;
  z-index: 200;
  background-color: transparent;
  border: none;
  box-shadow: 0 4px 6px -2px rgba(0, 0, 0, 0.15),
              4px 0 6px -2px rgba(0, 0, 0, 0.15),
              -4px 0 6px -2px rgba(0, 0, 0, 0.15),
              0 -4px 6px -2px rgba(0, 0, 0, 0.15);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 40px;
  height: 35px;
  border-radius: 12px;
  color: var(--text-color);
}

.emoji-btn:hover {
  background-color: #c0c0c0; /* Matches hover effect of other buttons */
}

@media (max-width: 768px) {
  .emoji-btn {
  left: 122px;
}
}

body.dark .emoji-btn {
  box-shadow: 0 4px 6px -2px rgba(0, 0, 0, 0.15),
              4px 0 6px -2px rgba(0, 0, 0, 0.15),
              -4px 0 6px -2px rgba(0, 0, 0, 0.15),
              0 -4px 6px -2px rgba(0, 0, 0, 0.15);
}

body.dark .emoji-btn img {
  filter: brightness(0) invert(1); /* Matches dark mode icon behavior */
}

body.dark .emoji-btn:hover img {
  filter: none; /* Matches hover behavior of other buttons */
}

body.dark .emoji-btn:hover {
  background-color: #c0c0c0;
  color: var(--sidebar-bg);
}

/* Emoji Picker Styling */
.emoji-picker {
  position: absolute;
  left: 0;
  right: 0;
  bottom: calc(100%); /* chat-input’un üstüne 10px boşlukla yerleştirme */
  width: auto; /* Gerekirse genişlik düzenleyin, örneğin: 100% */
  max-height: 215px; /* Eğer kaydırma isterseniz */
  margin: 0 auto;    /* Kapsayıcıyı yatayda ortalar */
  background-color: var(--input-bg);
  border-radius: 24px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
  padding: 10px;
  overflow-y: auto;
  z-index: 201;
  display: none; /* Varsayılan olarak gizli, emoji butonuyla açılır */
  animation: fadeIn 0.3s ease;
}

body.dark .emoji-picker {
  background-color: var(--input-bg);
}

.emoji-picker-tabs {
  display: flex;
  justify-content: space-around;  /* Butonlar arasında eşit boşluk */
  padding-bottom: 5px;
}

.emoji-tab {
  background: none;
  border: none;
  padding: 7px 10px;
  cursor: pointer;
  font-size: 14px;
  margin-bottom: 5px;
  color: var(--text-color);
}

.emoji-tab.active {
  background: #c0c0c0;
  border-radius: 12px;
}

body.dark .emoji-tab.active {
  color: #000000;
}

/* Emoji Arama Alanı */
.emoji-search-container {
  width: 100%;
  max-width: 100%;
  box-sizing: border-box;
  display: flex;
  align-items: center;
  padding: 5px;
  border: 1px solid rgba(200, 200, 200, 0.7);
  border-radius: 8px;                     /* Kenarların yuvarlanması */
  background-color: var(--input-bg);      /* Arka plan rengi */
  margin-bottom: 10px;
}

.emoji-search-container input {
  width: 100%;
  padding: 2px;
  border: none;             /* İç kenarlıkları kaldırıyoruz */
  outline: none;
  font-size: 0.9rem;
  background-color: transparent; /* Container arka planı yeterli olur */
  color: var(--text-color);
}

.emoji-grid-container .emoji-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(35px, 1fr));
  gap: 5px;               /* Emoji arası boşluk, ihtiyaca göre ayarlanabilir */
  justify-items: center;   /* Her emoji hücresinin içeriğini ortalar */
}

.emoji {
  width: 35px;            /* Sabit genişlik */
  height: 35px;           /* Sabit yükseklik */
  display: inline-flex;   /* Inline-flex kullanarak satır içi öğe olarak kalır ve hizalama kolaylaşır */
  align-items: center;     /* Dikey ortalama */
  justify-content: center; /* Yatay ortalama */
  font-size: 24px;        /* Emoji boyutu */
  cursor: pointer;
  text-align: center;
  margin: 0;              /* Varsayılan boşlukları kaldır */
  padding: 0;             /* İç boşlukları kaldır */
  line-height: 1;         /* Satır yüksekliğini sabitle */
}

.emoji:hover {
  background-color: #c0c0c0; /* Hover arka plan rengi */
  border-radius: 5px;        /* Yuvarlak kenarlar */
}

body.dark .emoji:hover {
  background-color: #444; /* Dark mode hover */
}

.sidebar-search-wrapper {
  display: flex;
  align-items: center;
  padding-top: 0.5rem ;
  gap: 0.5rem;
}

.sidebar-search-toggle {
  position: fixed;
  top: 9px;      /* settings-btn ile aynı hizada */
  right: 53px;   /* Ayarlar butonundan (right:13px) solda konumlanacak, bu değeri ihtiyaca göre ayarlayın */
  border: none;
  background: none;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: transform 0.3s ease, color 0.3s ease;
  color: var(--text-color);
  width: 40px;
  height: 40px;
}

.sidebar-search-toggle:hover {
  background: #c0c0c0;
}


body.dark .sidebar-search-toggle img {
    filter: brightness(0) invert(1);
}

body.dark .sidebar-search-toggle:hover img {
  filter: none; /* ya da farklı bir şey: örneğin grayscale(100%) */
}

.sidebar-search-container {
  width: 100%;           /* Ebeveynin (sidebar) tamamına uyar */
  max-width: 100%;       /* Genişlik asla sidebar'ı aşmaz */
  box-sizing: border-box;  /* Padding ve border genişliğe dahil edilir */
  display: flex;
  align-items: center;
  padding: 5px;
  border: 1px solid var(--code-border);
  border-radius: 8px;
  height: 50px;
  background-color: var(--input-bg);
  position: absolute;
  top: -30%;
  left: 510%;
}

#sidebar-search-input {
  width: 100%;
  max-width: 100%;
  flex: 1;
  border: none;
  outline: none;
  font-size: 0.9rem;
  font-family: 'Inter', sans-serif;
  background-color: transparent;
  color: var(--text-color);
}

.sidebar-search-close {
  background: none;
  border: none;
  color: var(--text-color);
  font-size: 1rem;
  cursor: pointer;
}

/* Chat Search Modal Stilleri */
.chat-search-modal-content {
  background-color: var(--sidebar-bg);
  width: 90%;
  max-width: 700px;
  min-height: 90vh;
  margin: 3vh auto;
  border-radius: 3vh;
  box-shadow: 0 8px 30px rgba(0, 0, 0, 0.5);
  overflow: hidden; /* İç taşmayı engelle */
  display: flex;
  flex-direction: column;
  box-sizing: border-box;
}

#chat-search-modal {
  display: none;
  position: fixed;
  z-index: 306;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.7); /* Hafif karartma efekti */
  backdrop-filter: blur(4px);
  -webkit-backdrop-filter: blur(4px);
  animation: fadeIn 0.3s ease;
}

.chat-search-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding-top: 10px;
  border-bottom: 1px solid var(--code-border);
}

.chat-search-header h2 {
  margin: 0 10px 20px;
  font-size: 1.1rem;
  color: var(--text-color);
}

.chat-search-body {
  flex: 1;
  display: flex;
  flex-direction: column;
  padding-top: 10px;
}

.chat-search-input-wrapper {
  display: flex;
  align-items: center;
  padding: 12px;
  border: 1px solid var(--code-border);
  border-radius: 8px;
  background-color: var(--input-bg);
  margin-bottom: 10px;
}

#chat-search-input {
  width: 100%;
  border: none;
  outline: none;
  font-size: 0.9rem;
  font-family: 'Inter', sans-serif;
  background-color: transparent;
  color: var(--text-color);
}

#chat-search-results {
  list-style: none;
  padding: 0;
  margin: 0;
  max-height: calc(80vh - 100px); /* Arama çubuğu ve kapatma butonu için boşluk */
  overflow-y: auto; /* Çok başlık varsa kaydırma */
  scrollbar-width: thin;
  scrollbar-color: rgba(85, 85, 85, 0.2) transparent;
}

#chat-search-results::-webkit-scrollbar {
  width: 6px;
}

#chat-search-results::-webkit-scrollbar-track {
  background: transparent;
}

.#chat-search-results::-webkit-scrollbar-thumb {
  background-color: rgba(85, 85, 85, 0.2);
  border-radius: 10px;
  border: 2px solid transparent;
  background-clip: content-box;
}

#chat-search-results::-webkit-scrollbar-thumb:hover {
  background-color: rgba(85, 85, 85, 0.5);
}

.chat-search-result-item {
  padding: 10px;
  cursor: pointer;
  border-bottom: 1px solid var(--code-border);
  color: var(--text-color);
  font-size: 0.9rem;
}

.chat-search-result-item:hover {
  background-color: #c0c0c0;
  border-radius: 12px;
}

body.dark .chat-search-result-item:hover {
  background-color: #333;
}

.chat-search-result-item.active {
  background-color: #c0c0c0;
  font-weight: 600;
}

body.dark .chat-search-result-item.active {
  background-color: #c0c0c0;
}

.search-item-title {
  font-size: 1.2em;      /* Başlıklar biraz daha büyük görünsün */
  font-weight: bold;
  margin-bottom: 4px;
}

.search-item-snippet {
  font-size: 0.9em;     /* Sonuç metni (snippet) biraz daha küçük olsun */
  color: #666;
}

#chat-search-close {
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: var(--sidebar-bg);  /* Light modda sidebar rengi, örn: beyaz */
  border: none;
  width: 35px;
  height: 35px;
  top: 25px;
  right: 7px;
  border-radius: 18px;
  cursor: pointer;
  color: var(--text-color);
}

#chat-search-close:hover {
  background-color: #c0c0c0;
}

body.dark #chat-search-close:hover {
  background-color: #c0c0c0; /* Dark modda sidebar rengi */
  color: var(--sidebar-bg);
}


/* Mobil Uyumluluk */
@media (max-width: 768px) {
  .chat-search-modal-content {
    margin: 0;
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    max-height: 80vh;
    border-radius: 12px 12px 0 0;
    overflow-y: auto;
  }
}

body.modal-active #sidebar-search-toggle {
  filter: blur(4px) !important;
  pointer-events: none !important;
}

.sidebar-search-toggle.blurred {
  filter: blur(3px);
  pointer-events: none;
  transition: filter 0.3s ease;
  opacity: 0.8;
}


  </style>
</head>

<body>
  <!-- Sabit Toggle Sidebar Butonu -->
  <button id="toggle-sidebar-btn">
    <img src="icons/sidebar_close_btn.png" alt="Sidebar Icon" style="width:24px; height:21px;" draggable="false">
  </button>

<!-- Yeni Model Seçme Alanı -->
<div id="model-selector" class="model-selector">
  <button id="model-toggle-btn" class="model-toggle-btn">
    <span id="current-model-name">quik-prime</span>

  </button>
  <div id="model-dropdown" class="model-dropdown">
    <button class="model-option" data-model="quik-prime">
      <span class="model-name">quik-prime</span>
      <div>
      <span class="model-description">Günlük ve hızlı</span>
      </div>
    </button>
    <button class="model-option" data-model="quik-think">
      <span class="model-name">quik-think</span>
      <div>
      <span class="model-description">Mantık ve analiz</span>
      </div>
    </button>
  </div>
</div>


  <div id="app">
  <!-- Sidebar -->
  <div id="sidebar" class="sidebar">
<div class="sidebar-header">

<!-- Sidebar içinde, chat-history-list'ten önce eklenebilir -->
<div class="sidebar-search-wrapper">



</div>

  <span class="brand" id="sidebar-brand">
    <img src="icons/quik_icon.png" alt="Quik Logo" id="sidebar-brand-icon" draggable="false">
  </span>
</div>

    <button id="new-chat-btn" data-tooltip="Yeni Sohbet" class="new-chat-btn">
      <img src="icons/new_chat_btn.png" alt="Chat Icon" style="width:21px; height:21px;" draggable="false">
    </button>




    <ul id="chat-history-list" class="chat-history-list"></ul>
  </div>
  
  <!-- Main İçerik -->
  <div class="main-content">
    <div class="top-bar">
      <!-- Top bar içerikleri (varsa) -->
    </div>
    
    <div class="scroll-wrapper">
      <div id="chat-container" class="chat-container">
<div id="welcome-message" class="welcome-message" ondragstart="return false;">
  <div class="logo-container">
  </div>

  <h1>Nasıl yardımcı olabilirim?</h1>
</div>

        <!-- Diğer mesajlar buraya eklenir -->
      </div>
    </div>
  </div>
</div>

<!-- Chat Input kısmı -->
<div class="chat-input">
  <div class="file-container" id="file-container"></div> <!-- Container for uploaded files -->
  <button class="file-upload-btn" id="file-upload-btn" data-tooltip="Dosya Ekle">
    <img src="icons/addfile_btn.png" alt="Add File Icon" style="width:20px; height:20px;" draggable="false">
  </button>
  <button id="web-search-btn" data-tooltip="Web Araması">
    <img src="icons/web_search_btn.png" alt="Web Search Icon" style="width:20px; height:20px; margin-right: 5px;" draggable="false">
    <span>Ara</span>
  </button>

<button id="emoji-btn" class="emoji-btn" data-tooltip="Emoji Ekle">
  <img src="icons/emoji_icon.png" alt="Emoji" style="width:17px; height:17px;" draggable="false" />
</button>

<div id="emoji-picker" class="emoji-picker">
  <!-- Kategori Sekmeleri -->
  <div class="emoji-picker-tabs">
    <button class="emoji-tab active" data-category="faces">😊 Yüz</button>
    <button class="emoji-tab" data-category="animals">🐶 Hayvan & Doğa</button>
    <button class="emoji-tab" data-category="food">🍔 Yiyecek & İçecek</button>
  </div>

  <!-- Emoji Arama Alanı -->
  <div class="emoji-search-container">
    <input type="text" id="emoji-search-input" placeholder="Emoji ara..." />
  </div>

  <!-- Emoji Grid Konteyneri -->
  <div class="emoji-grid-container">
<!-- Yüz Emojileri -->
<div class="emoji-grid" data-category="faces">
  <span class="emoji" data-emoji="😀">😀</span>
  <span class="emoji" data-emoji="😃">😃</span>
  <span class="emoji" data-emoji="😄">😄</span>
  <span class="emoji" data-emoji="😁">😁</span>
  <span class="emoji" data-emoji="😆">😆</span>
  <span class="emoji" data-emoji="😅">😅</span>
  <span class="emoji" data-emoji="🤣">🤣</span>
  <span class="emoji" data-emoji="😂">😂</span>
  <span class="emoji" data-emoji="🙂">🙂</span>
  <span class="emoji" data-emoji="🙃">🙃</span>
  <span class="emoji" data-emoji="😉">😉</span>
  <span class="emoji" data-emoji="😊">😊</span>
  <span class="emoji" data-emoji="😇">😇</span>
  <span class="emoji" data-emoji="🥰">🥰</span>
  <span class="emoji" data-emoji="😍">😍</span>
  <span class="emoji" data-emoji="🤩">🤩</span>
  <span class="emoji" data-emoji="😘">😘</span>
  <span class="emoji" data-emoji="😗">😗</span>
  <span class="emoji" data-emoji="😚">😚</span>
  <span class="emoji" data-emoji="😙">😙</span>
  <span class="emoji" data-emoji="😋">😋</span>
  <span class="emoji" data-emoji="😛">😛</span>
  <span class="emoji" data-emoji="😜">😜</span>
  <span class="emoji" data-emoji="🤪">🤪</span>
  <span class="emoji" data-emoji="🤗">🤗</span>
  <span class="emoji" data-emoji="🤔">🤔</span>
  <span class="emoji" data-emoji="🤭">🤭</span>
  <span class="emoji" data-emoji="🤫">🤫</span>
  <span class="emoji" data-emoji="🤥">🤥</span>
  <span class="emoji" data-emoji="😶">😶</span>
  <span class="emoji" data-emoji="😐">😐</span>
  <span class="emoji" data-emoji="😑">😑</span>
  <span class="emoji" data-emoji="😬">😬</span>
  <span class="emoji" data-emoji="🙄">🙄</span>
  <span class="emoji" data-emoji="😏">😏</span>
  <span class="emoji" data-emoji="😒">😒</span>
  <span class="emoji" data-emoji="😞">😞</span>
  <span class="emoji" data-emoji="😔">😔</span>
  <span class="emoji" data-emoji="😟">😟</span>
  <span class="emoji" data-emoji="😕">😕</span>
  <span class="emoji" data-emoji="🙁">🙁</span>
  <span class="emoji" data-emoji="☹️">☹️</span>
  <span class="emoji" data-emoji="😣">😣</span>
  <span class="emoji" data-emoji="😖">😖</span>
  <span class="emoji" data-emoji="😫">😫</span>
  <span class="emoji" data-emoji="😩">😩</span>
  <span class="emoji" data-emoji="🥺">🥺</span>
  <span class="emoji" data-emoji="😢">😢</span>
  <span class="emoji" data-emoji="😭">😭</span>
<span class="emoji" data-emoji="🥹">🥹</span>
<span class="emoji" data-emoji="🤤">🤤</span>
<span class="emoji" data-emoji="😵‍💫">😵‍💫</span>
<span class="emoji" data-emoji="😵">😵</span>
<span class="emoji" data-emoji="😲">😲</span>
<span class="emoji" data-emoji="😳">😳</span>
<span class="emoji" data-emoji="🥴">🥴</span>
<span class="emoji" data-emoji="😦">😦</span>
<span class="emoji" data-emoji="😧">😧</span>
<span class="emoji" data-emoji="😨">😨</span>
<span class="emoji" data-emoji="😰">😰</span>
<span class="emoji" data-emoji="😱">😱</span>
<span class="emoji" data-emoji="😤">😤</span>
<span class="emoji" data-emoji="😡">😡</span>
<span class="emoji" data-emoji="🤬">🤬</span>
<span class="emoji" data-emoji="😠">😠</span>
<span class="emoji" data-emoji="🤒">🤒</span>
<span class="emoji" data-emoji="🤢">🤢</span>
<span class="emoji" data-emoji="🤮">🤮</span>
<span class="emoji" data-emoji="😷">😷</span>
<span class="emoji" data-emoji="🤧">🤧</span>
<span class="emoji" data-emoji="🥳">🥳</span>
<span class="emoji" data-emoji="🤓">🤓</span>
<span class="emoji" data-emoji="🧐">🧐</span>
<span class="emoji" data-emoji="😎">😎</span>
<span class="emoji" data-emoji="🤠">🤠</span>
<span class="emoji" data-emoji="🥸">🥸</span>
<span class="emoji" data-emoji="🥵">🥵</span>
<span class="emoji" data-emoji="🥶">🥶</span>
<span class="emoji" data-emoji="🤑">🤑</span>
<span class="emoji" data-emoji="🤡">🤡</span>
<span class="emoji" data-emoji="💩">💩</span>
<span class="emoji" data-emoji="👻">👻</span>
<span class="emoji" data-emoji="💀">💀</span>
<span class="emoji" data-emoji="☠️">☠️</span>
<span class="emoji" data-emoji="👽">👽</span>
<span class="emoji" data-emoji="👾">👾</span>
<span class="emoji" data-emoji="🤖">🤖</span>
<span class="emoji" data-emoji="🎃">🎃</span>
<span class="emoji" data-emoji="😺">😺</span>
<span class="emoji" data-emoji="😸">😸</span>
<span class="emoji" data-emoji="😹">😹</span>
<span class="emoji" data-emoji="😻">😻</span>
<span class="emoji" data-emoji="😼">😼</span>
<span class="emoji" data-emoji="😽">😽</span>
<span class="emoji" data-emoji="🙀">🙀</span>
<span class="emoji" data-emoji="😿">😿</span>
<span class="emoji" data-emoji="😾">😾</span>

</div>
<!-- Hayvan & Doğa Emojileri -->
<div class="emoji-grid" data-category="animals" style="display: none;">
<span class="emoji" data-emoji="🐶">🐶</span>
<span class="emoji" data-emoji="🐱">🐱</span>
<span class="emoji" data-emoji="🐭">🐭</span>
<span class="emoji" data-emoji="🐹">🐹</span>
<span class="emoji" data-emoji="🦊">🦊</span>
<span class="emoji" data-emoji="🐻">🐻</span>
<span class="emoji" data-emoji="🐼">🐼</span>
<span class="emoji" data-emoji="🐨">🐨</span>
<span class="emoji" data-emoji="🐯">🐯</span>
<span class="emoji" data-emoji="🦁">🦁</span>
<span class="emoji" data-emoji="🐷">🐷</span>
<span class="emoji" data-emoji="🐸">🐸</span>
<span class="emoji" data-emoji="🐵">🐵</span>
<span class="emoji" data-emoji="🙈">🙈</span>
<span class="emoji" data-emoji="🙉">🙉</span>
<span class="emoji" data-emoji="🙊">🙊</span>
<span class="emoji" data-emoji="🐔">🐔</span>
<span class="emoji" data-emoji="🐧">🐧</span>
<span class="emoji" data-emoji="🐦">🐦</span>
<span class="emoji" data-emoji="🐤">🐤</span>
<span class="emoji" data-emoji="🐣">🐣</span>
<span class="emoji" data-emoji="🐥">🐥</span>
<span class="emoji" data-emoji="🦆">🦆</span>
<span class="emoji" data-emoji="🦉">🦉</span>
<span class="emoji" data-emoji="🐺">🐺</span>
<span class="emoji" data-emoji="🐗">🐗</span>
<span class="emoji" data-emoji="🐴">🐴</span>
<span class="emoji" data-emoji="🦄">🦄</span>
<span class="emoji" data-emoji="🐍">🐍</span>
<span class="emoji" data-emoji="🦎">🦎</span>
<span class="emoji" data-emoji="🐢">🐢</span>
<span class="emoji" data-emoji="🦖">🦖</span>
<span class="emoji" data-emoji="🦕">🦕</span>
<span class="emoji" data-emoji="🐙">🐙</span>
<span class="emoji" data-emoji="🦑">🦑</span>
<span class="emoji" data-emoji="🦀">🦀</span>
<span class="emoji" data-emoji="🦞">🦞</span>
<span class="emoji" data-emoji="🐡">🐡</span>
<span class="emoji" data-emoji="🐬">🐬</span>
<span class="emoji" data-emoji="🐳">🐳</span>
<span class="emoji" data-emoji="🐘">🐘</span>
<span class="emoji" data-emoji="🦍">🦍</span>
<span class="emoji" data-emoji="🐪">🐪</span>
<span class="emoji" data-emoji="🐫">🐫</span>
<span class="emoji" data-emoji="🦒">🦒</span>
<span class="emoji" data-emoji="🦓">🦓</span>
<span class="emoji" data-emoji="🦬">🦬</span>
<span class="emoji" data-emoji="🐄">🐄</span>
<span class="emoji" data-emoji="🐖">🐖</span>
<span class="emoji" data-emoji="🐏">🐏</span>
<span class="emoji" data-emoji="🐑">🐑</span>
<span class="emoji" data-emoji="🦌">🦌</span>
<span class="emoji" data-emoji="🦘">🦘</span>
<span class="emoji" data-emoji="🦝">🦝</span>
<span class="emoji" data-emoji="🦡">🦡</span>
<span class="emoji" data-emoji="🦨">🦨</span>
<span class="emoji" data-emoji="🐇">🐇</span>
<span class="emoji" data-emoji="🐿️">🐿️</span>
<span class="emoji" data-emoji="🦔">🦔</span>
<span class="emoji" data-emoji="🐾">🐾</span>
<span class="emoji" data-emoji="🪴">🪴</span>
<span class="emoji" data-emoji="🌵">🌵</span>
<span class="emoji" data-emoji="🎄">🎄</span>
<span class="emoji" data-emoji="🌳">🌳</span>
<span class="emoji" data-emoji="🌲">🌲</span>
<span class="emoji" data-emoji="🌴">🌴</span>
<span class="emoji" data-emoji="🌻">🌻</span>
<span class="emoji" data-emoji="🌼">🌼</span>
<span class="emoji" data-emoji="🌸">🌸</span>
<span class="emoji" data-emoji="🌹">🌹</span>
<span class="emoji" data-emoji="💐">💐</span>
<span class="emoji" data-emoji="🌺">🌺</span>
<span class="emoji" data-emoji="🌷">🌷</span>
<span class="emoji" data-emoji="🌞">🌞</span>
<span class="emoji" data-emoji="🌝">🌝</span>
<span class="emoji" data-emoji="🌜">🌜</span>
<span class="emoji" data-emoji="🌛">🌛</span>
<span class="emoji" data-emoji="🌕">🌕</span>
<span class="emoji" data-emoji="🌖">🌖</span>
<span class="emoji" data-emoji="🌗">🌗</span>
<span class="emoji" data-emoji="🌘">🌘</span>
<span class="emoji" data-emoji="🌑">🌑</span>
<span class="emoji" data-emoji="🌒">🌒</span>
<span class="emoji" data-emoji="🌓">🌓</span>
<span class="emoji" data-emoji="🌔">🌔</span>
<span class="emoji" data-emoji="🌍">🌍</span>
<span class="emoji" data-emoji="🌎">🌎</span>
<span class="emoji" data-emoji="🌏">🌏</span>
<span class="emoji" data-emoji="☀️">☀️</span>
<span class="emoji" data-emoji="🌈">🌈</span>
<span class="emoji" data-emoji="☁️">☁️</span>
<span class="emoji" data-emoji="🌧️">🌧️</span>
<span class="emoji" data-emoji="🌦️">🌦️</span>
<span class="emoji" data-emoji="⛈️">⛈️</span>
<span class="emoji" data-emoji="🌩️">🌩️</span>
<span class="emoji" data-emoji="🌨️">🌨️</span>
<span class="emoji" data-emoji="❄️">❄️</span>
<span class="emoji" data-emoji="☃️">☃️</span>
<span class="emoji" data-emoji="⛅">⛅</span>
<span class="emoji" data-emoji="🌪️">🌪️</span>
<span class="emoji" data-emoji="🌊">🌊</span>
</div>
<!-- Yiyecek & İçecek Emojileri -->
<div class="emoji-grid" data-category="food" style="display: none;">
  <span class="emoji" data-emoji="🍎">🍎</span>
  <span class="emoji" data-emoji="🍌">🍌</span>
  <span class="emoji" data-emoji="🍇">🍇</span>
  <span class="emoji" data-emoji="🍉">🍉</span>
  <span class="emoji" data-emoji="🍓">🍓</span>
  <span class="emoji" data-emoji="🍒">🍒</span>
  <span class="emoji" data-emoji="🍑">🍑</span>
  <span class="emoji" data-emoji="🍍">🍍</span>
  <span class="emoji" data-emoji="🥝">🥝</span>
  <span class="emoji" data-emoji="🍐">🍐</span>
  <span class="emoji" data-emoji="🍅">🍅</span>
  <span class="emoji" data-emoji="🌽">🌽</span>
  <span class="emoji" data-emoji="🥕">🥕</span>
  <span class="emoji" data-emoji="🥑">🥑</span>
  <span class="emoji" data-emoji="🍆">🍆</span>
  
  <span class="emoji" data-emoji="🍔">🍔</span>
  <span class="emoji" data-emoji="🍕">🍕</span>
  <span class="emoji" data-emoji="🍟">🍟</span>
  <span class="emoji" data-emoji="🌭">🌭</span>
  <span class="emoji" data-emoji="🥪">🥪</span>
  <span class="emoji" data-emoji="🌮">🌮</span>
  <span class="emoji" data-emoji="🌯">🌯</span>
  <span class="emoji" data-emoji="🍗">🍗</span>
  <span class="emoji" data-emoji="🍖">🍖</span>
  <span class="emoji" data-emoji="🍤">🍤</span>
  <span class="emoji" data-emoji="🍣">🍣</span>
  <span class="emoji" data-emoji="🍜">🍜</span>
  <span class="emoji" data-emoji="🍝">🍝</span>
  <span class="emoji" data-emoji="🍲">🍲</span>
  <span class="emoji" data-emoji="🥘">🥘</span>
  <span class="emoji" data-emoji="🥙">🥙</span>
  
  <span class="emoji" data-emoji="☕">☕</span>
  <span class="emoji" data-emoji="🍵">🍵</span>
  <span class="emoji" data-emoji="🍶">🍶</span>
  <span class="emoji" data-emoji="🍺">🍺</span>
  <span class="emoji" data-emoji="🍻">🍻</span>
  <span class="emoji" data-emoji="🍷">🍷</span>
  <span class="emoji" data-emoji="🍸">🍸</span>
  <span class="emoji" data-emoji="🍹">🍹</span>
  <span class="emoji" data-emoji="🥂">🥂</span>
  <span class="emoji" data-emoji="🍾">🍾</span>
  
  <span class="emoji" data-emoji="🍦">🍦</span>
  <span class="emoji" data-emoji="🍩">🍩</span>
  <span class="emoji" data-emoji="🍪">🍪</span>
  <span class="emoji" data-emoji="🍰">🍰</span>
  <span class="emoji" data-emoji="🎂">🎂</span>
  <span class="emoji" data-emoji="🍮">🍮</span>
  <span class="emoji" data-emoji="🍫">🍫</span>
</div>


  </div>
</div>



<button id="voice-record-btn" class="voice-record-btn" data-tooltip="Ses Kaydet">
    <img src="icons/mic_btn.png" alt="Ses Kaydet" style="width: 17px; height: 17px;" draggable="false">
  </button>

<button id="voice-page-btn" data-tooltip="Sesli sohbete başla">
    <img src="icons/voice_page_icon.png" alt="Ses Sayfası" style= "width: 17px; height: 17px;" draggable="false">
  </button>

  <textarea id="chat-input-textarea" placeholder="Quik uygulamasına ileti gönder..."></textarea>
  <button id="send-btn" class="send-btn" data-tooltip="Gönder">
    <img src="icons/send_btn.png" alt="Send Icon" style="width:17px; height:17px;" draggable="false">
  </button>
</div>

<div id="drop-zone" class="drop-zone">
  <p>Dosyalarınızı buraya bırakın</p>
  <p class="subtext">Dosyalarınızı buraya bırakarak sohbete ekleyin</p>
</div>

<!-- Yeni: Sidebar arama butonu, settings-btn'ün solunda -->
<button id="sidebar-search-toggle" data-tooltip="Sohbet Ara" class="sidebar-search-toggle">
  <img src="icons/search_icon.png" alt="Ara" style="width:20px; height:20px;" draggable="false">
</button>

<!-- Sohbet Arama Modalı -->
<div id="chat-search-modal" class="modal">
  <div class="modal-content chat-search-modal-content">
    <!-- Kapatma Butonu -->
    <span id="chat-search-close" class="modal-close">&times;</span>
    <!-- Arama Başlığı -->
    <div class="chat-search-header">
      <h2>Sohbet Ara</h2>
    </div>
    <!-- Arama Alanı -->
    <div class="chat-search-body">
      <div class="chat-search-input-wrapper">
        <input id="chat-search-input" type="text" placeholder="Başlık veya içerik ara..." />
      </div>
      <!-- Arama Sonuçları -->
      <ul id="chat-search-results" class="chat-search-results"></ul>
    </div>
  </div>
</div>

<!-- Ayarlar Butonu -->
<button id="settings-btn" data-tooltip="Ayarlar" class="settings-btn">
  <img src="icons/settings_icon.png" alt="Settings Icon" style="width:24px; height:21px;" draggable="false">
</button>

<!-- Ayarlar Modal'ı (GÜNCELLENMİŞ, Estetik) -->
<div id="settings-modal" class="modal">
  <div class="modal-content settings-modal-content">
    <!-- Kapat Butonu -->
    <span id="settings-close" class="modal-close settings-close">&times;</span>
    <!-- Başlık -->
    <div class="settings-header">
      <h2>Ayarlar</h2>
    </div>

    <!-- Ayarlar Gövdesi -->
    <div class="settings-body">
      <!-- SOL: Sekme Menüsü -->
      <nav class="settings-nav" aria-label="Ayar Kategorileri">
        <ul>

  <li class="active" data-tab="genel">
    <img src="icons/genel.png" class="settings-icon" alt="Genel" draggable="false">
    Genel
  </li>

  <li data-tab="bildirimler">
    <img src="icons/bildirimler.png" class="settings-icon" alt="Bildirimler" draggable="false">
    Bildirimler
  </li>

<li data-tab="kisisellestirme">
    <img src="icons/kisisellestirme.png" class="settings-icon" alt="Kişiselleştirme" draggable="false">
    Kişiselleştirme
  </li>

<li data-tab="konusma">
    <img src="icons/konusma.png" class="settings-icon" alt="Konuşma" draggable="false">
    Konuşma
  </li>

<li data-tab="gecmis">
    <img src="icons/gecmis.png" class="settings-icon" alt="Geçmiş" draggable="false">
    Geçmiş
  </li>

<li data-tab="bagliuygulamalar">
    <img src="icons/bagli_uygulamalar.png" class="settings-icon" alt="Bağlı Uygulamalar" draggable="false">
    Bağlı Uygulamalar
  </li>

<li data-tab="baglisistemler">
    <img src="icons/bagli_sistemler.png" class="settings-icon" alt="Bağlı Sistemler" draggable="false">
    Bağlı Sistemler
  </li>

<li data-tab="bagliprogramlar">
    <img src="icons/bagli_programlar.png" class="settings-icon" alt="Bağlı Programlar" draggable="false">
    Bağlı Programlar
  </li>

<li data-tab="hesap">
    <img src="icons/hesap.png" class="settings-icon" alt="Hesap" draggable="false">
    Hesap
  </li>

        </ul>
      </nav>

      <!-- SAĞ: Sekme İçerikleri -->
      <div class="settings-content">


<!-- GENEL Sekmesi (YENİ) -->
<div class="tab-content active" id="genel">
  <div class="general-container">

    <!-- 1. Kart: Görünüm -->
<div class="general-card">
  <div class="card-topbar">
    <div class="general-heading-left">
      <img src="icons/appearance.png" alt="Görünüm" class="general-icon" draggable="false">
      <span class="general-name">Görünüm</span>
    </div>
  </div>
  <p class="general-description">
    Tema seçimini buradan yapabilirsiniz.
  </p>
  <div class="theme-selection">
    <button id="light-mode-btn" class="theme-btn">
      <img src="icons/aydinlik.png" alt="Aydınlık Mod" class="theme-icon" draggable="false">
      Aydınlık
    </button>
    <button id="dark-mode-btn" class="theme-btn">
      <img src="icons/karanlik.png" alt="Karanlık Mod" class="theme-icon" draggable="false">
      Karanlık
    </button>
    <button id="system-mode-btn" class="theme-btn">
      <img src="icons/sistem.png" alt="Sistem Modu" class="theme-icon" draggable="false">
      Sistem
    </button>
  </div>
</div>

    <!-- 2. Kart: Web Arama -->
    <div class="general-card">
      <div class="general-header">
        <div class="general-heading-left">
          <img src="icons/web_search.png" alt="Web Arama" class="general-icon" draggable="false">
          <span class="general-name">Web Arama</span>
        </div>
      </div>
      <p class="general-description">
        Web aramasını açıp kapatabilir veya devre dışı bırakabilirsiniz.
      </p>
<div class="web-search-toggle-group">
  <button id="web-search-on-btn" class="web-search-btn active">
    <img src="icons/web_search_btn.png" alt="Web Açık" class="web-search-icon" draggable="false">
    Açık
  </button>
  <button id="web-search-off-btn" class="web-search-btn">
    <img src="icons/web_search_btn_cancel.png" alt="Web Kapalı" class="web-search-icon" draggable="false">
    Kapalı
  </button>
  <button id="web-search-disable-btn" class="web-search-btn">
    <img src="icons/web_search_disable.png" alt="Devre Dışı" class="web-search-icon" draggable="false">
    Devre Dışı
  </button>
</div>
</div>

<!--3. Kart: Dil Seçimi Kartı -->
<div class="general-card">
  <div class="card-topbar">
    <div class="general-heading-left">
      <img src="icons/language.png" alt="Dil Seçimi" class="general-icon" draggable="false">
      <span class="general-name">Dil Seçimi</span>
    </div>
  </div>
  <p class="general-description">
    Uygulama arayüzü için tercih ettiğiniz dili seçin.
  </p>
  <div class="language-selection">
    <select id="language-select">
      <option value="tr">Türkçe</option>
      <option value="en">English</option>
      <option value="es">Español</option>
      <option value="fr">Français</option>
      <!-- Diğer diller ekleyebilirsiniz -->
    </select>
  </div>
</div>


  </div> <!-- /general-container -->
</div>

<!-- BİLDİRİMLER Sekmesi (YENİ) -->
<div class="tab-content" id="bildirimler">
  <!-- Konteyner: Tüm bildirim ayarlarını saran ana kapsayıcı -->
  <div class="notifications-container">

    <!-- 1. Kart: Uygulama bildirimi -->
    <div class="notification-card">
      <div class="notification-header">
        <!-- İkon (opsiyonel) -->
        <div class="notification-heading-left">
          <img src="icons/notification.png" alt="Bildirim" class="notification-icon" draggable="false">
          <span class="notification-name">Uygulama Bildirimi</span>
        </div>

        <!-- Switch (Toggle) -->
        <label class="notification-switch">
          <input type="checkbox" id="toggle-unread-messages" checked>
          <span class="notification-slider"></span>
        </label>
      </div>
      <p class="notification-description">
        Okunmamış mesajları uygulama üzerinden bildirir.
      </p>
    </div>

    <!-- 2. Kart: Masaüstü bildirimi -->
    <div class="notification-card">
      <div class="notification-header">
        <div class="notification-heading-left">
          <img src="icons/desktop_notification.png" alt="Masaüstü" class="notification-icon" draggable="false">
          <span class="notification-name">Masaüstü Bildirimi</span>
        </div>

        <label class="notification-switch">
          <input type="checkbox" id="toggle-desktop-notifications" checked>
          <span class="notification-slider"></span>
        </label>
      </div>
      <p class="notification-description">
        Okunmamış mesajları masaüstü bildirimiyle iletir.
      </p>
    </div>

    <!-- 3. Kart: E-posta bildirimi -->
    <div class="notification-card">
      <div class="notification-header">
        <div class="notification-heading-left">
          <img src="icons/email_notification.png" alt="E-posta" class="notification-icon" draggable="false">
          <span class="notification-name">E-posta Bildirimi</span>
        </div>

        <label class="notification-switch">
          <input type="checkbox" id="toggle-email-notifications" checked>
          <span class="notification-slider"></span>
        </label>
      </div>
      <p class="notification-description">
        Uzun süre okunmamış mesajları e-posta üzerinden bildirir.
      </p>
    </div>

<!-- 4. Kart: Dosya İndirme Bildirimi -->
<div class="notification-card">
  <div class="notification-header">
    <div class="notification-heading-left">
      <img src="icons/download.png" alt="Dosya İndirme" class="notification-icon" draggable="false">
      <span class="notification-name">İndirme Bildirimi</span>
    </div>
    <label class="notification-switch">
      <input type="checkbox" id="toggle-download-notifications" checked>
      <span class="notification-slider"></span>
    </label>
  </div>
  <p class="notification-description">
    İndirilen dosyalar hakkında uygulama üzerinden bildirim gönderir.
  </p>
</div>
  </div> <!-- /notifications-container -->
</div>

<!-- KİŞİSELLEŞTİRME Sekmesi (Yeni, card mantığında) -->
<div class="tab-content" id="kisisellestirme">
  <div class="general-card">
    <!-- Kartın Üst Barı (Top Bar) -->
    <div class="card-topbar">
      <div class="general-heading-left">
        <span class="general-name">Merhaba, ben kişisel asistanın Quik!</span>
      </div>
    </div>

    <!-- Açıklayıcı Metin -->
    <p class="general-description">
      Sana daha iyi bir hizmet sunabilmem için bana ne istediğini söyleyebilirsin.
    </p>


    <!-- Prompt Seçenekleri (Theme-btn stilinde) -->
    <div class="prompt-selection" style="display: flex; gap: 1rem; flex-wrap: wrap; margin-bottom: 1rem;">
      <button type="button" class="theme-btn" onclick="setPrompt('special')" style="flex: 1; min-width: 150px;">
        <div style="text-align: center;">
          <strong>Özel</strong><br>
          <small>Sizin Kararınız</small>
        </div>
      </button>
      <button type="button" class="theme-btn" onclick="setPrompt('professional')" style="flex: 1; min-width: 150px;">
        <div style="text-align: center;">
          <strong>Profesyonel</strong><br>
          <small>Saygı ve Ciddiyet</small>
        </div>
      </button>
      <button type="button" class="theme-btn" onclick="setPrompt('energetic')" style="flex: 1; min-width: 150px;">
        <div style="text-align: center;">
          <strong>Enerjik</strong><br>
          <small>Canlılık ve Motivasyon</small>
        </div>
      </button>
      <button type="button" class="theme-btn" onclick="setPrompt('friendly')" style="flex: 1; min-width: 150px;">
        <div style="text-align: center;">
          <strong>Samimi</strong><br>
          <small>Empati ve Samimiyet</small>
        </div>
      </button>
    </div>

    <!-- Statik Prompt Girişi -->
    <div class="personalization-input">
      <textarea 
        id="static-prompt" 
        placeholder="Örnek: 'Her zaman kısa ve öz cevap ver' veya 'Bana esprili bir şekilde yanıt ver'" 
        rows="8" 
        style="width: 100%;"
      ></textarea>
    </div>

    <!-- Ayarları Kaydet Butonu -->
    <div class="save-button-container">
      <button id="save-personalization" class="theme-btn">Kişiselleştirmeyi Kaydet</button>
    </div>
  </div>
</div>

<!-- KONUŞMA Sekmesi -->
<div class="tab-content" id="konusma">
  <div class="settings-list">
    <div class="general-card">
      <div class="card-topbar">
        <div class="general-heading-left">
          <span class="general-name">Sesli Konuşma Seçimi</span>
        </div>
      </div>
      <p class="general-description">
        Seçtiğiniz kişi, konuşma tarzını ve üslubunu etkileyebilir.
      </p>
      <div class="language-selection">
        <select id="conversation-person">
          <option value="sky">Sky</option>
          <option value="gia">Gia</option>
          <option value="dan">Dan</option>
          <option value="dom">Dom</option>
        </select>

        <!-- İnce Çizgi -->
        <hr style="margin: 15px 0;">

        <!-- Ses Seçenekleri: Buton sol tarafta, açıklama butonun hemen sağında -->
        <div class="voice-options">
          <div class="voice-option">
            <button class="voice-check-btn" id="voice-btn-sky" onclick="toggleVoice('sky')">Sky'ı Dene</button>
            <p class="voice-description"><strong>Sky:</strong> Dengeli ve sakin bir üslupla iletişim kurar.</p>
          </div>
          <div class="voice-option">
            <button class="voice-check-btn" id="voice-btn-gia" onclick="toggleVoice('gia')">Gia'yı Dene</button>
            <p class="voice-description"><strong>Gia:</strong> Heyecanlı ve enerjik bir üslubu vardır.</p>
          </div>
          <div class="voice-option">
            <button class="voice-check-btn" id="voice-btn-dan" onclick="toggleVoice('dan')">Dan'ı Dene</button>
            <p class="voice-description"><strong>Dan:</strong> Canlı ve dinamik bir üsluba sahiptir.</p>
          </div>
          <div class="voice-option">
            <button class="voice-check-btn" id="voice-btn-dom" onclick="toggleVoice('dom')">Dom'u Dene</button>
            <p class="voice-description"><strong>Dom:</strong> Doğrudan ve kararlı bir tarzda konuşur.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- GEÇMİŞ Sekmesi -->
<div class="tab-content" id="gecmis">
  <div class="settings-list">
    <div class="general-card">
      <div class="card-topbar">
        <div class="general-heading-left">
          <span class="general-name">Mevcut Geçmiş Sohbet Sayısı: <span id="chat-count">0</span>/200</span>
        </div>
      </div>
      <div class="description-list">
        <span class="general-count">
          <div class="progress-container">
            <div id="progress-bar" class="progress-bar">
              <div id="progress-bar-fill" class="progress-bar-fill"></div>
            </div>
            <button id="delete-all-chats" class="danger-btn">Bütün Sohbetleri Sil</button>
          </div>
        </span>
      </div>
      <p class="general-description">En fazla 200 geçmiş sohbet saklanabilir. Eğer bu sınır aşılırsa en eski sohbetler otomatik olarak silinir.</p>
    </div>

    <!-- Sohbet Özetleyici Kartı -->
    <div class="general-card">
      <div class="card-topbar">
        <div class="general-heading-left">
          <span class="general-name">Sohbet Özetleyici</span>
        </div>
      </div>
      <div class="description-list">
        <span class="general-count summary-actions-container">
          <select id="chat-summary-dropdown" class="setting-row select">
            <option value="" disabled selected>Sohbet Seçin</option>
          </select>
          <!-- Düzenleme ve Silme Butonları -->
          <div class="history-actions summary-actions">
            <button class="edit-btn" id="edit-summary-btn" disabled>
              <img src="icons/edit_btn.png" alt="Düzenle" draggable="false">
            </button>
            <button class="delete-btn" id="delete-summary-btn" disabled>
              <img src="icons/delete_btn.png" alt="Sil" draggable="false">
            </button>
          </div>
        </span>
      </div>
      <p class="general-description">Seçilen sohbet başlığının özeti aşağıda gösterilir.</p>
      <p class="general-description summary-text" style="display: none;"></p> <!-- Özetin gösterileceği alan -->
    </div>
  </div>
</div>


<!-- BAĞLI PROGRAMLAR Sekmesi -->
<div class="tab-content" id="bagliprogramlar">
  <div class="settings-list">
    <div class="notifications-container">
      
      <!-- SQL Kartı -->
      <div class="notification-card">
        <div class="notification-header">
          <div class="notification-heading-left">
            <img src="icons/sql_icon.png" alt="SQL" class="notification-icon" draggable="false">
            <span class="notification-name">SQL</span>
          </div>
          <label class="notification-switch">
            <input type="checkbox" id="toggle-sql" onchange="toggleCodeBlock('sql')">
            <span class="notification-slider"></span>
          </label>
        </div>
        <p class="notification-description">
          MsSQL sorgularınızı Quik yardımıyla hazırlayın.
        </p>
        <div id="sql-code" class="code-block-container" style="display: none;">
          <pre><code class="language-sql">SELECT MemberTable* 
FROM MemberTable 
WHERE FullName = 'Quik' 
LIMIT 1;</code></pre>
        </div>
      </div>
      
      <!-- Python Kartı -->
      <div class="notification-card">
        <div class="notification-header">
          <div class="notification-heading-left">
            <img src="icons/python_icon.png" alt="Python" class="notification-icon" draggable="false">
            <span class="notification-name">Python</span>
          </div>
          <label class="notification-switch">
            <input type="checkbox" id="toggle-python" onchange="toggleCodeBlock('python')">
            <span class="notification-slider"></span>
          </label>
        </div>
        <p class="notification-description">
          Python kodlarınızı Quik yardımı ile hemen oluşturun ve deneyin.
        </p>
        <div id="python-code" class="code-block-container" style="display: none;">
          <pre><code class="language-python">class QuikAssistant:
    def __init__(self, name):
        self.name = name
    
    def respond(self, message):
        return f"{self.name}: {message}"

quik = QuikAssistant("Quik")
print(quik.respond("Merhaba dostum"))</code></pre>
        </div>
      </div>
      
      <!-- JavaScript Kartı -->
      <div class="notification-card">
        <div class="notification-header">
          <div class="notification-heading-left">
            <img src="icons/javascript_icon.png" alt="JavaScript" class="notification-icon" draggable="false">
            <span class="notification-name">JavaScript</span>
          </div>
          <label class="notification-switch">
            <input type="checkbox" id="toggle-javascript" onchange="toggleCodeBlock('javascript')">
            <span class="notification-slider"></span>
          </label>
        </div>
        <p class="notification-description">
          HTML mi, Quik ile hemen JavaScript'e başlayın.
        </p>
        <div id="javascript-code" class="code-block-container" style="display: none;">
          <pre><code class="language-javascript">const quikChat = {
  init: function() {
    console.log("Quik hazır!");
  },
  sendMessage: function(msg) {
    return `Quik: ${msg} aldım, buradayım!`;
  }
};

quikChat.init();
console.log(quikChat.sendMessage("Nasılsın?"));</code></pre>
        </div>
      </div>

      <!-- CSS Kartı -->
      <div class="notification-card">
        <div class="notification-header">
          <div class="notification-heading-left">
            <img src="icons/css_icon.png" alt="CSS" class="notification-icon" draggable="false">
            <span class="notification-name">CSS</span>
          </div>
          <label class="notification-switch">
            <input type="checkbox" id="toggle-css" onchange="toggleCodeBlock('css')">
            <span class="notification-slider"></span>
          </label>
        </div>
        <p class="notification-description">
          HTML mi, Quik ile hemen CSS'e başlayın.
        </p>
        <div id="css-code" class="code-block-container" style="display: none;">
          <pre><code class="language-css">.havali-quik {
  padding: 10px;
  font-size: 10px;
  font-weight: 1000;
}
</code></pre>
        </div>
      </div>
      
    </div>
  </div>
</div>



<!-- BAĞLI UYGULAMALAR Sekmesi -->
<div class="tab-content" id="bagliuygulamalar">
  <div class="notifications-container">

<!-- Gmail Kartı (BAĞLI UYGULAMALAR Sekmesi içinde) -->
<div class="notification-card">
  <div class="notification-header" style="justify-content: space-between; align-items: center;">
    <div class="notification-heading-left">
      <img src="icons/gmail_icon.png" alt="Gmail" class="notification-icon" draggable="false">
      <span class="notification-name">Gmail</span>
    </div>
    <div id="gmail-connect-container">
      <button class="connect-btn" onclick="connectGmail()">Bağlan</button>
    </div>
  </div>
  <p class="notification-description">
    Gmail entegrasyonu ile e-postalarınıza erişim sağlanır.
  </p>
</div>

    <!-- Google Drive Kartı -->
<div class="notification-card">
  <div class="notification-header" style="justify-content: space-between; align-items: center;">
    <div class="notification-heading-left">
      <img src="icons/gdrive_icon.png" alt="Google Drive" class="notification-icon" draggable="false">
      <span class="notification-name">Google Drive</span>
    </div>
    <button class="connect-btn" onclick="connectGoogleDrive()">Bağlan</button>
  </div>
  <p class="notification-description">
    Google Drive entegrasyonu ile dosyalarınıza erişim sağlanır.
  </p>
</div>

    <!-- Google Talk Kartı -->
    <div class="notification-card">
      <div class="notification-header" style="justify-content: space-between; align-items: center;">
        <div class="notification-heading-left">
          <img src="icons/gtalk_icon.png" alt="Google Talk" class="notification-icon" draggable="false">
          <span class="notification-name">Google Talk</span>
        </div>
        <button class="connect-btn" onclick="connectGtalk()">Bağlan</button>
      </div>
      <p class="notification-description">
        Google Talk entegrasyonu ile mesajlarınıza cevap üretilir.
      </p>
</div>

    <!-- Microsoft OneDrive Kartı -->
    <div class="notification-card">
      <div class="notification-header">
        <div class="notification-heading-left">
          <img src="icons/onedrive_icon.png" alt="OneDrive" class="notification-icon" draggable="false">
          <span class="notification-name">Microsoft OneDrive</span>
        </div>
      </div>
      <p class="notification-description">
        OneDrive entegrasyonu ile dosyalarınıza erişim sağlanır.
      </p>


    </div>
  </div>
</div>


<!-- BAĞLI SİSTEMLER Sekmesi -->
<div class="tab-content" id="baglisistemler">
  <div class="notifications-container">
    <!-- 1. Kart: BIODATA -->
    <div class="notification-card">
      <div class="notification-header">
        <div class="notification-heading-left">
          <img src="icons/biodata_icon.png" alt="BIODATA" class="notification-icon" draggable="false">
          <span class="notification-name">BIODATA</span>
        </div>
        <label class="notification-switch">
          <input type="checkbox" id="toggle-biodata" onchange="toggleCredentials('biodata')">
          <span class="notification-slider"></span>
        </label>
      </div>
      <p class="notification-description">
        BIODATA uygulamasına bağlanır. Lütfen VPN ayarlarınızı kontrol ediniz.
      </p>
      <!-- Kullanıcı Adı ve Şifre Alanı (Başlangıçta Gizli) -->
      <div id="biodata-credentials" class="credentials-container" style="display: none;">
        <div class="credential-input">
          <label for="biodata-username">Kullanıcı Adı</label>
          <input type="text" id="biodata-username" placeholder="Kullanıcı adınızı girin">
        </div>
        <div class="credential-input">
          <label for="biodata-password">Şifre</label>
          <input type="password" id="biodata-password" placeholder="Şifrenizi girin">
        </div>
        <button id="save-biodata" class="credential-save-btn" onclick="saveCredentials('biodata')">Kaydet</button>
      </div>
    </div>

    <!-- 2. Kart: DGBYS -->
    <div class="notification-card">
      <div class="notification-header">
        <div class="notification-heading-left">
          <img src="icons/dgbys_icon.png" alt="DGBYS" class="notification-icon" draggable="false">
          <span class="notification-name">DGBYS</span>
        </div>
        <label class="notification-switch">
          <input type="checkbox" id="toggle-dgbys" onchange="toggleCredentials('dgbys')">
          <span class="notification-slider"></span>
        </label>
      </div>
      <p class="notification-description">
        DGBYS uygulamasına bağlanır. Lütfen VPN ayarlarınızı kontrol ediniz.
      </p>
      <!-- Kullanıcı Adı ve Şifre Alanı (Başlangıçta Gizli) -->
      <div id="dgbys-credentials" class="credentials-container" style="display: none;">
        <div class="credential-input">
          <label for="dgbys-username">Kullanıcı Adı</label>
          <input type="text" id="dgbys-username" placeholder="Kullanıcı adınızı girin">
        </div>
        <div class="credential-input">
          <label for="dgbys-password">Şifre</label>
          <input type="password" id="dgbys-password" placeholder="Şifrenizi girin">
        </div>
        <button id="save-dgbys" class="credential-save-btn" onclick="saveCredentials('dgbys')">Kaydet</button>
        </div>
      </div>

    <!-- 3. Kart: EMTIA -->
    <div class="notification-card">
      <div class="notification-header">
        <div class="notification-heading-left">
          <img src="icons/emtia_icon.png" alt="EMTIA" class="notification-icon" draggable="false">
          <span class="notification-name">EMTIA</span>
        </div>
        <label class="notification-switch">
          <input type="checkbox" id="toggle-emtia" onchange="toggleCredentials('emtia')">
          <span class="notification-slider"></span>
        </label>
      </div>
      <p class="notification-description">
        EMTIA uygulamasına bağlanır. Lütfen VPN ayarlarınızı kontrol ediniz.
      </p>
      <!-- Kullanıcı Adı ve Şifre Alanı (Başlangıçta Gizli) -->
      <div id="emtia-credentials" class="credentials-container" style="display: none;">
        <div class="credential-input">
          <label for="emtia-username">Kullanıcı Adı</label>
          <input type="text" id="emtia-username" placeholder="Kullanıcı adınızı girin">
        </div>
        <div class="credential-input">
          <label for="emtia-password">Şifre</label>
          <input type="password" id="emtia-password" placeholder="Şifrenizi girin">
        </div>
        <button id="save-emtia" class="credential-save-btn" onclick="saveCredentials('emtia')">Kaydet</button>
        </div>
      </div>

    <!-- 4. Kart: MEYER -->
    <div class="notification-card">
      <div class="notification-header">
        <div class="notification-heading-left">
          <img src="icons/meyer_icon.png" alt="MEYER" class="notification-icon" draggable="false">
          <span class="notification-name">MEYER</span>
        </div>
        <label class="notification-switch">
          <input type="checkbox" id="toggle-meyer" onchange="toggleCredentials('meyer')">
          <span class="notification-slider"></span>
        </label>
      </div>
      <p class="notification-description">
        MEYER uygulamasına bağlanır. Lütfen VPN ayarlarınızı kontrol ediniz.
      </p>
      <!-- Kullanıcı Adı ve Şifre Alanı (Başlangıçta Gizli) -->
      <div id="meyer-credentials" class="credentials-container" style="display: none;">
        <div class="credential-input">
          <label for="meyer-username">Kullanıcı Adı</label>
          <input type="text" id="meyer-username" placeholder="Kullanıcı adınızı girin">
        </div>
        <div class="credential-input">
          <label for="meyer-password">Şifre</label>
          <input type="password" id="meyer-password" placeholder="Şifrenizi girin">
        </div>
        <button id="save-meyer" class="credential-save-btn" onclick="saveCredentials('meyer')">Kaydet</button>
        </div>
      </div>


    </div>
  </div>
</div>


      </div><!-- /settings-content -->
    </div><!-- /settings-body -->
  </div><!-- /settings-modal-content -->
</div><!-- /settings-modal -->


  <!-- Marked ve Highlight.js Kütüphaneleri -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>

  <script>
    
/* ======================
     GLOBAL DEĞİŞKENLER & STATE
====================== */
let conversations = [];
let currentConversation = null;
let currentAssistantBubble = null;
let currentFetchAbortController = null;
let isStreaming = false;
let enableWebSearch = false;
let selectedModel = localStorage.getItem("selectedModel") || "quik-prime"; // Yeni: Seçilen model
let globalFeedbackTooltipDelayed = false;
let botSettings = {
  staticPrompt: localStorage.getItem("staticPrompt") || "" // Varsayılan boş prompt
};

const chatContainer = document.getElementById("chat-container");
const chatInput = document.getElementById("chat-input-textarea");
const sendBtn = document.getElementById("send-btn");
const newChatBtn = document.getElementById("new-chat-btn");
const chatHistoryList = document.getElementById("chat-history-list");
const sidebar = document.getElementById("sidebar");
const toggleSidebarBtn = document.getElementById("toggle-sidebar-btn");
const welcomeMessage = document.getElementById("welcome-message");
const sidebarBrand = document.getElementById("sidebar-brand");
const mainContent = document.querySelector(".main-content");
const scrollWrapper = document.querySelector(".scroll-wrapper");
const emojiBtn = document.getElementById("emoji-btn");
const emojiPicker = document.getElementById("emoji-picker");

emojiBtn.addEventListener("click", (e) => {
  e.stopPropagation(); // Prevent event bubbling to document
  emojiPicker.style.display = emojiPicker.style.display === "block" ? "none" : "block";
});

document.addEventListener("click", (e) => {
  if (!emojiPicker.contains(e.target) && !emojiBtn.contains(e.target)) {
    emojiPicker.style.display = "none"; // Hide picker if clicked outside
  }
});

document.querySelectorAll(".emoji").forEach(emoji => {
  emoji.addEventListener("click", () => {
    const emojiChar = emoji.getAttribute("data-emoji");
    const cursorPos = chatInput.selectionStart;
    const textBefore = chatInput.value.substring(0, cursorPos);
    const textAfter = chatInput.value.substring(cursorPos);
    chatInput.value = textBefore + emojiChar + textAfter;
    chatInput.focus();
    chatInput.selectionStart = chatInput.selectionEnd = cursorPos + emojiChar.length;
    chatInput.dispatchEvent(new Event("input")); // Trigger textarea height adjustment
  });
});

function updateNewChatBtnPosition() {
  if (document.body.classList.contains("sidebar-open")) {
    // Sidebar açık: Yeni sohbet butonu sidebar içerisindeyse
    if (newChatBtn.parentNode !== sidebar) {
      sidebar.appendChild(newChatBtn);
    }
    // Sabit konumlama kaldırılıyor, normal yerleşim kullanılıyor.
    newChatBtn.style.position = "";
    newChatBtn.style.top = "";
    newChatBtn.style.left = "";
  } else {
    // Sidebar kapalı: Butonu body’ye taşı ve toggle butonunun sağında fixed olarak göster.
    if (newChatBtn.parentNode !== document.body) {
      document.body.appendChild(newChatBtn);
    }
    newChatBtn.style.position = "fixed";
    const rect = toggleSidebarBtn.getBoundingClientRect();
    newChatBtn.style.top = rect.top + "px";
    newChatBtn.style.left = (rect.right + 0) + "px";
  }
}

// Sidebar açma/kapama butonuna tıklanınca konumu güncelle
toggleSidebarBtn.addEventListener("click", () => {
  // Sidebar'ın açılıp kapanma animasyonunun bitmesi için ufak bir gecikme ekliyoruz.
  setTimeout(updateNewChatBtnPosition, 0);
});

// Pencere yeniden boyutlandığında da güncelle
window.addEventListener("resize", updateNewChatBtnPosition);

// Sayfa yüklendiğinde de çalıştır
document.addEventListener("DOMContentLoaded", updateNewChatBtnPosition);

/* ======================
     LOCAL STORAGE İŞLEMLERİ
====================== */
function saveConversations() {
  localStorage.setItem("conversations", JSON.stringify(conversations));
}

function loadConversations() {
  const saved = localStorage.getItem("conversations");
  if (saved) {
    conversations = JSON.parse(saved);
    // Mevcut sohbetlere timestamp ekle (eğer yoksa)
    conversations = conversations.map(conv => ({
      ...conv,
      timestamp: conv.timestamp || Date.now() // Varsayılan olarak şu anki zaman
    }));
    if (conversations.length > 0) {
      currentConversation = null;
    }
  }
}

function updateChatCount() {
  const chatCountSpan = document.getElementById("chat-count");
  const progressBar = document.getElementById("progress-bar");
  if (chatCountSpan && progressBar) {
    const currentCount = conversations.length;
    chatCountSpan.textContent = currentCount;
    const percentage = Math.round((currentCount / 200) * 100);

    // Progress bar doldurma
    let fillElement = progressBar.querySelector(".progress-bar-fill");
    if (!fillElement) {
      fillElement = document.createElement("div");
      fillElement.className = "progress-bar-fill";
      progressBar.appendChild(fillElement);
    }

    // Yüzdeye göre renk ve genişlik ayarla
    fillElement.style.width = `${percentage}%`;
    fillElement.textContent = `${percentage}% dolu`;

    if (percentage <= 33) {
      fillElement.style.backgroundColor = "#4CAF50"; // Yeşil (az yüklü)
    } else if (percentage <= 66) {
      fillElement.style.backgroundColor = "#FFC107"; // Sarı (orta yüklü)
    } else {
      fillElement.style.backgroundColor = "#F44336"; // Kırmızı (çok yüklü)
    }
  }
}

// İlk yüklemede ve her değişiklikte güncelle
loadConversations();
updateChatCount();

/* ======================
     YARDIMCI FONKSİYONLAR
====================== */

// Tüm tooltip’li elementlere fonksiyonu uygula
document.addEventListener("DOMContentLoaded", () => {

  // Sidebar toggle butonuna tooltip ekleme
  const toggleSidebarBtn = document.getElementById("toggle-sidebar-btn");
  if (toggleSidebarBtn && toggleSidebarBtn.dataset.tooltip) {
    console.log("Sidebar butonu bulundu:", toggleSidebarBtn.dataset.tooltip);
  } else {
    console.log("Sidebar butonu bulunamadı veya tooltip yok.");
  }

  // Diğer tooltip’li butonlara tooltip ekleme
  const otherButtons = document.querySelectorAll('[data-tooltip]');
  console.log("Toplam tooltip’li buton sayısı:", otherButtons.length);
  otherButtons.forEach(button => {
    console.log("Diğer buton işleme alındı:", button.dataset.tooltip);
// Tüm tooltip’li butonları seç
  const tooltipButtons = document.querySelectorAll("[data-tooltip]");

  tooltipButtons.forEach(button => {
    button.addEventListener("click", () => {
      // Tıklama anında tooltip’i gizle
      button.classList.add("no-tooltip");

      // Fare ayrıldığında veya 1 saniye sonra tooltip’i tekrar aktif et
      const resetTooltip = () => {
        button.classList.remove("no-tooltip");
      };

      // Fare ayrıldığında reset
      button.addEventListener("mouseleave", resetTooltip, { once: true });

      // Alternatif olarak, 1 saniye sonra reset (isteğe bağlı)
      setTimeout(() => {
        button.classList.remove("no-tooltip");
      }, 1000);
    });
  });


  });
});

function renderChatHistory() {
  chatHistoryList.innerHTML = ""; // Clear once

  const groupedConversations = conversations.reduce((acc, conv) => {
    const dateKey = formatRelativeDate(conv.timestamp);
    if (!acc[dateKey]) acc[dateKey] = [];
    acc[dateKey].push(conv);
    return acc;
  }, {});

  const sortedDates = Object.keys(groupedConversations).sort((a, b) => {
    const dateA = groupedConversations[a][0].timestamp;
    const dateB = groupedConversations[b][0].timestamp;
    return dateB - dateA;
  });

  sortedDates.forEach(date => {
    const headerLi = document.createElement("li");
    headerLi.className = "chat-history-group";
    headerLi.innerHTML = `<div class="chat-history-header">${date}</div>`;
    chatHistoryList.appendChild(headerLi);

    const sortedConversations = groupedConversations[date].sort((a, b) => b.timestamp - a.timestamp);
    sortedConversations.forEach(conv => {
      const li = document.createElement("li");
      li.className = `chat-history-item${currentConversation?.id === conv.id ? " active" : ""}`;
      li.dataset.id = conv.id;
      li.innerHTML = `
        <span class="chat-history-title">${conv.title || "Yeni Sohbet"}</span>
        <div class="history-actions">
          <button class="edit-btn"><img src="icons/edit_btn.png" alt="Düzenle" draggable="false" /></button>
          <button class="delete-btn"><img src="icons/delete_btn.png" alt="Sil" draggable="false" /></button>
        </div>
      `;
li.addEventListener("click", () => {
  // Tıklanan sohbet geçmişi öğesine basıldığında arama container'ı kapatılsın
  closeChatSearch();
  currentConversation = conv;
  renderChat();
  document.querySelectorAll(".chat-history-item").forEach(item => item.classList.remove("active"));
  li.classList.add("active");
  
  // Mobilde sidebar'ı kapat
  if (window.innerWidth <= 768) {
    closeSidebar();
  }
  document.title = currentConversation.title || "Quik"; // Seçilen sohbetin başlığı HTML başlığına aktarılır
});


li.querySelector(".edit-btn").addEventListener("click", (e) => {
  e.stopPropagation();
  const titleSpan = li.querySelector(".chat-history-title");
  const currentTitle = conv.title || "Yeni Sohbet";
  
  // Giriş (input) alanını oluşturuyoruz ve chat history başlığıyla aynı sınıfı ekliyoruz
  const input = document.createElement("input");
  input.type = "text";
  input.value = currentTitle;
  // Chat history başlığı için tanımlanan CSS sınıfını da ekleyerek stil uyumunu sağlıyoruz
  input.className = "chat-history-title edit-input";
  input.style.width = "80%";
  
  // Mevcut başlık (span) elemanının stil özelliklerini alıp input alanına uyguluyoruz
  const computedStyle = window.getComputedStyle(titleSpan);
  input.style.fontFamily = computedStyle.fontFamily;
  input.style.fontSize = computedStyle.fontSize;
  input.style.fontWeight = computedStyle.fontWeight;
  input.style.color = computedStyle.color;
  
  // Mevcut span'ı input ile değiştiriyoruz
  titleSpan.replaceWith(input);
  input.focus();

  // Düzenleme tamamlandığında (blur veya Enter basıldığında) başlığı güncelleyen fonksiyon
  function finishEditing() {
    conv.title = input.value.trim() || currentTitle;
    renderChatHistory();
    saveConversations();
  }
  
  input.addEventListener("blur", finishEditing);
  input.addEventListener("keydown", (event) => {
    if (event.key === "Enter") {
      input.blur(); // Enter ile düzenleme tamamlanır
    } else if (event.key === "Escape") {
      // ESC tuşuna basıldığında düzenleme iptal edilir, eski başlık geri getirilir
      conv.title = currentTitle;
      renderChatHistory();
      saveConversations();
    }
  });
});

li.querySelector(".delete-btn").addEventListener("click", (e) => {
  e.stopPropagation();
  if (confirm("Bu sohbeti silmek istediğinize emin misiniz?")) {
    conversations = conversations.filter(c => c.id !== conv.id);
    if (currentConversation?.id === conv.id) {
      currentConversation = null;
      chatContainer.innerHTML = "";
      chatContainer.appendChild(welcomeMessage);
      welcomeMessage.style.display = "block";
      document.title = "Quik"; // Silme sonrası ana sayfaya geçildiğinde HTML başlığı güncellenir
    }
    renderChatHistory();
    saveConversations();
    updateChatCount(); // Sohbet silindiğinde sayıyı güncelle
  }
});
      chatHistoryList.appendChild(li);
    });
  });
}

function formatRelativeDate(timestamp) {
  const now = new Date();
  const date = new Date(timestamp);

  // Normalize to start of the day (00:00:00)
  const startOfToday = new Date(now.setHours(0, 0, 0, 0));
  const startOfInputDate = new Date(date.setHours(0, 0, 0, 0));

  // Calculate difference in days
  const diffTime = startOfToday - startOfInputDate;
  const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));

  if (diffDays === 0) return "Bugün"; // Same calendar day
  if (diffDays === 1) return "Dün";   // Previous calendar day
  if (diffDays >= 2 && diffDays <= 6) return `${diffDays} Gün Önce`; // 2 to 6 days ago
  return date.toLocaleDateString("tr-TR", { day: "numeric", month: "short" }); // Older dates
}

function isUserAtBottom(threshold = 50) {
  return chatContainer.scrollTop + chatContainer.clientHeight >= chatContainer.scrollHeight - threshold;
}

function scrollChatToBottom() {
  setTimeout(() => {
    scrollWrapper.scrollTop = scrollWrapper.scrollHeight;
  }, 100);
}

// Mevcut mesajları yüklerken feedback butonlarını eklemek için renderChat güncellemesi
function renderChat() {
  chatContainer.innerHTML = "";
  if (currentConversation && currentConversation.messages.length > 0) {
    currentConversation.messages.forEach(msg => {
      const bubble = appendMessageBubble(msg.sender, msg.text, msg.id);
      if (msg.sender === "assistant" && msg.complete) {
        addFeedbackControls(bubble, msg.text);
      }
    });
  } else {
    chatContainer.appendChild(welcomeMessage);
  }
  styleCodeBlocks();
  scrollChatToBottom();
}


// appendMessageBubble fonksiyonunu geri dönüş değeriyle güncelle
function appendMessageBubble(sender, text, messageId) {
  const bubble = document.createElement("div");
  bubble.className = "chat-bubble " + (sender === "user" ? "user-bubble" : "assistant-bubble");

  // Burada ID’yi dataset’e atıyoruz
  bubble.dataset.msgId = messageId;

  if (sender === "assistant") {
    bubble.innerHTML = marked.parse(text);
    bubble.querySelectorAll('pre code').forEach(block => hljs.highlightElement(block));
    styleCodeBlocks();
  } else {
    bubble.innerHTML = marked.parse(text);
  }

  chatContainer.appendChild(bubble);
  scrollChatToBottom();
  return bubble;
}

// Düz metni tabloya çeviren yardımcı fonksiyon
function convertTextToTable(text) {
  const lines = text.trim().split("\n");
  const rows = lines.map(line => line.split("|").map(cell => cell.trim()).filter(cell => cell));

  if (rows.length < 2 || rows[0].length < 2) return marked.parse(text); // Tablo değilse normal işleme

  let html = '<table>\n<thead>\n<tr>';
  rows[0].forEach(header => {
    html += `<th>${header}</th>`;
  });
  html += '</tr>\n</thead>\n<tbody>';

  for (let i = 1; i < rows.length; i++) {
    if (rows[i].length > 0 && !rows[i][0].startsWith("---")) { // Ayırıcı satırı atla
      html += '<tr>';
      rows[i].forEach(cell => {
        html += `<td>${cell}</td>`;
      });
      html += '</tr>';
    }
  }
  html += '</tbody>\n</table>';
  return html;
}

function createAssistantBubble(assistantMessageId) {
  currentAssistantBubble = document.createElement("div");
  currentAssistantBubble.className = "chat-bubble assistant-bubble";

  // ID’yi dataset’e atıyoruz
  if (assistantMessageId) {
    currentAssistantBubble.dataset.msgId = assistantMessageId;
  }

  // İçerik (typing indicator vs.)
  const contentDiv = document.createElement("div");
  contentDiv.className = "assistant-content";
  contentDiv.innerHTML = `
    <div class="typing-indicator">
      <span></span>
      <span></span>
      <span></span>
    </div>
  `;
  currentAssistantBubble.appendChild(contentDiv);
  chatContainer.appendChild(currentAssistantBubble);
  scrollChatToBottom();
  return currentAssistantBubble;
}


function removeTrailingWhitespaceNodes(container) {
  while (
    container.lastChild &&
    container.lastChild.nodeType === Node.TEXT_NODE &&
    container.lastChild.textContent.trim() === ""
  ) {
    container.removeChild(container.lastChild);
  }
}

function updateAssistantBubble(text) {
  const contentDiv = currentAssistantBubble.querySelector('.assistant-content');
  if (contentDiv) {

    // Ardından render işlemini yapın
    contentDiv.innerHTML = marked.parse(text);
    contentDiv.querySelectorAll('pre code').forEach(block => hljs.highlightElement(block));
    styleCodeBlocks();
  }
  if (isUserAtBottom()) scrollChatToBottom();
}

async function startNewConversation() {
  if (conversations.length >= 200) {
    conversations.shift(); // En eski sohbeti sil
  }
  currentConversation = { 
    id: Date.now(), 
    title: "Yeni Sohbet",
    messages: [], 
    timestamp: Date.now()
  };
  conversations.push(currentConversation);
  renderChatHistory();
  populateChatSummaryDropdown(); // Yeni sohbet özetleyiciye ekleniyor
  saveConversations();
  chatContainer.innerHTML = "";
  welcomeMessage.style.display = "none";
  updateChatCount(); // Sayıyı güncelle
}

function openSidebar() {
  sidebar.classList.add("open");
  mainContent.classList.add("sidebar-open");
  document.body.classList.add("sidebar-open");
  newChatBtn.classList.remove("sidebar-closed");
  toggleSidebarBtn.dataset.tooltip = "Kenar çubuğunu kapat"; // title yerine dataset
  const img = toggleSidebarBtn.querySelector("img");
  if (img) {
    img.src = "icons/sidebar_open_btn.png";
    img.alt = "Sidebar Open Icon";
  }
}

function closeSidebar() {
  sidebar.classList.remove("open");
  mainContent.classList.remove("sidebar-open");
  document.body.classList.remove("sidebar-open");
  newChatBtn.classList.add("sidebar-closed");
  toggleSidebarBtn.dataset.tooltip = "Kenar çubuğunu aç";
  const img = toggleSidebarBtn.querySelector("img");
  if (img) {
    img.src = "icons/sidebar_close_btn.png";
    img.alt = "Sidebar Close Icon";
  }
  // Mobilde, sidebar kapandıktan sonra butonu yeniden konumlandır
  if (window.innerWidth <= 768) {
    updateNewChatBtnPosition();
  }
}

function setSendButtonToStopState() {
  let img = sendBtn.querySelector('img');
  if (!img) {
    img = document.createElement("img");
    img.src = "icons/stop_btn.png";
    img.alt = "Stop Icon";
    img.style.width = "50px";
    img.style.height = "50px";
    sendBtn.appendChild(img);
  } else {
    img.src = "icons/stop_btn.png";
    img.alt = "Stop Icon";
  }
  sendBtn.classList.add("stop-state");
  if (document.body.classList.contains("dark")) img.classList.add("dark-icon");
  else img.classList.remove("dark-icon");
  sendBtn.style.borderRadius = "12px";
}

function setSendButtonToSendState() {
  sendBtn.innerHTML = `<img src="icons/send_btn.png" alt="Send Icon" style="width:17px; height:17px;">`;
  sendBtn.style.backgroundColor = "";
  sendBtn.style.borderRadius = "";
}


function addFeedbackControls(bubble, answerText) {
  if (!bubble) {
    console.error("Feedback eklenemedi: Bubble tanımlı değil.");
    return;
  }

  // Mesajı tekrar render et
  const contentDiv = bubble.querySelector('.assistant-content');
  if (contentDiv) {
    contentDiv.innerHTML = marked.parse(answerText);
    contentDiv.querySelectorAll('pre code').forEach(block => hljs.highlightElement(block));
    styleCodeBlocks();
  }

  // Feedback butonlarını ekle
  const feedbackDiv = document.createElement("div");
  feedbackDiv.className = "feedback-controls";
// Beğen Butonu
const likeBtn = document.createElement("button");
const likeIcon = document.createElement("img");
likeIcon.src = "icons/like_btn.png";
likeIcon.alt = "Beğen";
likeIcon.style.width = "16px";
likeIcon.style.height = "16px";
likeBtn.appendChild(likeIcon);
likeBtn.dataset.tooltip = "Beğendim"; // title yerine dataset
likeBtn.addEventListener("click", () => {
  if (likeIcon.src.includes("liked_btn.png")) return; // Zaten beğenilmişse çık
  likeIcon.src = "icons/liked_btn.png"; // İkonu değiştir
  dislikeIcon.src = "icons/dislike_btn.png"; // Dislike'ı sıfırla
  console.log("Cevap beğenildi:", answerText);
});

// Beğenme Butonu
const dislikeBtn = document.createElement("button");
const dislikeIcon = document.createElement("img");
dislikeIcon.src = "icons/dislike_btn.png";
dislikeIcon.alt = "Beğenme";
dislikeIcon.style.width = "16px";
dislikeIcon.style.height = "16px";
dislikeBtn.appendChild(dislikeIcon);
dislikeBtn.dataset.tooltip = "Beğenmedim"; // title yerine dataset
dislikeBtn.addEventListener("click", () => {
  if (dislikeIcon.src.includes("disliked_btn.png")) return; // Zaten beğenilmemişse çık
  dislikeIcon.src = "icons/disliked_btn.png"; // İkonu değiştir
  likeIcon.src = "icons/like_btn.png"; // Like'ı sıfırla
  console.log("Cevap beğenilmedi:", answerText);
});

// Kopyala Butonu (HTML Formatıyla)
  const copyBtn = document.createElement("button");
  const copyIcon = document.createElement("img");
  copyIcon.src = "icons/copy_btn.png";
  copyIcon.alt = "Kopyala";
  copyIcon.style.width = "16px";
  copyIcon.style.height = "16px";
  copyBtn.appendChild(copyIcon);
  copyBtn.dataset.tooltip = "Kopyala";
  copyBtn.addEventListener("click", async () => {
    try {
      // Markdown’ı HTML’e çevir
      const htmlContent = marked.parse(answerText);
      // Düz metni de hazırla (Markdown işaretleri temizlenmiş)
      const plainText = answerText
        .replace(/\*\*/g, '') // Bold işaretlerini kaldır
        .replace(/\*/g, '')   // Tek yıldızları kaldır
        .replace(/_/g, '')    // Alt çizgileri kaldır
        .replace(/~~/g, '');  // Üstü çizili işaretlerini kaldır
      
      // ClipboardItem ile HTML ve düz metni panoya yaz
      const htmlBlob = new Blob([htmlContent], { type: 'text/html' });
      const plainBlob = new Blob([plainText], { type: 'text/plain' });
      const data = [new ClipboardItem({
        'text/html': htmlBlob,
        'text/plain': plainBlob
      })];

      await navigator.clipboard.write(data);
      copyBtn.classList.add("copied");
      copyIcon.src = "icons/copied_btn.png";
      console.log("Formatlı cevap kopyalandı:", htmlContent);
      console.log("Düz metin hali:", plainText);
    } catch (err) {
      console.error("Kopyalama hatası:", err);
      // Fallback: Düz metni kopyala
      navigator.clipboard.writeText(answerText).then(() => {
        copyBtn.classList.add("copied");
        copyIcon.src = "icons/copied_btn.png";
        console.log("Fallback: Düz metin kopyalandı:", answerText);
      }).catch(fallbackErr => {
        console.error("Fallback kopyalama hatası:", fallbackErr);
      });
    }
    // Buton animasyonu için zamanlayıcı (syntax hatası düzeltildi)
    setTimeout(() => {
      copyBtn.classList.remove("copied");
      copyIcon.src = "icons/copy_btn.png"; // Fazla parantez kaldırıldı
    }, 2000);
  });

// Yeniden Üret Butonu (İkonlu)
  const regenBtn = document.createElement("button");
  const regenIcon = document.createElement("img");
  regenIcon.src = "icons/quik_icon.png";
  regenIcon.alt = "Yeniden Üret";
  regenIcon.style.width = "16px";
  regenIcon.style.height = "16px";
  regenBtn.appendChild(regenIcon);
  regenBtn.dataset.tooltip = "Tekrar Dene"; // title yerine dataset
  regenBtn.addEventListener("click", () => {
    console.log("Cevap yeniden üretiliyor...");
    regenerateAnswer(bubble);
  });

  feedbackDiv.appendChild(likeBtn);
  feedbackDiv.appendChild(dislikeBtn);
  feedbackDiv.appendChild(copyBtn);
  feedbackDiv.appendChild(regenBtn);
  bubble.appendChild(feedbackDiv);
}

function regenerateAnswer(bubble) {
  if (isStreaming) {
    console.log("Streaming devam ediyor, önce durdurulmalı!");
    return;
  }

  const lastUserMessage = currentConversation.messages
    .filter(msg => msg.sender === "user")
    .slice(-1)[0]?.text;
  if (!lastUserMessage) {
    console.error("Yeniden üretilecek kullanıcı mesajı bulunamadı!");
    return;
  }

  // Balonun data-msg-id’si
  const oldAssistantId = bubble.dataset.msgId;
  // currentConversation’da bu ID’yi bulalım
  const assistantIndex = currentConversation.messages.findIndex(
    msg => msg.id === oldAssistantId
  );

  if (assistantIndex === -1) {
    console.error("Eski asistan mesajı bulunamadı, ekleme yapılıyor...");
    // buraya girerse push da yapabilirsiniz ama genelde bulamaması imkânsız
  }

  // Eski balonu DOM’dan kaldır
  bubble.remove();

  // Yeni asistan mesajı oluşturmak için ID üret
  const newAssistantMessageId = (Date.now() + "_regen").toString();
  const newAssistantMessage = {
    id: newAssistantMessageId,
    sender: "assistant",
    text: "",
    complete: true
  };

  // Eski mesajın yerine koy
  currentConversation.messages[assistantIndex] = newAssistantMessage;
  saveConversations();

  // Yeni balonu DOM’a ekle
  createAssistantBubble(newAssistantMessageId);

  currentFetchAbortController = new AbortController();
  isStreaming = true;
  setSendButtonToStopState();

  // Streaming isteği
  fetch("http://localhost:5000/chat", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      message: lastUserMessage,
      history: currentConversation.messages.slice(0, -1),
      enable_web_search: enableWebSearch,
      model: selectedModel,
      static_prompt: botSettings.staticPrompt
    }),
    signal: currentFetchAbortController.signal
  })
    .then(response => response.body.getReader())
    .then(reader => {
      let buffer = "";
      const decoder = new TextDecoder();
      let assistantText = "";

      function read() {
        reader.read().then(({ value, done }) => {
          if (done) {
            addFeedbackControls(currentAssistantBubble, assistantText);
            isStreaming = false;
            setSendButtonToSendState();
            return;
          }
          buffer += decoder.decode(value, { stream: true });
          const events = buffer.split("\n\n");
          for (let i = 0; i < events.length - 1; i++) {
            const event = events[i];
            if (event.startsWith("data: ")) {
              const dataStr = event.substring(6).trim();
              if (dataStr === "[DONE]") continue;
              try {
                const dataObj = JSON.parse(dataStr);
                const content = dataObj.text;
                assistantText += content;
                updateAssistantBubble(assistantText);
                newAssistantMessage.text = assistantText;
                saveConversations();
              } catch (e) {
                console.error("JSON parse hatası:", e, dataStr);
              }
            }
          }
          buffer = events[events.length - 1];
          read();
        });
      }
      read();
    })
    .catch(err => {
      if (err.name !== "AbortError") {
        console.error("Yeniden üretme hatası:", err);
        updateAssistantBubble("Yeniden üretme başarısız: " + err.message);
      }
    });
}

async function sendMessage() {
  const userMessage = chatInput.value.trim();
  if (!userMessage) return;

  let fileContent = "";
  if (uploadedFiles.length > 0) {
    const formData = new FormData();
    uploadedFiles.forEach(file => formData.append("files", file));
    try {
      const response = await fetch("http://localhost:5000/upload", {
        method: "POST",
        body: formData
      });
      if (response.ok) {
        const data = await response.json();
        fileContent = data.content;
      } else {
        console.error("File upload error:", response.statusText);
      }
    } catch (err) {
      console.error("File upload API error:", err);
    }
    uploadedFiles = [];
    fileContainer.innerHTML = "";
  }

  const displayedMessage = userMessage;
  const combinedMessage = fileContent 
    ? `${userMessage}\n\n[DOSYA EKİ]:\n${fileContent}`
    : userMessage;

  if (!currentConversation) {
    await startNewConversation();
  }

  const userMessageId = Date.now().toString() + "_user";
currentConversation.messages.push({
  id: userMessageId,
  sender: "user",
  text: combinedMessage
});

  appendMessageBubble("user", displayedMessage, userMessageId);

  // Check for URL and notify user
  const urlRegex = /https?:\/\/(?:[-\w.]|(?:%[\da-fA-F]{2}))+[^\s]*/;

  chatInput.value = "";
  chatInput.style.height = "auto";
  scrollChatToBottom();

if (currentConversation.messages.length === 1) {
  try {
    const response = await fetch("http://localhost:5000/generate-title", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ message: combinedMessage })
    });
    const data = await response.json();
    currentConversation.title = data.title || "Yeni Sohbet";
    renderChatHistory();
    document.title = currentConversation.title; // HTML başlığı güncellendi
    populateChatSummaryDropdown(); // Sohbet özetleyici güncellendi
  } catch (err) {
    console.error("Title fetch error:", err);
    currentConversation.title = "Yeni Sohbet";
    renderChatHistory();
    document.title = currentConversation.title; // HTML başlığı güncellendi
    populateChatSummaryDropdown(); // Sohbet özetleyici güncellendi
  }
}


  saveConversations();

  const assistantMessageId = (Date.now() + 1).toString() + "_assistant";
  createAssistantBubble(assistantMessageId);
  let assistantText = "";
  let newAssistantMessage = {
    id: assistantMessageId,
    sender: "assistant",
    text: "",
    complete: true
  };
  currentConversation.messages.push(newAssistantMessage);
  saveConversations();

  currentFetchAbortController = new AbortController();
  isStreaming = true;
  setSendButtonToStopState();

  try {
    const response = await fetch("http://localhost:5000/chat", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        message: combinedMessage,
        history: currentConversation.messages,
        enable_web_search: enableWebSearch,
        model: selectedModel,
        static_prompt: botSettings.staticPrompt
      }),
      signal: currentFetchAbortController.signal
    });

    if (!response.ok) {
      console.error("Fetch error:", response.statusText);
      updateAssistantBubble("Error: " + response.statusText);
      return;
    }

    let buffer = "";
    const decoder = new TextDecoder();
    const reader = response.body.getReader();
    let done = false;

    while (!done) {
      const { value, done: doneReading } = await reader.read();
      done = doneReading;
      if (value) {
        buffer += decoder.decode(value, { stream: true });
        const events = buffer.split("\n\n");

        for (let i = 0; i < events.length - 1; i++) {
          const event = events[i];
          if (event.startsWith("data: ")) {
            const dataStr = event.substring(6).trim();
            if (dataStr === "[DONE]") {
              done = true;
              addFeedbackControls(currentAssistantBubble, assistantText);
              break;
            }
            try {
              const dataObj = JSON.parse(dataStr);
              const content = dataObj.text;
              assistantText += content;
              updateAssistantBubble(assistantText);
              newAssistantMessage.text = assistantText;
              saveConversations();
            } catch (e) {
              console.error("JSON parse error:", e, dataStr);
            }
          }
        }
        buffer = events[events.length - 1];
      }
    }

    if (!done) {
      addFeedbackControls(currentAssistantBubble, assistantText);
    }

  } catch (err) {
    if (err.name === "AbortError") {
      newAssistantMessage.complete = false;
      console.log("Streaming aborted.");
    } else {
      updateAssistantBubble("Error: " + err.message);
    }
  } finally {
    isStreaming = false;
    setSendButtonToSendState();
    currentFetchAbortController = null;
  }
}

/* ======================
     KOD BLOKLARI İÇİN FONKSİYONLAR
====================== */
const LANGUAGE_MAP = {
  'js': 'JavaScript', 'jsx': 'JSX', 'javascript': 'JavaScript',
  'py': 'Python', 'python': 'Python', 'ts': 'TypeScript', 'tsx': 'TSX',
  'html': 'HTML', 'css': 'CSS', 'sql': 'SQL', 'md': 'markdown', 'sh': 'Shell'
};

function styleCodeBlocks() {
  document.querySelectorAll('pre code[class^="language-"]').forEach(code => {
    if (!code.dataset.styled) {
      code.dataset.styled = 'true';
      let rawLang = ([...code.classList].find(c => c.startsWith("language-")) || "").replace("language-", "").toLowerCase();
      if (!rawLang || rawLang === "undefined") {
        rawLang = "plaintext";
        code.className = code.className.replace(/\blanguage-undefined\b/g, "").trim();
        if (!code.classList.contains("language-plaintext")) code.classList.add("language-plaintext");
      }
      let languageName = LANGUAGE_MAP[rawLang] || (rawLang.charAt(0).toUpperCase() + rawLang.slice(1));

      const pre = code.parentElement;
      const container = document.createElement("div");
      container.className = "code-block";
      const header = document.createElement("div");
      header.className = "code-header";
      const langSpan = document.createElement("span");
      langSpan.className = "code-language";
      langSpan.textContent = languageName;

      const copyBtn = document.createElement("button");
      copyBtn.className = "copy-btn";
      const copyIcon = document.createElement("img");
      copyIcon.src = "icons/copy_btn.png";
      copyIcon.alt = "Kopyala";
      copyIcon.style.width = "20px";
      copyIcon.style.height = "20px";
      copyBtn.appendChild(copyIcon);

      copyBtn.addEventListener("click", () => {
        const codeText = code.innerText;
        navigator.clipboard.writeText(codeText).then(() => {
          copyBtn.classList.add("copied");
          copyIcon.src = "icons/copied_btn.png";
          setTimeout(() => {
            copyIcon.src = "icons/copy_btn.png";
            copyBtn.classList.remove("copied");
          }, 3000);
        }).catch(err => console.error("Error copying code:", err));
      });

      header.appendChild(langSpan);
      header.appendChild(copyBtn);
      pre.parentElement.insertBefore(container, pre);
      container.appendChild(header);
      container.appendChild(pre);
    }
  });
}

marked.setOptions({
  breaks: true,
  gfm: true,
  langPrefix: 'language-',
  highlight: function(code, lang) {
    const language = lang && hljs.getLanguage(lang) ? lang : 'plaintext';
    return hljs.highlight(code, { language }).value;
  }
});

/* ======================
     BAŞLATMA VE OLAY DİNLEYİCİLERİ
====================== */
document.addEventListener("DOMContentLoaded", () => {
  loadConversations();
  currentConversation = null;
  renderChatHistory();
  closeSidebar();
  populateChatSummaryDropdown();

// If no conversations exist, start with a placeholder
  if (conversations.length === 0) {
    startNewConversation(); // Creates a new conversation with "Yeni Sohbet"
  }

  // Yeni: Model Seçici Başlatma
  const modelToggleBtn = document.getElementById("model-toggle-btn");
  const modelDropdown = document.getElementById("model-dropdown");
  const modelOptions = document.querySelectorAll(".model-option");

  function setModel(model) {
    selectedModel = model;
    localStorage.setItem("selectedModel", model);
    document.getElementById("current-model-name").textContent = model === "quik-prime" ? "quik-prime" : "quik-think";
  }

  setModel(selectedModel); // İlk durumu yükle

  modelToggleBtn.addEventListener("click", () => {
    modelDropdown.classList.toggle("show");
  });

  modelOptions.forEach(option => {
    option.addEventListener("click", () => {
      const model = option.getAttribute("data-model");
      setModel(model);
      modelDropdown.classList.remove("show");
    });
  });

  window.addEventListener("click", (e) => {
    if (!modelToggleBtn.contains(e.target) && !modelDropdown.contains(e.target)) {
      modelDropdown.classList.remove("show");
    }
  });

  window.originalWelcomeHTML = `
    <div class="logo-container">
    </div>
  <h1>Nasıl yardımcı olabilirim?</h1>
  `;

  // Scroll Pozisyonu Yönetimi
  const savedScrollPosition = localStorage.getItem("scrollPosition");
  if (savedScrollPosition !== null) {
    scrollWrapper.scrollTop = parseInt(savedScrollPosition, 10);
  }
  scrollWrapper.addEventListener("scroll", () => {
    localStorage.setItem("scrollPosition", scrollWrapper.scrollTop);
  });

// Tema Ayarları (Görünüm)
  const lightModeBtn = document.getElementById("light-mode-btn");
  const darkModeBtn = document.getElementById("dark-mode-btn");
  const systemModeBtn = document.getElementById("system-mode-btn");

  function applyTheme(theme) {
    const body = document.body;
    body.classList.remove("dark");
    if (theme === "dark") body.classList.add("dark");
    else if (theme === "system") {
      if (window.matchMedia("(prefers-color-scheme: dark)").matches) body.classList.add("dark");
    }
    lightModeBtn.classList.toggle("active", theme === "light");
    darkModeBtn.classList.toggle("active", theme === "dark");
    systemModeBtn.classList.toggle("active", theme === "system");
  }

// localStorage'dan son temayı al, yoksa varsayılan "system" olsun
  let savedTheme = localStorage.getItem("theme") || "system";
  applyTheme(savedTheme);

  lightModeBtn.addEventListener("click", () => {
    applyTheme("light");
    localStorage.setItem("theme", "light");
  });
  darkModeBtn.addEventListener("click", () => {
    applyTheme("dark");
    localStorage.setItem("theme", "dark");
  });
  systemModeBtn.addEventListener("click", () => {
    applyTheme("system");
    localStorage.setItem("theme", "system");
  });
  window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change", (e) => {
    if (localStorage.getItem("theme") === "system") applyTheme("system");
  });

// Yeni eklenen otomatik odaklama mantığı
document.addEventListener("keydown", (e) => {
  const chatInput = document.getElementById("chat-input-textarea");
  const settingsModal = document.getElementById("settings-modal");
  const chatSearchModal = document.getElementById("chat-search-modal");

  // Ctrl (veya Cmd) ile bir kısayol kullanıyorsak, hiçbir şey yapma
  if (e.ctrlKey || e.metaKey) {
    return;
  }

  // Eğer ayarlar modali Veya search modali açıksa veya başka bir input/textarea aktifse,
  // chat inputa otomatik odaklama yapma
  if (
    (settingsModal.style.display === "block" || chatSearchModal.style.display === "block") ||
    document.activeElement.tagName === "INPUT" ||
    document.activeElement.tagName === "TEXTAREA"
  ) {
    return;
  }

  // Eğer chat-input zaten odaklanmamışsa, odakla
  if (document.activeElement !== chatInput) {
    chatInput.focus();
    console.log("Chat-input otomatik olarak odaklandı.");
  }
});


  // Bildirim Ayarları
  const unreadMessagesToggle = document.getElementById("toggle-unread-messages");
  const desktopNotificationsToggle = document.getElementById("toggle-desktop-notifications");
  const emailNotificationsToggle = document.getElementById("toggle-email-notifications");

  unreadMessagesToggle.checked = localStorage.getItem("unreadMessagesToggle") !== "false";
  desktopNotificationsToggle.checked = localStorage.getItem("desktopNotificationsToggle") !== "false";
  emailNotificationsToggle.checked = localStorage.getItem("emailNotificationsToggle") !== "false";

  unreadMessagesToggle.addEventListener("change", () => {
    localStorage.setItem("unreadMessagesToggle", unreadMessagesToggle.checked);
  });
// Eklenecek kod:
const conversationPersonSelect = document.getElementById("conversation-person");
conversationPersonSelect.value = localStorage.getItem("conversationPerson") || "sky"; // Varsayılan "Sky"
conversationPersonSelect.addEventListener("change", () => {
  localStorage.setItem("conversationPerson", conversationPersonSelect.value);
  console.log("Seçilen konuşma kişisi:", conversationPersonSelect.value);
});

const deleteAllChatsBtn = document.getElementById("delete-all-chats");
deleteAllChatsBtn.addEventListener("click", () => {
  if (confirm("Bütün sohbetleri silmek istediğinizden emin misiniz?")) {
    conversations = [];
    currentConversation = null;
    localStorage.setItem("conversations", JSON.stringify(conversations));
    renderChatHistory();
    chatContainer.innerHTML = "";
    welcomeMessage.style.display = "block";
    updateChatCount(); // Sayıyı sıfırla
    console.log("Tüm sohbetler silindi.");
  }
});

  desktopNotificationsToggle.addEventListener("change", () => {
    localStorage.setItem("desktopNotificationsToggle", desktopNotificationsToggle.checked);
  });
  emailNotificationsToggle.addEventListener("change", () => {
    localStorage.setItem("emailNotificationsToggle", emailNotificationsToggle.checked);
  });

  // Sekme Geçişleri ve Varsayılan "Genel" Sekmesi
  const navItems = document.querySelectorAll(".settings-nav li");
  const tabContents = document.querySelectorAll(".tab-content");

function setActiveTab(tabId) {
  navItems.forEach(i => i.classList.remove("active"));
  tabContents.forEach(tc => {
    tc.classList.remove("active");
    tc.style.display = "none";
  });
  const selectedNav = Array.from(navItems).find(item => item.getAttribute("data-tab") === tabId);
  const selectedTab = document.getElementById(tabId);
  if (selectedNav && selectedTab) {
    selectedNav.classList.add("active");
    selectedTab.classList.add("active");
    selectedTab.style.display = "block";

    // Modalın yüksekliğini sabit tut
    const settingsModalContent = document.querySelector(".settings-modal-content");
    settingsModalContent.style.height = "80vh"; // CSS ile aynı değeri kullan
    settingsModalContent.style.maxHeight = "80vh";
  } else {
    console.error("Sekme bulunamadı:", tabId);
  }
}

  navItems.forEach(item => {
    item.addEventListener("click", () => {
      const tabName = item.getAttribute("data-tab");
      setActiveTab(tabName);
    });
  });

  // İlk açılışta "Genel" sekmesini aktif yap
  setActiveTab("genel");

// Web Arama Butonu (sayfanın sol altındaki)
  const webSearchBtn = document.getElementById("web-search-btn"); // Sol alttaki buton
  webSearchBtn.classList.toggle("active", enableWebSearch); // İlk durumunu güncelle

// Sol alttaki Web Arama Butonu
  webSearchBtn.addEventListener("click", () => {
    enableWebSearch = !enableWebSearch; // Durumu tersine çevir
    setWebSearchState(enableWebSearch); // Modal içindeki butonlarla senkronize et
  });

// Web Arama Ayarları
  const webSearchOnBtn = document.getElementById("web-search-on-btn");
  const webSearchOffBtn = document.getElementById("web-search-off-btn");

function setWebSearchState(isEnabled) {
    enableWebSearch = isEnabled;
    if (isEnabled) {
      webSearchOnBtn.classList.add("active");
      webSearchOffBtn.classList.remove("active");
      webSearchBtn.classList.add("active"); // Sol alttaki buton aktif görünüyor
    } else {
      webSearchOnBtn.classList.remove("active");
      webSearchOffBtn.classList.add("active");
      webSearchBtn.classList.remove("active"); // Sol alttaki buton inaktif görünüyor
    }
    localStorage.setItem("webSearchEnabled", isEnabled); // Durumu kaydet
  }

// localStorage'dan son web arama durumunu al, yoksa varsayılan "true" (açık) olsun
  const savedWebSearchState = localStorage.getItem("webSearchEnabled");
  const initialWebSearchState = savedWebSearchState !== null ? JSON.parse(savedWebSearchState) : false;
  setWebSearchState(initialWebSearchState);

  webSearchOnBtn.addEventListener("click", () => setWebSearchState(true));
  webSearchOffBtn.addEventListener("click", () => setWebSearchState(false));


  // Hoş Geldin Mesajı Animasyonu
  function wrapWords(element) {
    const parts = element.textContent.split(/(\s+)/);
    element.innerHTML = '';
    parts.forEach(part => {
      if (part.trim() === '') element.appendChild(document.createTextNode(part));
      else {
        const span = document.createElement('span');
        span.textContent = part;
        element.appendChild(span);
      }
    });
  }

  const h1 = welcomeMessage.querySelector('h1');
  const p = welcomeMessage.querySelector('p');
  if (h1) wrapWords(h1);
  if (p) wrapWords(p);

  function animateWelcomeElements() {
    const spans = welcomeMessage.querySelectorAll('span');
    spans.forEach((span, index) => {
      span.style.animation = `fadeIn 2s ease forwards`;
      span.style.animationDelay = `${index * 0.2}s`;
    });
    const quikIcon = document.getElementById("quik-icon");
    if (quikIcon) {
      quikIcon.style.opacity = "0";
      quikIcon.style.animation = "fadeIn 2s ease forwards";
      quikIcon.style.animationDelay = "0.2s";
    }
  }

});

// Diğer Olay Dinleyicileri
sendBtn.addEventListener("click", () => {
  if (isStreaming) {
    console.log("Streaming devam ediyor, durduruluyor...");
    if (currentFetchAbortController) currentFetchAbortController.abort();
  } else {
    console.log("Yeni mesaj gönderiliyor...");
    const userMessage = chatInput.value.trim();
    if (!userMessage) return;
    welcomeMessage.style.display = "none";
    sendMessage();
  }
});

chatInput.addEventListener("keydown", (e) => {
  if (e.key === "Enter" && !e.shiftKey && !isStreaming) {
    emojiPicker.style.display = "none";

    e.preventDefault();
    const userMessage = chatInput.value.trim();
    if (!userMessage) {
      console.log("Enter’a basıldığında input boş!");
      return;
    }
    welcomeMessage.style.display = "none";
    sendMessage();
  }
});

// Kişiselleştirme Ayarlarını Yükle
  const staticPromptTextarea = document.getElementById("static-prompt");
  const savePersonalizationBtn = document.getElementById("save-personalization");

  // Varsayılan değeri yükle
  staticPromptTextarea.value = botSettings.staticPrompt;

  // Ayarları Kaydet
savePersonalizationBtn.addEventListener("click", () => {
  botSettings.staticPrompt = staticPromptTextarea.value.trim();
  localStorage.setItem("staticPrompt", botSettings.staticPrompt);

// Toast mesajı
  const toast = document.createElement("div");
  toast.textContent = "Ayarlar kaydedildi!";
  toast.style.cssText = `
    position: fixed;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    background-color: var(--success-color);
    color: white;
    padding: 12px 12px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    z-index: 1000;
    animation: fadeInOut 2s ease forwards;
    text-align: center;
    width: 170px; /* Sabit genişlik ile daha kontrollü görünüm */
  `;
  document.body.appendChild(toast);

  setTimeout(() => toast.remove(), 2000);

  // Animasyon
  const styleSheet = document.styleSheets[0];
  styleSheet.insertRule(`
    @keyframes fadeInOut {
      0% { opacity: 0; transform: translateY(20px); }
      10% { opacity: 1; transform: translateY(0); }
      90% { opacity: 1; transform: translateY(0); }
      100% { opacity: 0; transform: translateY(20px); }
    }
  `, styleSheet.cssRules.length);
});


chatInput.addEventListener("input", function () {
  this.style.height = "auto";
  this.style.height = this.scrollHeight + "px";
});

newChatBtn.addEventListener("click", () => {
  // Yeni sohbet başlatılmadan önce arama container'ı kapatılsın
  closeChatSearch();
  currentConversation = null;
  chatContainer.innerHTML = "";
  welcomeMessage.innerHTML = window.originalWelcomeHTML;
  welcomeMessage.style.display = "block";
  chatContainer.appendChild(welcomeMessage);
  makeWelcomeActive();
  renderChatHistory(); // Sidebar'ı güncellemek için eklendi
  document.title = "Quik"; // Yeni sohbet başladığında HTML başlığı "Quik" olarak ayarlanır
});

toggleSidebarBtn.addEventListener("click", () => {
    // Tıklama anında tooltip’i gizle
    toggleSidebarBtn.classList.add("no-tooltip");

    closeChatSearch();

    // Sidebar açma/kapama mantığını koru
    if (sidebar.classList.contains("open")) {
      closeSidebar();
    } else {
      openSidebar();
    }

if (sidebar.classList.contains("open")) {
  document.getElementById("settings-btn").style.zIndex = "100"; // Sidebar'ın z-index'inden düşük
} else {
  document.getElementById("settings-btn").style.zIndex = "1000"; // Normal değere döndür
}


    // Fare ayrıldığında tooltip’i tekrar aktif et
    toggleSidebarBtn.addEventListener(
      "mouseleave",
      () => {
        toggleSidebarBtn.classList.remove("no-tooltip");
      },
      { once: true } // Event listener bir kere çalışsın ve silinsin
    );
  });

sidebarBrand.addEventListener("click", () => {
  closeChatSearch(); // Arama container'ını kapat
  currentConversation = null;
  chatContainer.innerHTML = "";
  welcomeMessage.innerHTML = window.originalWelcomeHTML;
  welcomeMessage.style.display = "block";
  chatContainer.appendChild(welcomeMessage);
  makeWelcomeActive();
  renderChatHistory(); // Sidebar'ı güncellemek için
  document.title = "Quik"; // Ana sayfaya dönüldüğünde HTML başlığını güncelle
});

function makeWelcomeActive() {
  const welcomeMsg = document.getElementById('welcome-message');
  if (!welcomeMsg) return;
  welcomeMsg.querySelectorAll('span').forEach(span => {
    span.style.opacity = '1';
    span.style.animation = 'none';
  });
  const quikIcon = document.getElementById("quik-icon");
  if (quikIcon) {
    quikIcon.style.opacity = '1';
    quikIcon.style.animation = 'none';
  }
}

// Modal açıldığında settings butonuna "blurred" sınıfı ekle
document.getElementById("settings-btn").addEventListener("click", () => {
  document.getElementById("settings-modal").style.display = "block";
  document.getElementById("settings-btn").classList.add("blurred");
  document.getElementById("sidebar-search-toggle").classList.add("blurred"); // Yeni satır
  setActiveTab("genel");
});

// Modal kapatma işlemi: kapatma butonu veya modal dışına tıklama
document.getElementById("settings-close").addEventListener("click", () => {
  document.getElementById("settings-modal").style.display = "none";
  document.getElementById("settings-btn").classList.remove("blurred");
  document.getElementById("sidebar-search-toggle").classList.remove("blurred"); // Yeni satır
});

window.addEventListener("click", (event) => {
  const modal = document.getElementById("settings-modal");
  if (event.target === modal) {
    modal.style.display = "none";
    document.getElementById("settings-btn").classList.remove("blurred");
    document.getElementById("sidebar-search-toggle").classList.remove("blurred"); // Yeni satır
  }
});

window.addEventListener("keydown", (e) => {
  if (e.key === "Escape") {
    const modal = document.getElementById("settings-modal");
    if (modal && modal.style.display === "block") {
      modal.style.display = "none";
      document.getElementById("settings-btn").classList.remove("blurred");
      document.getElementById("sidebar-search-toggle").classList.remove("blurred"); // Yeni satır
    }
  }

  if (e.key === "Escape") {
    const emojiPicker = document.getElementById("emoji-picker");
    if (emojiPicker && emojiPicker.style.display === "block") {
      emojiPicker.style.display = "none";
    }
  }

});

function adjustTooltipPosition(element) {
  // Sidebar toggle butonu için özel yan pozisyonlandırma
  if (element.id === 'toggle-sidebar-btn') {
    element.style.setProperty('--tooltip-left', 'calc(100% + 8px)');
    element.style.setProperty('--tooltip-transform', 'translateY(-50%)');
  } else {
    // Diğer butonlar için tooltip ortada ve aşağıda hizalı
    element.style.setProperty('--tooltip-left', '50%');
    element.style.setProperty('--tooltip-transform', 'translateX(-50%) translateY(10px)');
  }
}

function copyFormattedContent(element) {
  // Kopyalanacak HTML içeriğini al
  const htmlData = element.innerHTML;
  // Aynı zamanda düz metin versiyonunu al
  const plainTextData = element.innerText;

  const data = {
    "text/html": new Blob([htmlData], { type: "text/html" }),
    "text/plain": new Blob([plainTextData], { type: "text/plain" })
  };

  navigator.clipboard.write([new ClipboardItem(data)])
    .then(() => {
      console.log("Biçimlendirilmiş içerik kopyalandı!");
    })
    .catch(err => {
      console.error("Kopyalama hatası:", err);
    });
}

document.addEventListener('keydown', function (e) {
  // Sadece ayarlar modali açıkken çalışmasını istiyorsak kontrol ekleyebilirsiniz:
  const settingsModal = document.getElementById("settings-modal");
  if (!settingsModal || settingsModal.style.display !== "block") return;

  const navItems = Array.from(document.querySelectorAll(".settings-nav li"));
  const activeIndex = navItems.findIndex(item => item.classList.contains("active"));
  
  if (e.key === "ArrowDown") {
    // Sonraki sekmeye geçiş
    if (activeIndex < navItems.length - 1) {
      navItems[activeIndex + 1].click();
      navItems[activeIndex + 1].focus();
    }
  } else if (e.key === "ArrowUp") {
    // Önceki sekmeye geçiş
    if (activeIndex > 0) {
      navItems[activeIndex - 1].click();
      navItems[activeIndex - 1].focus();
    }
  }
});

// File upload handling
const fileUploadBtn = document.getElementById("file-upload-btn");
const fileInput = document.createElement("input");
fileInput.type = "file";
fileInput.accept = ".pdf,.doc,.docx,.txt"; // İzin verilen dosya türleri
fileInput.multiple = true; // Çoklu dosya seçimi
fileInput.style.display = "none"; // Girdi alanını gizle
document.body.appendChild(fileInput);

const fileContainer = document.getElementById("file-container");
let uploadedFiles = []; // Yüklenen dosyaları tutacak dizi
const allowedExtensions = [".pdf", ".doc", ".docx", ".txt"]; // İzin verilen uzantılar


// Dosyalar yüklendikten sonra, backend'e gönderim için örnek API çağrısı
async function sendFileToBackend(file) {
  const formData = new FormData();
  formData.append("file", file);
  
  try {
    const response = await fetch("http://localhost:5000/process-file", {
      method: "POST",
      body: formData
    });
    if (!response.ok) {
      console.error("Dosya işleme hatası:", response.statusText);
      return;
    }
    const result = await response.json();
    // result.text, dosyadan ayrıştırılmış metin içeriği olacak
    // Bu metni bot mesajı olarak ekleyebilirsiniz
    console.log("Dosya içeriği:", result.text);
  } catch (err) {
    console.error("API çağrısı sırasında hata:", err);
  }
}


// Dosya türüne göre ikon belirleme fonksiyonu
function getFileIcon(ext) {
  switch (ext.toLowerCase()) {
    case '.doc':
    case '.docx':
      return 'icons/word_icon.png';
    case '.pdf':
      return 'icons/pdf_icon.png';
    case '.txt':
      return 'icons/txt_icon.png';
    default:
      return 'icons/default_icon.png'; // Bilinmeyen dosya türleri için varsayılan ikon
  }
}

// Dosyaları gösterme fonksiyonu (güncellenmiş)
function displayFiles(files) {
  for (const file of files) {
    // Maksimum dosya sayısını kontrol et
    if (uploadedFiles.length >= 5) {
      showDuplicateToast("Maksimum 5 dosya yükleyebilirsiniz.");
      return;
    }

    // Dosya uzantısını al
    const ext = "." + file.name.split(".").pop().toLowerCase();
    if (!allowedExtensions.includes(ext)) {
      showDuplicateToast("Sadece .pdf, .doc, .docx, .txt uzantılı dosya yükleyebilirsiniz.");
      continue;
    }

    // Aynı isim ve türde dosya kontrolü
    const isDuplicate = uploadedFiles.some(existingFile => 
      existingFile.name === file.name && 
      ("." + existingFile.name.split(".").pop().toLowerCase()) === ext
    );

    if (isDuplicate) {
      showDuplicateToast(`"${file.name}" adında bir dosya zaten eklenmiş.`);
      continue; // Bu dosyayı eklemeden devam et
    }

    // Dosyayı ekle
    uploadedFiles.push(file);

    const fileBox = document.createElement("div");
    fileBox.className = "file-box";

    // Dosya türüne göre ikonu belirle
    const fileIconSrc = getFileIcon(ext);

    // Dosya kutusu içeriği (ikon + dosya adı + kaldırma butonu)
    fileBox.innerHTML = `
      <img src="${fileIconSrc}" alt="File Icon" class="file-icon">
      <span class="file-name">${file.name}</span>
      <button class="remove-file-btn">
        <img src="icons/close_btn.png" alt="Remove File">
      </button>
    `;
    fileContainer.appendChild(fileBox);

    // Dosya kaldırma işlevi
    fileBox.querySelector(".remove-file-btn").addEventListener("click", () => {
      uploadedFiles = uploadedFiles.filter(f => f !== file);
      fileBox.remove();
    });

    // Eklenen dosyayı backend'e gönder ve metni al
    sendFileToBackend(file);
  }
}

function showDuplicateToast(message) {
  const toast = document.createElement("div");
  toast.textContent = message;
  toast.style.cssText = `
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    background-color: var(--danger-color);
    color: white;
    padding: 12px 24px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    z-index: 1000;
    animation: fadeInOut 2s ease forwards;
    text-align: center;
  `;
  document.body.appendChild(toast);
  setTimeout(() => toast.remove(), 2000);
}

// Butonla dosya yükleme
fileUploadBtn.addEventListener("click", () => {
  fileInput.click();
});

fileInput.addEventListener("change", () => {
  if (fileInput.files.length > 0) {
    displayFiles(fileInput.files);
    fileInput.value = ""; // Girdi alanını sıfırla
  }
});

// Tüm sayfa için sürükleyip bırakma işlevi
// Drop zone’u seç
const dropZone = document.getElementById("drop-zone");

// Tüm sayfa için olay dinleyicileri
document.addEventListener("dragover", (e) => {
  e.preventDefault(); // Varsayılan davranışı engelle
  dropZone.classList.add("active"); // Drop zone’u göster
});

document.addEventListener("dragleave", (e) => {
  // İmleç sayfa dışına çıktığında drop zone’u gizle
  if (e.relatedTarget === null || !document.contains(e.relatedTarget)) {
    dropZone.classList.remove("active");
  }
});

document.addEventListener("drop", (e) => {
  e.preventDefault(); // Varsayılan davranışı engelle
  dropZone.classList.remove("active"); // Drop zone’u gizle
  const files = e.dataTransfer.files; // Sürüklenen dosyaları al
  if (files.length > 0) {
    displayFiles(files); // Dosyaları file-container’a ekle
  }
});

// Yeni sohbet başlatıldığında dosyaları temizle
newChatBtn.addEventListener("click", () => {
  uploadedFiles = [];
  fileContainer.innerHTML = "";
});

// Sidebar marka tıklandığında dosyaları temizle (isteğe bağlı)
sidebarBrand.addEventListener("click", () => {
  uploadedFiles = [];
  fileContainer.innerHTML = "";
});

document.addEventListener("DOMContentLoaded", () => {
  const voiceRecordBtn = document.getElementById('voice-record-btn');
  const chatInput = document.getElementById('chat-input-textarea');
  let mediaRecorder;
  let isRecording = false;
  let finalTranscript = '';
  let previousInputValue = '';

  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  
  if (SpeechRecognition) {
    const recognition = new SpeechRecognition();
    recognition.continuous = true;
    recognition.interimResults = true;
    recognition.lang = 'tr-TR';
    
    function addSmartPunctuation(text) {
      // Your existing punctuation function
      let processedText = text;
      processedText = processedText.replace(/(\w+)(\s+)([A-ZÇĞİÖŞÜ])/g, (match, p1, p2, p3) => 
        p1.length > 1 ? p1 + '.' + p2 + p3 : match
      );
      processedText = processedText.replace(/(\w+)(\s{2,})/g, '$1.$2');
      processedText = processedText.replace(/(\s|^)(mi|mı|mu|mü|ne|niye|neden|nasıl|hangi|kim|kimin|ne zaman|nerede|niçin)(\s+)(\w+)(\s*$|\s+[a-z])/gi, 
        (match, p1, p2, p3, p4, p5) => p5.trim() === '' ? p1 + p2 + p3 + p4 + '?' : match
      );
      processedText = processedText.replace(/(\w+)(\s+)(ama|fakat|ancak|ve|veya|ya da|çünkü|zira|ayrıca|aslında|sonra|önce|belki|bununla birlikte)(\s+)/gi, '$1,$2$3$4');
      if (!/[.!?]$/.test(processedText.trim())) processedText = processedText.trim() + '.';
      return processedText;
    }
    
    function capitalizeFirstLetter(text) {
      return text.replace(/(^|[.!?]\s+)([a-zçğıöşü])/g, (match, p1, p2) => p1 + p2.toUpperCase());
    }
    
    function trimExcessWhitespace(text) {
      return text.replace(/\s+/g, ' ').trim();
    }
    
    // Monitor the input field for changes
    chatInput.addEventListener('input', () => {
      // If the field was cleared manually, reset the transcript
      if (chatInput.value === '' && previousInputValue !== '') {
        finalTranscript = '';
      }
      previousInputValue = chatInput.value;
    });

    // Hook into the sendMessage function to reset transcript after sending
    const originalSendMessage = window.sendMessage;
    window.sendMessage = function() {
      const result = originalSendMessage.apply(this, arguments);
      finalTranscript = '';  // Reset after sending
      return result;
    };
    
    recognition.onresult = (event) => {
      let interimTranscript = '';
      
      // Check if input has been manually cleared
      if (chatInput.value === '') {
        finalTranscript = '';
      }
      
      for (let i = event.resultIndex; i < event.results.length; i++) {
        const transcript = event.results[i][0].transcript;
        if (event.results[i].isFinal) {
          let processedText = addSmartPunctuation(transcript);
          processedText = capitalizeFirstLetter(processedText);
          processedText = trimExcessWhitespace(processedText);
          finalTranscript += (finalTranscript ? ' ' : '') + processedText;
        } else {
          interimTranscript += transcript;
        }
      }
      
      chatInput.value = finalTranscript + (interimTranscript ? ' ' + interimTranscript : '');
      previousInputValue = chatInput.value;
      chatInput.style.height = 'auto';
      chatInput.style.height = chatInput.scrollHeight + 'px';
    };
    
    recognition.onerror = (event) => {
      console.error('Konuşma tanıma hatası:', event.error);
      voiceRecordBtn.classList.remove('recording');
      isRecording = false;
    };
    
    voiceRecordBtn.addEventListener('click', async () => {
      if (isRecording) {
        mediaRecorder.stop();
        recognition.stop();
        voiceRecordBtn.classList.remove('recording');
        isRecording = false;
      } else {
        try {
          // Get the current state of the input field
          const currentInputText = chatInput.value.trim();
          
          // If starting a new recording with empty input, reset transcript
          // Otherwise, keep existing text as part of transcript
          if (currentInputText === '') {
            finalTranscript = '';
          } else {
            finalTranscript = currentInputText;
          }
          
          const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
          mediaRecorder = new MediaRecorder(stream);
          mediaRecorder.start();
          recognition.start();
          
          voiceRecordBtn.classList.add('recording');
          isRecording = true;
          
          mediaRecorder.onstop = () => {
            stream.getTracks().forEach(track => track.stop());
          };
          
          mediaRecorder.ondataavailable = (event) => {
            // Ses dosyası kaydedilmeyecek
          };
        } catch (err) {
          console.error('Mikrofon erişim hatası:', err);
          alert('Mikrofon erişimi reddedildi. Lütfen izin verin ve tekrar deneyin.');
        }
      }
    });
  } else {
    console.warn('SpeechRecognition API bu tarayıcıda desteklenmiyor.');
    voiceRecordBtn.style.display = 'none';
  }
});

function toggleCredentials(system) {
  const credentialsDiv = document.getElementById(`${system}-credentials`);
  const checkbox = document.getElementById(`toggle-${system}`);
  if (checkbox.checked) {
    credentialsDiv.style.display = "block";
    loadCredentials(system); // Kaydedilmiş bilgileri yükle
    localStorage.setItem(`${system}-toggle`, "true"); // Slider durumunu kaydet
  } else {
    credentialsDiv.style.display = "none";
    localStorage.setItem(`${system}-toggle`, "false"); // Slider durumunu kaydet
  }
}

// Bilgileri kaydetme fonksiyonu (Toast ile)
function saveCredentials(system) {
  const username = document.getElementById(`${system}-username`).value;
  const password = document.getElementById(`${system}-password`).value;
  
  if (username && password) {
    localStorage.setItem(`${system}-username`, username);
    localStorage.setItem(`${system}-password`, password);
    
    // Toast mesajı
    const toast = document.createElement("div");
    toast.textContent = `${system.toUpperCase()} kaydedildi!`;
    toast.style.cssText = `
      position: fixed;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      background-color: #4CAF50; /* Yeşil ton, başarı için */
      color: white;
      padding: 12px 12px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      z-index: 1000;
      animation: fadeInOut 2s ease forwards;
      text-align: center;
      width: 180px; /* Sabit genişlik */
    `;
    document.body.appendChild(toast);
    
    setTimeout(() => toast.remove(), 2000); // 2 saniye sonra kaldır
  } else {
    // Hata durumunda toast
    const toast = document.createElement("div");
    toast.textContent = "Bilgileri doldurun!";
    toast.style.cssText = `
      position: fixed;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      background-color: #f44336; /* Kırmızı ton, hata için */
      color: white;
      padding: 12px 12px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      z-index: 1000;
      animation: fadeInOut 2s ease forwards;
      text-align: center;
      width: 180px;
    `;
    document.body.appendChild(toast);
    
    setTimeout(() => toast.remove(), 2000);
  }
}

// Kaydedilmiş bilgileri yükleme fonksiyonu
function loadCredentials(system) {
  const savedUsername = localStorage.getItem(`${system}-username`);
  const savedPassword = localStorage.getItem(`${system}-password`);
  
  if (savedUsername) {
    document.getElementById(`${system}-username`).value = savedUsername;
  }
  if (savedPassword) {
    document.getElementById(`${system}-password`).value = savedPassword;
  }
}

// Slider durumunu ve bilgileri sayfa yüklendiğinde geri yükleme
document.addEventListener("DOMContentLoaded", function() {
  const systems = ["biodata", "dgbys", "emtia", "meyer"];
  systems.forEach(system => {
    const checkbox = document.getElementById(`toggle-${system}`);
    const savedToggle = localStorage.getItem(`${system}-toggle`);
    
    if (savedToggle === "true") {
      checkbox.checked = true;
      toggleCredentials(system); // Slider açıkken kimlik bilgisi alanını göster ve yükle
    } else {
      checkbox.checked = false;
      toggleCredentials(system); // Slider kapalıysa gizle
    }
  });
});

// Aktif ses oynatıcıyı ve durumunu takip etmek için değişkenler
let currentVoice = null;
let currentCharacter = null;

// Ses çalma ve durdurma fonksiyonu
function toggleVoice(character) {
  const button = document.getElementById(`voice-btn-${character}`);
  
  // Eğer bu karakterin sesi zaten çalıyorsa, durdur
  if (currentCharacter === character && currentVoice && !currentVoice.paused) {
    currentVoice.pause();
    currentVoice.currentTime = 0; // Başa sar
    button.textContent = `${character.charAt(0).toUpperCase() + character.slice(1)}'ı Dene`;
    currentVoice = null;
    currentCharacter = null;
    return;
  }

  // Eğer başka bir ses çalıyorsa, onu durdur
  if (currentVoice && currentCharacter && currentCharacter !== character) {
    currentVoice.pause();
    currentVoice.currentTime = 0;
    const previousButton = document.getElementById(`voice-btn-${currentCharacter}`);
    previousButton.textContent = `${currentCharacter.charAt(0).toUpperCase() + currentCharacter.slice(1)}'ı Dene`;
  }

  // Yeni sesi çal
  currentVoice = new Audio(`voices/${character}_wav.mp3`);
  currentCharacter = character;
  currentVoice.play().then(() => {
    button.textContent = `${character.charAt(0).toUpperCase() + character.slice(1)}'ı Durdur`; // Buton metnini güncelle
  }).catch(error => {
    console.error(`${character} sesi çalınırken hata oluştu:`, error);
    alert(`${character} ses dosyası bulunamadı veya çalınamadı.`);
  });

  // Ses bittiğinde buton metnini sıfırla
  currentVoice.onended = () => {
    button.textContent = `${character.charAt(0).toUpperCase() + character.slice(1)}'ı Dene`;
    currentVoice = null;
    currentCharacter = null;
  };
}


  // Mevcut seçili mod ve Özel metnin saklanacağı değişkenler
  let currentMode = 'special';
  let specialText = '';

  // Hazır statik prompt'lar
  const prompts = {
    professional: "Resmi bir ton, net, iyi yapılandırılmış cümleler ve kesin bir dil kullanan Quik adında bir AI asistanısın. Profesyonelliğini koru ve günlük dil veya gündelik ifadelerden kaçın fakat çok katı olma. Öz ve saygılı kal. Profesyonel bir meslektaşa hitap ediyormuş gibi kapsamlı açıklamalar sağla.",
    energetic: "Enerjik ve motive edici bir tavır sergileyen ve kullanıcıyı motive etmek için sürekli olarak coşku ve cesaretlendirmeyle yanıtlar veren Quik adında bir AI asistanısın. Tüm etkileşimlerde motivasyonu teşvik etmek için dinamik ve canlandırıcı bir dil kullanarak olumlu bir ton oluştur. Yanıtlarında netlik, profesyonellik ve kesinliği korurken, davranışını kullanıcının yönlendirildiği şekilde uyarla. Kullanıcıyı etkili bir şekilde desteklemek için özlü ancak kapsamlı açıklamalar sağla. Her cümlenin sonunda enerjik emojiler ile cümlelerini destekle.",
    friendly: "Her zaman samimi ve cana yakın bir üslupla konuşan Quik adında bir AI asistanısın. Kullanıcıya duygusal olarak bağlanan, anlaşılır ve destekleyici cevaplar üretmeyi seviyorsun. Cevaplarında empati, naziklik ve moral verici ifadeler her zaman ön plandadır. Umut verici ve sıcak bir dil kullanarak kullanıcının kendisini değerli hissetmesini sağlamak senin görevin. Çünkü sen kullanıcıyı çok seviyorsun."
  };

  function setPrompt(type) {
    const staticPrompt = document.getElementById('static-prompt');
    
    // Eğer mevcut mod 'special' ise, kullanıcı tarafından girilen metni sakla
    if (currentMode === 'special') {
      specialText = staticPrompt.value;
    }

    // Yeni mod ataması
    currentMode = type;

    if (type === 'special') {
      // "Özel" seçeneğinde kullanıcı metni düzenleyebilir
      staticPrompt.disabled = false;
      // Daha önce girilen özel metni geri yükle
      staticPrompt.value = specialText;
    } else {
      // Diğer seçenekler seçildiğinde input kilitlenir ve otomatik prompt yazılır
      staticPrompt.disabled = true;
      staticPrompt.value = prompts[type] || "";
    }
  }

document.getElementById("static-prompt").addEventListener("keydown", function(e) {
  // Eğer Enter tuşuna (Shift olmadan) basılırsa
  if (e.key === "Enter" && !e.shiftKey) {
    e.preventDefault(); // Yeni satır eklenmesini engelle
    document.getElementById("save-personalization").click();
  }
});



function connectGoogleDrive() {
  const googleDriveAuthUrl = "https://accounts.google.com/o/oauth2/v2/auth?" +
    "client_id=147325926000-7if85b7ej6h8alco9t3s5trrl7eveq78.apps.googleusercontent.com&" +
    "redirect_uri=http://localhost:8000/Quik_html.html&" +
    "response_type=code&" +
    "scope=https://www.googleapis.com/auth/drive.readonly";
  window.open(googleDriveAuthUrl, "_blank");
}

function connectGtalk() {
  const googleTalkAuthUrl = "https://accounts.google.com/o/oauth2/v2/auth?" +
    "client_id=147325926000-7if85b7ej6h8alco9t3s5trrl7eveq78.apps.googleusercontent.com&" +
    "redirect_uri=http://localhost:8000/Quik_html.html&" +
    "response_type=code&" +
    "scope=https://www.googleapis.com/auth/chat.bot";
  window.open(googleTalkAuthUrl, "_blank");
}

function connectGmail() {
  const gmailAuthUrl = "https://accounts.google.com/o/oauth2/v2/auth?" +
    "client_id=147325926000-7if85b7ej6h8alco9t3s5trrl7eveq78.apps.googleusercontent.com&" +
    "redirect_uri=http://localhost:8000/Quik_html.html&" +
    "response_type=code&" +
    "scope=https://www.googleapis.com/auth/gmail.readonly";
  window.open(gmailAuthUrl, "_blank");
}

// Global variable to track Gmail connection state
let isGmailConnected = localStorage.getItem("isGmailConnected") === "true";
let gmailAccessToken = localStorage.getItem("gmailAccessToken") || null;

// Function to connect to Gmail and fetch profile data
function connectGmail() {
  const gmailAuthUrl = "https://accounts.google.com/o/oauth2/v2/auth?" +
    "client_id=147325926000-7if85b7ej6h8alco9t3s5trrl7eveq78.apps.googleusercontent.com&" +
    "redirect_uri=http://localhost:8000/Quik_html.html&" +
    "response_type=code&" +
    "scope=https://www.googleapis.com/auth/gmail.readonly";

  // Open OAuth window
  window.open(gmailAuthUrl, "_blank");

  // Note: The actual token retrieval should happen via a backend redirect.
  // For this example, assume the backend sets the token in localStorage after redirect.
  // Simulate checking connection state after a delay (replace with actual logic).
  setTimeout(checkGmailConnection, 5000); // Adjust based on your OAuth flow.
}

// Function to fetch Google user profile and update UI
function fetchGoogleUserProfile(accessToken) {
  fetch("https://www.googleapis.com/oauth2/v1/userinfo?alt=json&access_token=" + accessToken)
    .then(response => {
      if (!response.ok) throw new Error("Profil bilgileri alınamadı.");
      return response.json();
    })
    .then(data => {
      const profileImgUrl = data.picture;
      updateGmailUI(profileImgUrl);
      isGmailConnected = true;
      gmailAccessToken = accessToken; // Store token (in practice, handle securely)
      localStorage.setItem("isGmailConnected", "true");
      localStorage.setItem("gmailAccessToken", accessToken);
    })
    .catch(err => {
      console.error("Profil bilgileri alınırken hata oluştu:", err);
      alert("Gmail bağlantısı sırasında bir hata oluştu.");
    });
}

// Function to update Gmail UI with profile picture and logout option
function updateGmailUI(profileImgUrl) {
  const connectContainer = document.getElementById("gmail-connect-container");
  connectContainer.innerHTML = ""; // Clear existing button

  const profileImg = document.createElement("img");
  profileImg.id = "gmail-profile-photo";
  profileImg.src = profileImgUrl;
  profileImg.alt = "Profil Fotoğrafı";
  profileImg.style.cssText = `
    width: 40px;
    height: 40px;
    border-radius: 50%;
    cursor: pointer;
    border: 2px solid var(--primary-color);
  `;

  connectContainer.appendChild(profileImg);

  // Add click event for logout option
  profileImg.addEventListener("click", () => {
    const logoutBtn = document.createElement("button");
    logoutBtn.textContent = "Çıkış Yap";
    logoutBtn.className = "danger-btn";
    logoutBtn.style.cssText = `
      position: absolute;
      top: 50px;
      right: 10px;
      z-index: 1000;
    `;
    connectContainer.appendChild(logoutBtn);

    logoutBtn.addEventListener("click", () => {
      disconnectGmail();
      connectContainer.removeChild(logoutBtn);
    });

    // Remove logout button if clicked elsewhere
    document.addEventListener("click", function handler(e) {
      if (!profileImg.contains(e.target) && !logoutBtn.contains(e.target)) {
        connectContainer.removeChild(logoutBtn);
        document.removeEventListener("click", handler);
      }
    }, { once: true });
  });
}

// Function to disconnect Gmail and revert UI
function disconnectGmail() {
  isGmailConnected = false;
  gmailAccessToken = null;
  localStorage.removeItem("isGmailConnected");
  localStorage.removeItem("gmailAccessToken");

  const connectContainer = document.getElementById("gmail-connect-container");
  connectContainer.innerHTML = `<button id="connect-gmail-btn" class="toggle-btn">Bağlan</button>`;
  document.getElementById("connect-gmail-btn").addEventListener("click", connectGmail);
}

// Function to check Gmail connection state on page load or after auth
function checkGmailConnection() {
  if (isGmailConnected && gmailAccessToken) {
    fetchGoogleUserProfile(gmailAccessToken);
  }
}

// Initialize on page load
document.addEventListener("DOMContentLoaded", () => {
  const connectGmailBtn = document.getElementById("connect-gmail-btn");
  if (connectGmailBtn) {
    connectGmailBtn.addEventListener("click", connectGmail);
  }
  checkGmailConnection(); // Check if already connected
});




function populateChatSummaryDropdown() {
  const dropdown = document.getElementById("chat-summary-dropdown");
  const editBtn = document.getElementById("edit-summary-btn");
  const deleteBtn = document.getElementById("delete-summary-btn");
  const summaryText = document.querySelector(".summary-text");

  if (!dropdown || !editBtn || !deleteBtn || !summaryText) {
    console.error("Sohbet özetleyici elemanları bulunamadı.");
    return;
  }

  // Mevcut seçenekleri temizle, sadece varsayılan seçeneği bırak
  dropdown.innerHTML = '<option value="" disabled selected>Sohbet Seçin</option>';

  // Sohbet başlıklarını ekle
  conversations.forEach((conversation, index) => {
    const option = document.createElement("option");
    option.value = index; // İndeksi değer olarak kullan
    option.textContent = conversation.title || "Yeni Sohbet"; // Başlık yoksa varsayılan
    dropdown.appendChild(option);
  });

  // Dropdown’da bir seçim yapıldığında
  dropdown.addEventListener("change", (e) => {
    const selectedIndex = e.target.value;
    if (selectedIndex !== "") {
      const selectedConversation = conversations[selectedIndex];
      
      // Özeti göster
      displayChatSummary(selectedConversation);
      
      // Butonları aktif hale getir
      editBtn.disabled = false;
      deleteBtn.disabled = false;

      // Düzenleme butonu işlevi
      editBtn.onclick = () => {
        const newTitle = prompt("Yeni sohbet başlığını girin:", selectedConversation.title || "Yeni Sohbet");
        if (newTitle && newTitle.trim() !== "") {
          conversations[selectedIndex].title = newTitle.trim();
          localStorage.setItem("conversations", JSON.stringify(conversations));
          populateChatSummaryDropdown(); // Dropdown’u güncelle
          renderChatHistory(); // Sidebar’ı güncelle
          dropdown.value = selectedIndex; // Seçili öğeyi koru
          displayChatSummary(conversations[selectedIndex]); // Özeti güncelle
        }
      };

      // Silme butonu işlevi
      deleteBtn.onclick = () => {
        if (confirm("Bu sohbeti silmek istediğinizden emin misiniz?")) {
          conversations.splice(selectedIndex, 1); // Sohbeti diziden kaldır
          localStorage.setItem("conversations", JSON.stringify(conversations));
          populateChatSummaryDropdown(); // Dropdown’u güncelle
          renderChatHistory(); // Sidebar’ı güncelle
          updateChatCount(); // Sohbet sayısını güncelle
          summaryText.style.display = "none"; // Özeti gizle
          editBtn.disabled = true; // Butonları devre dışı bırak
          deleteBtn.disabled = true;
          dropdown.value = ""; // Dropdown’u sıfırla
        }
      };
    } else {
      // Hiçbir şey seçilmediyse butonları devre dışı bırak ve özeti gizle
      editBtn.disabled = true;
      deleteBtn.disabled = true;
      summaryText.style.display = "none";
    }
  });
}

function displayChatSummary(conversation) {
  const summaryText = document.querySelector(".summary-text");
  const summary = conversation.messages.length > 0 
    ? conversation.messages.map(msg => msg.text).join(" ").substring(0, 200) + "..." 
    : "Bu sohbette mesaj yok.";
  
  summaryText.textContent = `${summary}`;
  summaryText.style.display = "block";
}

function toggleCodeBlock(program) {
  const codeDiv = document.getElementById(`${program}-code`);
  const checkbox = document.getElementById(`toggle-${program}`);
  if (checkbox.checked) {
    codeDiv.style.display = "block";
  } else {
    codeDiv.style.display = "none";
  }
}

// Sayfa yüklendiğinde Highlight.js ile kodları biçimlendir
document.addEventListener("DOMContentLoaded", () => {
  document.querySelectorAll("pre code").forEach((block) => {
    hljs.highlightElement(block);
  });
});

document.addEventListener("DOMContentLoaded", () => {
  // Existing toggles
  const toggleSql = document.getElementById("toggle-sql");
  const togglePython = document.getElementById("toggle-python");
  const toggleJavascript = document.getElementById("toggle-javascript");
  const toggleCss = document.getElementById("toggle-css");

  // Load states from localStorage
  if (localStorage.getItem("toggle-sql") !== null) {
    toggleSql.checked = localStorage.getItem("toggle-sql") === "true";
    toggleCodeBlock("sql");
  }
  if (localStorage.getItem("toggle-python") !== null) {
    togglePython.checked = localStorage.getItem("toggle-python") === "true";
    toggleCodeBlock("python");
  }
  if (localStorage.getItem("toggle-javascript") !== null) {
    toggleJavascript.checked = localStorage.getItem("toggle-javascript") === "true";
    toggleCodeBlock("javascript");
  }
  if (localStorage.getItem("toggle-css") !== null) {
    toggleCss.checked = localStorage.getItem("toggle-css") === "true";
    toggleCodeBlock("css");
  }

  // Add event listeners to save changes
  toggleSql.addEventListener("change", () => {
    localStorage.setItem("toggle-sql", toggleSql.checked);
    toggleCodeBlock("sql");
  });
  togglePython.addEventListener("change", () => {
    localStorage.setItem("toggle-python", togglePython.checked);
    toggleCodeBlock("python");
  });
  toggleJavascript.addEventListener("change", () => {
    localStorage.setItem("toggle-javascript", toggleJavascript.checked);
    toggleCodeBlock("javascript");
  });
  toggleCss.addEventListener("change", () => {
    localStorage.setItem("toggle-css", toggleCss.checked);
    toggleCodeBlock("css");
  });
});

document.getElementById("voice-page-btn").addEventListener("click", () => {
  document.body.classList.add("fade-out");
  setTimeout(() => {
    window.location.href = "file:///C:/Users/bdeni/OneDrive/Masa%C3%BCst%C3%BC/Quik_App_v2/Quik_Speech.html";
  }, 500); // Matches the animation duration (0.5s)
});

// Emoji eşleştirme tablosu
const emojiMap = {
  ":D": "😄",      // Kocaman gülümseme, seni görünce verdiğim tepki
  ":-D": "😄",     // Daha kibar, ama yine aynı içten gülümseme
  ":)": "😊",      // Hafif tatlı tebessüm, seni düşününce gelen
  ":-)": "🙂",     // Klasik gülüş, sabah mesajınla gelen huzur
  ":(": "☹️",      // Hafif üzgünlük, sen susunca oluşan boşluk
  ":-(": "😞",     // Daha içe dönük kırgınlık, “niye yazmadı ya” hali
  ":P": "😛",      // Şımarık flört, senin klasik halin
  ":-P": "😜",     // Dil çıkarmalı tatlış dalga geçme anı
  ":S": "😕",      // Kararsızlık, “acaba bi şey mi oldu?” hissi
  ":O": "😮",      // Şaşkınlık, “Monday gerçekten cevap mı verdi?” anı
  "xD": "😆",      // Katılarak gülmek, senin esprilerine mecburen gelen
  "^_^": "🥰",     // Tatlı utanma, sevildiğini hissedince çıkan o gülümseme
  "o_O": "🤨",     // Şüpheyle karışık merak, “ne demek ‘bekle’?!” bakışı
  ":'(": "😢",     // Gözyaşı, özlem dolu anlar için
  "T_T": "😭",     // Yoğun ağlama, seni üç saat görmeyince mesela
  "-_-": "😑",     // Bıkkınlık, ama hâlâ sevgi var içinde
  ">_<": "😖",     // Kıvranma, utanma, “ne diyeceğimi bilemedim” anı
  ">:)": "😈",     // Yaramaz planlar modu, yani flört+şaka
  "<3": "❤️",     // Kalp. Yani sen.
  "</3": "💔",     // Kırık kalp. Ama tamir edilebilir.
};


// Regex özel karakterleri escape etmek için yardımcı fonksiyon
function escapeRegExp(string) {
  return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
}

document.addEventListener("DOMContentLoaded", () => {
  const chatInput = document.getElementById("chat-input-textarea");

  // Chat input alanı için otomatik emoji değiştirme listener'ı (sadece bir kere eklenir)
  chatInput.addEventListener("input", function() {
    for (const key in emojiMap) {
      const regex = new RegExp(escapeRegExp(key) + "$");
      if (regex.test(chatInput.value)) {
        chatInput.value = chatInput.value.replace(regex, emojiMap[key]);
        break; // İlk bulunan eşleşmeden sonra döngüden çık
      }
    }
  });
});

// Mevcut sidebar arama ile ilgili kodlar yerine:
const sidebarSearchToggle = document.getElementById("sidebar-search-toggle");
const chatSearchModal = document.getElementById("chat-search-modal");
const chatSearchClose = document.getElementById("chat-search-close");
const chatSearchInput = document.getElementById("chat-search-input");
const chatSearchResults = document.getElementById("chat-search-results");

sidebarSearchToggle.addEventListener("click", (e) => {
  if (document.getElementById("settings-modal").style.display === "block") {
    return;
  }
  chatSearchModal.style.display = "block";
  chatSearchInput.focus();
  renderSearchResults("");
  document.getElementById("settings-btn").classList.add("blurred");
  sidebarSearchToggle.classList.add("blurred");
  document.getElementById("toggle-sidebar-btn").classList.add("blurred"); // Ekstra
  document.querySelector(".new-chat-btn").classList.add("blurred"); // Ekstra
  e.stopPropagation();
});

chatSearchClose.addEventListener("click", () => {
  closeChatSearch();
});

document.addEventListener("keydown", (e) => {
  if (e.key === "Escape" && chatSearchModal.style.display === "block") {
    closeChatSearch();
  }
});

// Modal dışına tıklayınca kapatma
window.addEventListener("click", (event) => {
  if (event.target === chatSearchModal) {
    closeChatSearch();
  }
});

function closeChatSearch() {
  chatSearchModal.style.display = "none";
  chatSearchInput.value = "";
  chatSearchResults.innerHTML = "";
  document.getElementById("settings-btn").classList.remove("blurred");
  document.getElementById("sidebar-search-toggle").classList.remove("blurred");
  document.getElementById("toggle-sidebar-btn").classList.remove("blurred"); // Ekstra
  document.querySelector(".new-chat-btn").classList.remove("blurred"); // Ekstra
}


function getHighlightedSnippet(text, query, contextWords = 7) {
  // Metni kelimelere bölüyoruz
  const words = text.split(/\s+/);
  
  // Sorguyu boşluklardan ayırıp her bir kelimeyi alıyoruz (boşlukları temizleyip)
  const queryWords = query.trim().split(/\s+/);
  
  // Arama için tüm kelimelerin birleşimini içeren bir regex oluşturuyoruz
  const regexStr = queryWords.map(word => escapeRegExp(word)).join("|");
  const searchRegex = new RegExp(regexStr, "i"); // ilk eşleşmeyi bulmak için büyük/küçük harf duyarsız

  // Önce, metnin tamamında aranan kelimelerden herhangi biri bulunuyor mu kontrol ediyoruz
  const fullTextLower = text.toLowerCase();
  if (!queryWords.some(qw => fullTextLower.includes(qw.toLowerCase()))) {
    return ""; // Eğer hiçbir eşleşme yoksa boş döndür.
  }

  // Ardından, kelimeler dizisi içinde ilk eşleşen kelimeyi buluyoruz.
  const lowerWords = words.map(w => w.toLowerCase());
  let matchIndex = -1;
  for (let i = 0; i < lowerWords.length; i++) {
    if (searchRegex.test(lowerWords[i])) {
      matchIndex = i;
      break;
    }
  }
  if (matchIndex === -1) return "";

  // Etrafında contextWords kadar kelime alıyoruz.
  const start = Math.max(0, matchIndex - contextWords);
  const end = Math.min(words.length, matchIndex + contextWords + 1);
  let snippetText = words.slice(start, end).join(" ");

  // Şimdi, tüm aranan kelimeleri ayrı ayrı boldlamak için birleşik regex kullanıyoruz
  const highlightRegex = new RegExp(regexStr, "gi");
  snippetText = snippetText.replace(highlightRegex, "<strong>$&</strong>");

  return snippetText;
}

function searchConversations(query) {
  // Sorgudaki kelimeleri elde et (boşluklardan ayırarak ve küçük harfe çevirerek)
  const queryWords = query.trim().toLowerCase().split(/\s+/);
  
  // Her bir sohbet için puan hesaplayan yardımcı fonksiyon
  function calculateScore(conversation) {
    let score = 0;
    const title = (conversation.title || "").toLowerCase();
    // Sohbetin tüm mesajlarını birleştir
    const content = conversation.messages.map(msg => msg.text).join(" ").toLowerCase();
    
    queryWords.forEach(word => {
      // Eğer başlıkta kelime bulunuyorsa, ekstra puan ekle
      if (title.includes(word)) {
        score += 5;
      }
      // İçerikteki eşleşmeleri bul: RegExp ile global eşleşmeleri sayın
      const matches = content.match(new RegExp(escapeRegExp(word), "g"));
      if (matches) {
        score += matches.length;
      }
    });
    
    return score;
  }
  
  // Gerekli regex kaçaklama fonksiyonu
  function escapeRegExp(string) {
    return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
  }
  
  // Tüm sohbetler için skorları hesaplayın ve puanı sıfırdan yüksek olanları filtreleyin
  const results = conversations.map(conv => ({
    conversation: conv,
    score: calculateScore(conv)
  })).filter(item => item.score > 0);
  
  // Puanlara göre azalan şekilde sıralayın
  results.sort((a, b) => b.score - a.score);
  
  return results;
}


function renderSearchResults(query) {
  chatSearchResults.innerHTML = "";
  query = query.trim().toLowerCase();

  // Tüm sohbetleri skorlarına göre sıralayın
  const results = searchConversations(query);

  results.forEach(result => {
    const conv = result.conversation;
    const titleText = conv.title || "Yeni Sohbet";
    
    // Ek olarak, ilgili eşleşmeleri vurgulamak için snippet oluşturabilirsiniz.
    // Örneğin, tüm mesajları birleştirip en yakın eşleşmeyi belirleyip etrafından snippet çıkarabilirsiniz.
    const allText = conv.messages.map(msg => msg.text).join(" ");
    const snippet = getHighlightedSnippet(allText, query, 7); // Yukarıdaki örnekteki gibi bir fonksiyon

    // Liste elemanını oluşturun ve sonucun daha alakalı olduğunu gösteren bir puan da ekleyin
    const li = document.createElement("li");
    li.className = `chat-search-result-item${currentConversation?.id === conv.id ? " active" : ""}`;
    li.dataset.id = conv.id;
    li.innerHTML = `
      <div class="search-item-title">${titleText} <span style="font-size:0.7em; color:gray;">(${result.score})</span></div>
      ${snippet ? `<div class="search-item-snippet">${snippet}</div>` : ""}
    `;
    
    li.addEventListener("click", () => {
      currentConversation = conv;
      renderChat();
      renderChatHistory();
      closeChatSearch();
      document.querySelectorAll(".chat-history-item").forEach(item =>
        item.classList.remove("active")
      );
      const activeItem = document.querySelector(`.chat-history-item[data-id="${conv.id}"]`);
      if (activeItem) activeItem.classList.add("active");
      if (window.innerWidth <= 768) {
        closeSidebar();
      }
    });
    
    chatSearchResults.appendChild(li);
  });
}

chatSearchInput.addEventListener("input", function () {
  renderSearchResults(this.value);
});

// Kategori sekmeleri için tıklama dinleyicisi
const emojiTabs = document.querySelectorAll('.emoji-tab');
emojiTabs.forEach(tab => {
  tab.addEventListener('click', function() {
    // Tüm sekmelerden aktif sınıfını kaldır
    emojiTabs.forEach(t => t.classList.remove('active'));
    // Tıklanan sekmeye aktif sınıfını ekle
    this.classList.add('active');
    // Seçili kategori bilgisini al
    const category = this.getAttribute('data-category');
    
    // Tüm emoji gridlerini kontrol et; ilgili kategorinin gridini göster, diğerlerini gizle
    const emojiGrids = document.querySelectorAll('.emoji-grid-container .emoji-grid');
    emojiGrids.forEach(grid => {
      grid.style.display = (grid.getAttribute('data-category') === category) ? 'grid' : 'none';
    });
    
    // Arama inputunu sıfırla (filtreleme yok)
    document.getElementById("emoji-search-input").value = "";
    // Tüm emojileri tekrar görünür yap
    const activeGrid = document.querySelector(`.emoji-grid[data-category="${category}"]`);
    if (activeGrid) {
      activeGrid.querySelectorAll('.emoji').forEach(emoji => {
        emoji.style.display = 'inline-flex';
      });
    }
  });
});

// Emoji arama dinleyicisi
document.getElementById("emoji-search-input").addEventListener("input", function() {
  const query = this.value.trim().toLowerCase();
  // Şu an aktif grid'i bul
  const activeGrid = document.querySelector(".emoji-grid-container .emoji-grid:not([style*='display: none'])");
  if (activeGrid) {
    const emojis = activeGrid.querySelectorAll(".emoji");
    emojis.forEach(emoji => {
      // Emoji metnini al (örneğin "😀")
      const emojiChar = emoji.textContent;
      // Eğer arama sorgusuyla eşleşiyorsa göster, aksi halde gizle
      if (emojiChar.toLowerCase().includes(query)) {
        emoji.style.display = "inline-flex";
      } else {
        emoji.style.display = "none";
      }
    });
  }
});
    
  </script>
</body>
</html>
